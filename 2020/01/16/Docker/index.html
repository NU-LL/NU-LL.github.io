<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <title>Docker | æ— åå°å’</title>
  <meta name="keywords" content=" Docker ">
  <meta name="description" content="Docker | æ— åå°å’">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="å…³äº">
<meta property="og:type" content="website">
<meta property="og:title" content="about">
<meta property="og:url" content="http://NU-LL.github.io/about/index.html">
<meta property="og:site_name" content="æ— åå°å’">
<meta property="og:description" content="å…³äº">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-07-21T14:30:10.192Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="about">
<meta name="twitter:description" content="å…³äº">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0"></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js"></script>

<script src="/js/iconfont.js?v=1.1.0"></script>

</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value>
  <input class="theme_blog_path" value>
  <input id="theme_shortcut" value="true">
</div>


<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/avatar.jpg" />
</a>
<div class="author">
    <span>NU-LL</span>
</div>

<div class="icon">
    
        
    
        
        <a title="github" href="https://github.com/NU-LL" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-github"></use>
                </svg>
            
        </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
        <a title="csdn" href="https://blog.csdn.net/CSDN_JZ_" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-csdn"></use>
                </svg>
            
        </a>
        
    
        
    
        
    
        
        <a title="email" href="mailto:1125934312@qq.com" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-email"></use>
                </svg>
            
        </a>
        
    
        
        <a title="qq" href="http://wpa.qq.com/msgrd?v=3&uin=1125934312&site=qq&menu=yes" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-qq"></use>
                </svg>
            
        </a>
        
    
        
    
        
        <a title="neteasemusic" href="https://music.163.com/#/user/home?id=323374922" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-neteasemusic"></use>
                </svg>
            
        </a>
        
    
</div>




<ul>
    <li><div class="all active" data-rel="All">All<small>(44)</small></div></li>
    
        
            
            <li><div data-rel="Linux">Linux<small>(25)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="ç¼–ç¨‹è¯­è¨€">ç¼–ç¨‹è¯­è¨€<small>(6)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="MCU">MCU<small>(3)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="äººå·¥æ™ºèƒ½">äººå·¥æ™ºèƒ½<small>(3)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="å·¥å…·">å·¥å…·<small>(4)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="ç®—æ³•">ç®—æ³•<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="æ„Ÿæ‚Ÿä¸æ€»ç»“">æ„Ÿæ‚Ÿä¸æ€»ç»“<small>(2)</small></div>
                
            </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div><a class="about  hasFriend  site_url"  href="/about">About</a><a style="width: 50%"  class="friends">Friends</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="44">
<input type="hidden" id="yelog_site_word_count" value="288.7k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Links
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="https://github.com/NU-LL">NU-LL</a></li>
            
            <li><a target="_blank" href="https://github.com/southernEast">SouthEast</a></li>
            
            <li><a target="_blank" href="https://github.com/tan1998lei">tan1998lei</a></li>
            
            <li><a target="_blank" href="https://github.com/jiejieTop">jiejieTop</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="æœç´¢ å¿«æ·é”® i"></i>
            <div class="right-title">All</div>
            <i class="iconfont icon-file-tree" data-title="åˆ‡æ¢åˆ°å¤§çº²è§†å›¾ å¿«æ·é”® w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="è¿”å›"></i>
            <input id="local-search-input" />
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="å¤§å°å†™æ•æ„Ÿ"></i>
            <i class="iconfont icon-tag" data-title="æ ‡ç­¾"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">å¤§çº²</div>
            <i class="iconfont icon-list" data-title="åˆ‡æ¢åˆ°æ–‡ç« åˆ—è¡¨"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>BootLoader</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Ctex</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>DM9000C</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Docker</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>dual bank</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ESP32</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ESP8266</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>git</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>GO</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Goè¯­è¨€å…¥é—¨ç»å…¸</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>IAP</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>IICé©±åŠ¨</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Kconfigè¯­æ³•</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Kubernetes</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Latex</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>LiCheePi Zero</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Linuxå†…æ ¸</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>LinuxæœåŠ¡</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Markdown</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>markdownlint</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Mininet</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>NanoPi Neo Core</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>network namespace</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>pollæœºåˆ¶</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>python</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>pythonå®æˆ˜</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>SVM</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>TensorFlow2</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>u-boot</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>wait_queue_head_t</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>wait_queue_t</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Xmanager</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>äºŒç»´æ•°ç»„</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>å­—ç¬¦é©±åŠ¨</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>å­˜å‚¨å™¨</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>å»–é›ªå³°pythonæ•™ç¨‹</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>å¼‚æ­¥é€šçŸ¥æœºåˆ¶</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>å¿«é€Ÿæ’åº</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>æŒ‡é’ˆ</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>æŒ‰é”®é©±åŠ¨</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>æ•°æ®åˆ†æ</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>æ–‡ä»¶æè¿°ç¬¦</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>æ ¹æ–‡ä»¶ç³»ç»Ÿ</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>æ·±åº¦å­¦ä¹ </a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>çˆ¬è™«</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ç­‰å¾…é˜Ÿåˆ—</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ç½‘å¡ç§»æ¤</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ç½‘å¡é©±åŠ¨æ¡†æ¶</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>è™šæ‹Ÿç½‘å¡</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>è®¾å¤‡æ ‘</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>è¾“å…¥å­ç³»ç»Ÿ</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>è¿œç¨‹é“¾æ¥</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>é©±åŠ¨API</a>
            </li>
        
    </div>

</div>

    
    <div id="local-search-result">

    </div>
    
    <nav id="title-list-nav">
        
        <a  class="All äººå·¥æ™ºèƒ½ "
           href="/2020/06/05/SVM/"
           data-tag="SVM"
           data-author="" >
            <span class="post-title" title="SVMï¼ˆçº¿æ€§æ¨¡å‹ï¼‰æ•°å­¦æ¨å¯¼">SVMï¼ˆçº¿æ€§æ¨¡å‹ï¼‰æ•°å­¦æ¨å¯¼</span>
            <span class="post-date" title="2020-06-05 21:12:53">2020/06/05</span>
        </a>
        
        <a  class="All MCU "
           href="/2020/05/16/ESP32/"
           data-tag="ESP32"
           data-author="" >
            <span class="post-title" title="ESP8266">ESP8266</span>
            <span class="post-date" title="2020-05-16 10:30:54">2020/05/16</span>
        </a>
        
        <a  class="All ç¼–ç¨‹è¯­è¨€ "
           href="/2020/05/09/Cå’ŒGOçš„è¯­æ³•å¯¹æ¯”/"
           data-tag="GO"
           data-author="" >
            <span class="post-title" title="Cå’ŒGOçš„è¯­æ³•å¯¹æ¯”">Cå’ŒGOçš„è¯­æ³•å¯¹æ¯”</span>
            <span class="post-date" title="2020-05-09 19:55:39">2020/05/09</span>
        </a>
        
        <a  class="All äººå·¥æ™ºèƒ½ "
           href="/2020/05/03/TensorFlow2/"
           data-tag="TensorFlow2"
           data-author="" >
            <span class="post-title" title="TensorFlow2å…¥é—¨ä¸å®è·µ">TensorFlow2å…¥é—¨ä¸å®è·µ</span>
            <span class="post-date" title="2020-05-03 00:52:53">2020/05/03</span>
        </a>
        
        <a  class="All MCU "
           href="/2020/04/28/ESP8266/"
           data-tag="ESP8266"
           data-author="" >
            <span class="post-title" title="ESP8266">ESP8266</span>
            <span class="post-date" title="2020-04-28 14:27:54">2020/04/28</span>
        </a>
        
        <a  class="All Linux "
           href="/2020/04/06/Linuxé©±åŠ¨å¸¸ç”¨APIæ•´ç†/"
           data-tag="é©±åŠ¨API"
           data-author="" >
            <span class="post-title" title="Linuxé©±åŠ¨å¸¸ç”¨APIæ•´ç†">Linuxé©±åŠ¨å¸¸ç”¨APIæ•´ç†</span>
            <span class="post-date" title="2020-04-06 22:48:09">2020/04/06</span>
        </a>
        
        <a  class="All Linux "
           href="/2020/03/28/Linuxä¸Šå¸¸è§æœåŠ¡æ­å»º/"
           data-tag="LinuxæœåŠ¡"
           data-author="" >
            <span class="post-title" title="Linuxä¸Šå¸¸è§æœåŠ¡æ­å»º">Linuxä¸Šå¸¸è§æœåŠ¡æ­å»º</span>
            <span class="post-date" title="2020-03-28 01:27:58">2020/03/28</span>
        </a>
        
        <a  class="All Linux "
           href="/2020/03/15/kubernetes/"
           data-tag="Kubernetes"
           data-author="" >
            <span class="post-title" title="Kubernetes">Kubernetes</span>
            <span class="post-date" title="2020-03-15 13:48:53">2020/03/15</span>
        </a>
        
        <a  class="All ç¼–ç¨‹è¯­è¨€ "
           href="/2020/03/10/Pythonæ•°æ®åˆ†æä¸å±•ç¤º/"
           data-tag="æ•°æ®åˆ†æ"
           data-author="" >
            <span class="post-title" title="Pythonæ•°æ®åˆ†æä¸å±•ç¤º">Pythonæ•°æ®åˆ†æä¸å±•ç¤º</span>
            <span class="post-date" title="2020-03-10 15:10:50">2020/03/10</span>
        </a>
        
        <a  class="All ç¼–ç¨‹è¯­è¨€ "
           href="/2020/02/18/pythonçˆ¬è™«/"
           data-tag="python,çˆ¬è™«"
           data-author="" >
            <span class="post-title" title="pythonçˆ¬è™«">pythonçˆ¬è™«</span>
            <span class="post-date" title="2020-02-18 23:40:18">2020/02/18</span>
        </a>
        
        <a  class="All Linux "
           href="/2020/02/13/Mininet/"
           data-tag="Mininet"
           data-author="" >
            <span class="post-title" title="Mininet">Mininet</span>
            <span class="post-date" title="2020-02-13 18:37:12">2020/02/13</span>
        </a>
        
        <a  class="All Linux "
           href="/2020/02/10/linux ç½‘ç»œè™šæ‹ŸåŒ–ï¼š network namespace ç®€ä»‹/"
           data-tag="network namespace"
           data-author="" >
            <span class="post-title" title="linux ç½‘ç»œè™šæ‹ŸåŒ–ï¼š network namespace ç®€ä»‹">linux ç½‘ç»œè™šæ‹ŸåŒ–ï¼š network namespace ç®€ä»‹</span>
            <span class="post-date" title="2020-02-10 14:24:09">2020/02/10</span>
        </a>
        
        <a  class="All ç¼–ç¨‹è¯­è¨€ "
           href="/2020/01/29/pythonå®æˆ˜/"
           data-tag="pythonå®æˆ˜"
           data-author="" >
            <span class="post-title" title="pythonå®æˆ˜">pythonå®æˆ˜</span>
            <span class="post-date" title="2020-01-29 21:36:32">2020/01/29</span>
        </a>
        
        <a  class="All Linux "
           href="/2020/01/16/Docker/"
           data-tag="Docker"
           data-author="" >
            <span class="post-title" title="Docker">Docker</span>
            <span class="post-date" title="2020-01-16 20:14:51">2020/01/16</span>
        </a>
        
        <a  class="All ç¼–ç¨‹è¯­è¨€ "
           href="/2020/01/10/python/"
           data-tag="å»–é›ªå³°pythonæ•™ç¨‹"
           data-author="" >
            <span class="post-title" title="Python">Python</span>
            <span class="post-date" title="2020-01-10 20:18:52">2020/01/10</span>
        </a>
        
        <a  class="All äººå·¥æ™ºèƒ½ "
           href="/2020/01/03/æ·±åº¦å­¦ä¹ ä¸TensorFlow2/"
           data-tag="TensorFlow2,æ·±åº¦å­¦ä¹ "
           data-author="" >
            <span class="post-title" title="æ·±åº¦å­¦ä¹ ä¸TensorFlow2">æ·±åº¦å­¦ä¹ ä¸TensorFlow2</span>
            <span class="post-date" title="2020-01-03 21:04:26">2020/01/03</span>
        </a>
        
        <a  class="All MCU "
           href="/2019/11/12/åŸºäºSTM32L476çš„IAPå‡çº§/"
           data-tag="IAP,BootLoader,dual bank"
           data-author="" >
            <span class="post-title" title="åŸºäºSTM32L476çš„IAPå‡çº§">åŸºäºSTM32L476çš„IAPå‡çº§</span>
            <span class="post-date" title="2019-11-12 22:47:40">2019/11/12</span>
        </a>
        
        <a  class="All Linux "
           href="/2019/11/08/Xmanagerè¿œç¨‹Ubuntuç³»ç»Ÿå›¾åƒåŒ–ç•Œé¢/"
           data-tag="Xmanager,è¿œç¨‹é“¾æ¥"
           data-author="" >
            <span class="post-title" title="Xmanagerè¿œç¨‹Ubuntuç³»ç»Ÿå›¾åƒåŒ–ç•Œé¢">Xmanagerè¿œç¨‹Ubuntuç³»ç»Ÿå›¾åƒåŒ–ç•Œé¢</span>
            <span class="post-date" title="2019-11-08 22:58:53">2019/11/08</span>
        </a>
        
        <a  class="All ç¼–ç¨‹è¯­è¨€ "
           href="/2019/10/23/Goè¯­è¨€/"
           data-tag="Goè¯­è¨€å…¥é—¨ç»å…¸"
           data-author="" >
            <span class="post-title" title="Goè¯­è¨€">Goè¯­è¨€</span>
            <span class="post-date" title="2019-10-23 21:07:25">2019/10/23</span>
        </a>
        
        <a  class="All Linux "
           href="/2019/10/18/LiCheePi_Zeroåº•å±‚å¼€å‘/"
           data-tag="LiCheePi Zero"
           data-author="" >
            <span class="post-title" title="LiCheePi_Zeroåº•å±‚å¼€å‘">LiCheePi_Zeroåº•å±‚å¼€å‘</span>
            <span class="post-date" title="2019-10-18 12:25:42">2019/10/18</span>
        </a>
        
        <a  class="All Linux "
           href="/2019/10/18/NanoPi_Neo_Coreåº•å±‚å¼€å‘/"
           data-tag="NanoPi Neo Core"
           data-author="" >
            <span class="post-title" title="NanoPi_Neo_Coreåº•å±‚å¼€å‘">NanoPi_Neo_Coreåº•å±‚å¼€å‘</span>
            <span class="post-date" title="2019-10-18 12:25:42">2019/10/18</span>
        </a>
        
        <a  class="All Linux "
           href="/2019/10/13/è®¾å¤‡æ ‘/"
           data-tag="è®¾å¤‡æ ‘"
           data-author="" >
            <span class="post-title" title="è®¾å¤‡æ ‘">è®¾å¤‡æ ‘</span>
            <span class="post-date" title="2019-10-13 15:53:24">2019/10/13</span>
        </a>
        
        <a  class="All å·¥å…· "
           href="/2019/09/17/markdownlintè§„åˆ™è¯¦ç»†ä»‹ç»/"
           data-tag="markdownlint"
           data-author="" >
            <span class="post-title" title="VSCæ’ä»¶ä¹‹markdownlintè§„åˆ™è¯¦ç»†ä»‹ç»">VSCæ’ä»¶ä¹‹markdownlintè§„åˆ™è¯¦ç»†ä»‹ç»</span>
            <span class="post-date" title="2019-09-17 15:00:13">2019/09/17</span>
        </a>
        
        <a  class="All å·¥å…· "
           href="/2019/09/17/git/"
           data-tag="git"
           data-author="" >
            <span class="post-title" title="git">git</span>
            <span class="post-date" title="2019-09-17 09:59:56">2019/09/17</span>
        </a>
        
        <a  class="All å·¥å…· "
           href="/2019/08/19/Latexæ’ç‰ˆå…¨è§£/"
           data-tag="Latex,Ctex"
           data-author="" >
            <span class="post-title" title="Latexæ’ç‰ˆå…¨è§£">Latexæ’ç‰ˆå…¨è§£</span>
            <span class="post-date" title="2019-08-19 16:02:27">2019/08/19</span>
        </a>
        
        <a  class="All Linux "
           href="/2019/08/15/Kconfigæ–‡ä»¶è¯­æ³•åˆ†æ/"
           data-tag="Kconfigè¯­æ³•"
           data-author="" >
            <span class="post-title" title="Kconfigæ–‡ä»¶è¯­æ³•åˆ†æ">Kconfigæ–‡ä»¶è¯­æ³•åˆ†æ</span>
            <span class="post-date" title="2019-08-15 19:38:40">2019/08/15</span>
        </a>
        
        <a  class="All Linux "
           href="/2019/08/14/æ„é€ æ ¹æ–‡ä»¶ç³»ç»Ÿ/"
           data-tag="æ ¹æ–‡ä»¶ç³»ç»Ÿ"
           data-author="" >
            <span class="post-title" title="æ„é€ æ ¹æ–‡ä»¶ç³»ç»Ÿ">æ„é€ æ ¹æ–‡ä»¶ç³»ç»Ÿ</span>
            <span class="post-date" title="2019-08-14 20:18:45">2019/08/14</span>
        </a>
        
        <a  class="All Linux "
           href="/2019/08/13/Linuxå†…æ ¸å¯åŠ¨æµç¨‹/"
           data-tag="Linuxå†…æ ¸"
           data-author="" >
            <span class="post-title" title="Linuxå†…æ ¸å¯åŠ¨æµç¨‹">Linuxå†…æ ¸å¯åŠ¨æµç¨‹</span>
            <span class="post-date" title="2019-08-13 16:13:46">2019/08/13</span>
        </a>
        
        <a  class="All Linux "
           href="/2019/08/12/u-bootåˆ†æä¸ä½¿ç”¨/"
           data-tag="u-boot"
           data-author="" >
            <span class="post-title" title="u-bootåˆ†æä¸ä½¿ç”¨">u-bootåˆ†æä¸ä½¿ç”¨</span>
            <span class="post-date" title="2019-08-12 19:16:50">2019/08/12</span>
        </a>
        
        <a  class="All Linux "
           href="/2019/08/12/u-bootåˆ†æä¸ä½¿ç”¨/u-bootåˆ†æä¸ä½¿ç”¨ - è€ç‰ˆæœ¬å¤‡ä»½/"
           data-tag="u-boot"
           data-author="" >
            <span class="post-title" title="u-bootåˆ†æä¸ä½¿ç”¨">u-bootåˆ†æä¸ä½¿ç”¨</span>
            <span class="post-date" title="2019-08-12 19:16:50">2019/08/12</span>
        </a>
        
        <a  class="All æ„Ÿæ‚Ÿä¸æ€»ç»“ "
           href="/2019/08/11/å„ç§å­˜å‚¨å™¨çš„åŒºåˆ«/"
           data-tag="å­˜å‚¨å™¨"
           data-author="" >
            <span class="post-title" title="å„ç§å­˜å‚¨å™¨çš„åŒºåˆ«">å„ç§å­˜å‚¨å™¨çš„åŒºåˆ«</span>
            <span class="post-date" title="2019-08-11 10:57:19">2019/08/11</span>
        </a>
        
        <a  class="All Linux "
           href="/2019/08/07/RTCé©±åŠ¨åˆ†æ/"
           data-tag="å­—ç¬¦é©±åŠ¨"
           data-author="" >
            <span class="post-title" title="RTCé©±åŠ¨åˆ†æ">RTCé©±åŠ¨åˆ†æ</span>
            <span class="post-date" title="2019-08-07 13:37:33">2019/08/07</span>
        </a>
        
        <a  class="All Linux "
           href="/2019/08/07/å­—ç¬¦é©±åŠ¨è®¾å¤‡çš„å¦ä¸€ç§å†™æ³•/"
           data-tag="å­—ç¬¦é©±åŠ¨"
           data-author="" >
            <span class="post-title" title="å­—ç¬¦é©±åŠ¨è®¾å¤‡çš„å¦ä¸€ç§å†™æ³•">å­—ç¬¦é©±åŠ¨è®¾å¤‡çš„å¦ä¸€ç§å†™æ³•</span>
            <span class="post-date" title="2019-08-07 12:20:30">2019/08/07</span>
        </a>
        
        <a  class="All æ„Ÿæ‚Ÿä¸æ€»ç»“ "
           href="/2019/08/06/äºŒç»´æ•°ç»„ä¸æŒ‡é’ˆçš„ä¸€äº›é—®é¢˜/"
           data-tag="äºŒç»´æ•°ç»„,æŒ‡é’ˆ"
           data-author="" >
            <span class="post-title" title="äºŒç»´æ•°ç»„ä¸æŒ‡é’ˆçš„ä¸€äº›é—®é¢˜">äºŒç»´æ•°ç»„ä¸æŒ‡é’ˆçš„ä¸€äº›é—®é¢˜</span>
            <span class="post-date" title="2019-08-06 13:11:26">2019/08/06</span>
        </a>
        
        <a  class="All Linux "
           href="/2019/08/05/IICé©±åŠ¨/"
           data-tag="IICé©±åŠ¨"
           data-author="" >
            <span class="post-title" title="IICé©±åŠ¨">IICé©±åŠ¨</span>
            <span class="post-date" title="2019-08-05 14:39:10">2019/08/05</span>
        </a>
        
        <a  class="All Linux "
           href="/2019/08/04/DM9000Cç½‘å¡ç§»æ¤/"
           data-tag="DM9000C,ç½‘å¡ç§»æ¤"
           data-author="" >
            <span class="post-title" title="DM9000Cç½‘å¡ç§»æ¤">DM9000Cç½‘å¡ç§»æ¤</span>
            <span class="post-date" title="2019-08-04 23:07:22">2019/08/04</span>
        </a>
        
        <a  class="All Linux "
           href="/2019/08/04/ç½‘å¡é©±åŠ¨ç¨‹åº/"
           data-tag="ç½‘å¡é©±åŠ¨æ¡†æ¶,è™šæ‹Ÿç½‘å¡"
           data-author="" >
            <span class="post-title" title="ç½‘å¡é©±åŠ¨ç¨‹åº">ç½‘å¡é©±åŠ¨ç¨‹åº</span>
            <span class="post-date" title="2019-08-04 21:24:07">2019/08/04</span>
        </a>
        
        <a  class="All ç®—æ³• "
           href="/2019/07/29/å¿«é€Ÿæ’åº/"
           data-tag="å¿«é€Ÿæ’åº"
           data-author="" >
            <span class="post-title" title="å¿«é€Ÿæ’åº">å¿«é€Ÿæ’åº</span>
            <span class="post-date" title="2019-07-29 22:27:34">2019/07/29</span>
        </a>
        
        <a  class="All Linux "
           href="/2019/07/25/è¾“å…¥å­ç³»ç»Ÿ/"
           data-tag="æŒ‰é”®é©±åŠ¨,è¾“å…¥å­ç³»ç»Ÿ"
           data-author="" >
            <span class="post-title" title="è¾“å…¥å­ç³»ç»Ÿ">è¾“å…¥å­ç³»ç»Ÿ</span>
            <span class="post-date" title="2019-07-25 00:05:15">2019/07/25</span>
        </a>
        
        <a  class="All Linux "
           href="/2019/07/22/æŒ‰é”®é©±åŠ¨ï¼šå¼‚æ­¥é€šçŸ¥æœºåˆ¶/"
           data-tag="æŒ‰é”®é©±åŠ¨,å¼‚æ­¥é€šçŸ¥æœºåˆ¶"
           data-author="" >
            <span class="post-title" title="æŒ‰é”®é©±åŠ¨ï¼šå¼‚æ­¥é€šçŸ¥æœºåˆ¶">æŒ‰é”®é©±åŠ¨ï¼šå¼‚æ­¥é€šçŸ¥æœºåˆ¶</span>
            <span class="post-date" title="2019-07-22 19:04:24">2019/07/22</span>
        </a>
        
        <a  class="All Linux "
           href="/2019/07/21/æŒ‰é”®é©±åŠ¨â€”â€”pollæœºåˆ¶/"
           data-tag="æŒ‰é”®é©±åŠ¨,pollæœºåˆ¶"
           data-author="" >
            <span class="post-title" title="æŒ‰é”®é©±åŠ¨â€”â€”pollæœºåˆ¶">æŒ‰é”®é©±åŠ¨â€”â€”pollæœºåˆ¶</span>
            <span class="post-date" title="2019-07-21 20:30:38">2019/07/21</span>
        </a>
        
        <a  class="All Linux "
           href="/2019/07/21/linuxç­‰å¾…é˜Ÿåˆ—wait_queue_head_tå’Œwait_queue_t/"
           data-tag="ç­‰å¾…é˜Ÿåˆ—,wait_queue_head_t,wait_queue_t"
           data-author="" >
            <span class="post-title" title="linuxç­‰å¾…é˜Ÿåˆ—wait_queue_head_tå’Œwait_queue_t">linuxç­‰å¾…é˜Ÿåˆ—wait_queue_head_tå’Œwait_queue_t</span>
            <span class="post-date" title="2019-07-21 18:18:54">2019/07/21</span>
        </a>
        
        <a  class="All Linux "
           href="/2019/07/21/Linuxç¼–ç¨‹--æ–‡ä»¶æè¿°ç¬¦fd/"
           data-tag="æ–‡ä»¶æè¿°ç¬¦"
           data-author="" >
            <span class="post-title" title="Linuxç¼–ç¨‹--æ–‡ä»¶æè¿°ç¬¦fd">Linuxç¼–ç¨‹--æ–‡ä»¶æè¿°ç¬¦fd</span>
            <span class="post-date" title="2019-07-21 10:13:47">2019/07/21</span>
        </a>
        
        <a  class="All å·¥å…· "
           href="/2019/07/12/Markdown è¯­æ³•æ•´ç†/"
           data-tag="Markdown"
           data-author="" >
            <span class="post-title" title="Markdown è¯­æ³•æ•´ç†">Markdown è¯­æ³•æ•´ç†</span>
            <span class="post-date" title="2019-07-12 13:57:24">2019/07/12</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="åˆ‡æ¢å…¨å± å¿«æ·é”® s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-Docker" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">Docker</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="Linux">Linux</a>
            
        </span>
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color2">Docker</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='Updated At: 2020-04-14 21:06:15'>2020-01-16 20:14</time>
        
    </div>
    <div class="article-meta">
        
        <span>Count:13k</span>
        
        
        <span id="busuanzi_container_page_pv">
            Views ğŸ‘€ :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸€ã€ç¯å¢ƒæ­å»ºï¼ˆUbuntu-18-04ï¼‰"><span class="toc-text">ä¸€ã€ç¯å¢ƒæ­å»ºï¼ˆUbuntu 18.04ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Vagrant-VirtualBox"><span class="toc-text">Vagrant+VirtualBox</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å®‰è£…Docker-Engine-Community"><span class="toc-text">å®‰è£…Docker Engine - Community</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#äºŒã€Dockerçš„é•œåƒå’Œå®¹å™¨"><span class="toc-text">äºŒã€Dockerçš„é•œåƒå’Œå®¹å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#æ¶æ„å’Œåº•å±‚"><span class="toc-text">æ¶æ„å’Œåº•å±‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Image"><span class="toc-text">Image</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Container"><span class="toc-text">Container</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ„å»ºè‡ªå·±çš„image"><span class="toc-text">æ„å»ºè‡ªå·±çš„image</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DockerFile"><span class="toc-text">DockerFile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å‘å¸ƒé•œåƒ"><span class="toc-text">å‘å¸ƒé•œåƒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å®¹å™¨èµ„æºé™åˆ¶"><span class="toc-text">å®¹å™¨èµ„æºé™åˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å®æˆ˜â€”â€”ubuntuä¸Šæ‰“åŒ…stress"><span class="toc-text">å®æˆ˜â€”â€”ubuntuä¸Šæ‰“åŒ…stress</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pythonå¸¸é©»ç¨‹åº"><span class="toc-text">pythonå¸¸é©»ç¨‹åº</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ubuntuä¸Šæ‰“åŒ…stress"><span class="toc-text">ubuntuä¸Šæ‰“åŒ…stress</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸‰ã€dockerç½‘ç»œ"><span class="toc-text">ä¸‰ã€dockerç½‘ç»œ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#åŸºæœ¬æ¦‚å¿µ"><span class="toc-text">åŸºæœ¬æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linuxä¸­network-namespace"><span class="toc-text">Linuxä¸­network namespace</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-Bridge0è¯¦è§£"><span class="toc-text">Docker Bridge0è¯¦è§£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dockerä¹‹é—´çš„link"><span class="toc-text">dockerä¹‹é—´çš„link</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ç«¯å£æ˜ å°„"><span class="toc-text">ç«¯å£æ˜ å°„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hostå’Œnoneç½‘ç»œ"><span class="toc-text">hostå’Œnoneç½‘ç»œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å¤šæœºé€šä¿¡"><span class="toc-text">å¤šæœºé€šä¿¡</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å››ã€Dockerçš„æŒä¹…åŒ–å­˜å‚¨å’Œæ•°æ®å…±äº«"><span class="toc-text">å››ã€Dockerçš„æŒä¹…åŒ–å­˜å‚¨å’Œæ•°æ®å…±äº«</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Data-Volume"><span class="toc-text">Data Volume</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bind-Mounting"><span class="toc-text">Bind Mounting</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#äº”ã€Docker-Composeå¤šå®¹å™¨éƒ¨ç½²"><span class="toc-text">äº”ã€Docker Composeå¤šå®¹å™¨éƒ¨ç½²</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#å®‰è£…å’ŒåŸºæœ¬ä½¿ç”¨"><span class="toc-text">å®‰è£…å’ŒåŸºæœ¬ä½¿ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ°´å¹³æ‰©å±•å’Œè´Ÿè½½å‡è¡¡"><span class="toc-text">æ°´å¹³æ‰©å±•å’Œè´Ÿè½½å‡è¡¡</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å…­ã€å®¹å™¨ç¼–æ’Swarm-mode"><span class="toc-text">å…­ã€å®¹å™¨ç¼–æ’Swarm mode</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Serviceçš„åˆ›å»ºç»´æŠ¤å’Œæ°´å¹³æ‰©å±•"><span class="toc-text">Serviceçš„åˆ›å»ºç»´æŠ¤å’Œæ°´å¹³æ‰©å±•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#é›†ç¾¤æœåŠ¡å™¨é€šä¿¡â€”â€”RoutingMesh"><span class="toc-text">é›†ç¾¤æœåŠ¡å™¨é€šä¿¡â€”â€”RoutingMesh</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Internal"><span class="toc-text">Internal</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Ingress"><span class="toc-text">Ingress</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-stackéƒ¨ç½²swarm"><span class="toc-text">docker stackéƒ¨ç½²swarm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å¯†ç ç®¡ç†"><span class="toc-text">å¯†ç ç®¡ç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-stackä¸­ä½¿ç”¨secret"><span class="toc-text">docker stackä¸­ä½¿ç”¨secret</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#serviceæ›´æ–°"><span class="toc-text">serviceæ›´æ–°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸ƒã€å®¹å™¨ç¼–æ’Kubernetes"><span class="toc-text">ä¸ƒã€å®¹å™¨ç¼–æ’Kubernetes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#æ­å»ºk8så•èŠ‚ç‚¹ç¯å¢ƒ"><span class="toc-text">æ­å»ºk8så•èŠ‚ç‚¹ç¯å¢ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#kubectlå‘½ä»¤è¡Œè¡¥å…¨è¡¥ä¸"><span class="toc-text">kubectlå‘½ä»¤è¡Œè¡¥å…¨è¡¥ä¸</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æœ€å°è°ƒåº¦å•ä½pod"><span class="toc-text">æœ€å°è°ƒåº¦å•ä½pod</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ¨ªå‘æ‰©å±•"><span class="toc-text">æ¨ªå‘æ‰©å±•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Deployments"><span class="toc-text">Deployments</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#åˆ›å»ºå’Œç®¡ç†"><span class="toc-text">åˆ›å»ºå’Œç®¡ç†</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä½¿ç”¨Tectonicæ­å»ºæœ¬åœ°å¤šèŠ‚ç‚¹"><span class="toc-text">ä½¿ç”¨Tectonicæ­å»ºæœ¬åœ°å¤šèŠ‚ç‚¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#åŸºç¡€ç½‘ç»œCluster-Network"><span class="toc-text">åŸºç¡€ç½‘ç»œCluster Network</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Service"><span class="toc-text">Service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NodePortç±»å‹serviceä»¥åŠLabelç®€å•åº”ç”¨"><span class="toc-text">NodePortç±»å‹serviceä»¥åŠLabelç®€å•åº”ç”¨</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-6 i,
    .toc-level-6 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="ä¸€ã€ç¯å¢ƒæ­å»ºï¼ˆUbuntu-18-04ï¼‰"><a href="#ä¸€ã€ç¯å¢ƒæ­å»ºï¼ˆUbuntu-18-04ï¼‰" class="headerlink" title="ä¸€ã€ç¯å¢ƒæ­å»ºï¼ˆUbuntu 18.04ï¼‰"></a>ä¸€ã€ç¯å¢ƒæ­å»ºï¼ˆUbuntu 18.04ï¼‰</h2><p>æœ¬æ–‡å‰æœŸDockerç¯å¢ƒä¸ºï¼šWindows10 1809 ä¼ä¸šç‰ˆ + VMware Workstation 15 Pro + Ubuntu 18.04.2LTS</p>
<p>åæœŸKubernetesç¯å¢ƒä¸ºï¼šWindows10 1809 ä¼ä¸šç‰ˆ + Vagrant 2.2.7 + VirtualBox 6.1.4 + centos7/Ubuntu 18.04 LTS</p>
<h3 id="Vagrant-VirtualBox"><a href="#Vagrant-VirtualBox" class="headerlink" title="Vagrant+VirtualBox"></a>Vagrant+VirtualBox</h3><p>ä¸‹è½½Vagrantå®‰è£…åŒ…ï¼š<a href="https://www.vagrantup.com/downloads.html" target="_blank" rel="noopener">å®˜ç½‘é“¾æ¥</a></p>
<p>ä¸‹è½½VirtualBoxå®‰è£…åŒ…ï¼š<a href="https://www.virtualbox.org/wiki/Downloads" target="_blank" rel="noopener">å®˜ç½‘é“¾æ¥</a>ï¼Œä¸è¿‡VirtualBoxä¸‹è½½éœ€è¦æ¢¯å­ï¼Œå¯ä»¥é€šè¿‡<a href="https://mirror.tuna.tsinghua.edu.cn/help/virtualbox/" target="_blank" rel="noopener">æ¸…åé•œåƒ</a>ä¸‹è½½</p>
<p>vagrantçš„ç›¸å…³imageå¯ä»¥é€šè¿‡<a href="https://app.vagrantup.com/boxes/search" target="_blank" rel="noopener">è¯¥ç½‘å€</a>è¿›è¡Œæœç´¢</p>
<p>ä¸Šè¿°ä¸¤ä¸ªè½¯ä»¶å‡å‚»ç“œå¼å®‰è£…å³å¯ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•åˆ©ç”¨Vagrantåœ¨VirtualBoxä¸­åˆ›å»ºè™šæ‹Ÿæœºï¼š</p>
<pre><code class="powershell">#æŸ¥çœ‹Vagrantç‰ˆæœ¬
vagrant -v

#åˆ›å»ºç›®å½•
mkdir centos7

####################åˆ›å»ºcentos 7çš„é•œåƒ#############################
#åˆå§‹åŒ–ä¸€ä¸ªcentos7çš„Vagrant fileï¼ˆç±»ä¼¼äºmakefileï¼‰
vagrant init centos/7
#åˆ›å»ºcentos7çš„è™šæ‹Ÿæœºï¼Œæ­¤å¤„ä¼šä¸‹è½½imageï¼Œæ—¶é—´è¾ƒä¹…
vagrant up

####################åˆ›å»ºubuntuçš„é•œåƒ#############################
#åˆå§‹åŒ–ä¸€ä¸ªUbuntu 18.04 LTSçš„Vagrant file
vagrant init ubuntu/bionic64
#åˆ›å»ºUbuntu 18.04 LTSçš„è™šæ‹Ÿæœºï¼Œæ­¤å¤„ä¼šä¸‹è½½imageï¼Œæ—¶é—´è¾ƒä¹…
vagrant up

####################å›½å†…é•œåƒæº åˆ›å»ºubuntuçš„é•œåƒ#############################
#åˆå§‹åŒ–ä¸€ä¸ªUbuntu 18.04 LTSçš„Vagrant file
vagrant init ubuntu/bionic64
#é‡‡ç”¨æ¸…åé•œåƒ 
vagrant box add https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cloud-images/bionic/current/bionic-server-cloudimg-amd64-vagrant.box --name ubuntu/bionic64
#åˆ›å»ºUbuntu 18.04 LTSçš„è™šæ‹Ÿæœºï¼Œæ­¤å¤„ä¼šä¸‹è½½imageï¼Œæ—¶é—´è¾ƒä¹…
vagrant up</code></pre>
<ul>
<li>æ³¨æ„ï¼šå¦‚éœ€æ¢æˆå…¶ä»–é•œåƒéœ€è¦è‡ªå·±å»<a href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cloud-images/" target="_blank" rel="noopener">æ¸…åé•œåƒ</a>ï¼ˆæœ‰å¯èƒ½æ²¡æœ‰ï¼‰ä¸­æŸ¥æ‰¾å¯¹åº”çš„<code>box</code>æ–‡ä»¶</li>
<li>ä¹Ÿå¯ä»¥é‡‡å–ç”¨å…¶ä»–æ–¹å¼ä¸‹è½½<code>box</code>æ–‡ä»¶ï¼ˆå¦‚ç™¾åº¦ç½‘ç›˜ï¼‰ï¼Œå†é€šè¿‡å‘½ä»¤è¡Œæ·»åŠ ï¼Œè¯¦ç»†æ–¹æ³•å³ç›¸å…³åœ°å€å¯ä»¥å‚è€ƒ<a href="https://c4ys.com/archives/1230" target="_blank" rel="noopener">è¿™ç¯‡åšå®¢</a></li>
<li>å¦‚æœWindowsç”¨æˆ·åæ˜¯ä¸­æ–‡ï¼Œåˆ™å¯èƒ½åœ¨<code>vagrant up</code>è¿™ä¸€æ­¥æŠ¥<code>incompatible character encodings: GBK and UTF-8 (Encoding::CompatibilityError)</code>ç±»ä¼¼é”™è¯¯ï¼Œå…·ä½“æ–¹æ³•è¯¦è§<a href="https://blog.csdn.net/eebaicai/article/details/82148901?depth_1-utm_source=distribute.pc_relevant.none-task&utm_source=distribute.pc_relevant.none-task" target="_blank" rel="noopener">è¿™ç¯‡åšå®¢</a>ï¼Œæ¦‚æ‹¬ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š<ul>
<li>è®¾ç½®ç¯å¢ƒå˜é‡VAGRANT_HOMEä¸ºä¸åŒ…å«ä¸­æ–‡çš„è·¯å¾„ï¼Œè¯¥ç¯å¢ƒå˜é‡æ˜¯ç”¨äºä¿å­˜Vagrantä¸‹è½½çš„<code>box</code>é•œåƒæ–‡ä»¶ï¼ˆå…·ä½“è·¯å¾„ä¸º<code>$(VAGRANT_HOME)/.vagrant.d</code>ï¼‰</li>
<li>ä¿®æ”¹VirtualBoxä¸­å…¨å±€é…ç½®é€‰é¡¹ä¸­çš„ é»˜è®¤è™šæ‹Ÿç”µè„‘ä½ç½®VirtualBox VMsçš„è·¯å¾„ ï¼Œä¸èƒ½åŒ…å«ä¸­æ–‡å</li>
</ul>
</li>
<li>æ³¨æ„Vagrantå’ŒVirtualBoxç‰ˆæœ¬éœ€è¦åŒ¹é…ï¼Œæœ‰çš„ç‰ˆæœ¬ä¸åŒ¹é…å¯èƒ½ä¼šæŠ¥å„ç§é”™è¯¯ï¼Œæœ¬æ–‡ä¸­æµ‹è¯•ä¸€åˆ‡æ­£å¸¸</li>
<li>é»˜è®¤Vagrantå½“å‰é…ç½®ä¸ºåœ¨å¯ç”¨<code>SharedFoldersEnableSymlinksCreate</code>é€‰é¡¹çš„æƒ…å†µä¸‹åˆ›å»ºVirtualBoxåŒæ­¥çš„æ–‡ä»¶å¤¹ã€‚ å¦‚æœä¸ä¿¡ä»»Vagrantè®¿å®¢ï¼Œåˆ™å¯èƒ½è¦ç¦ç”¨æ­¤é€‰é¡¹ã€‚ æœ‰å…³æ­¤é€‰é¡¹çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ<a href="https://www.virtualbox.org/manual/ch04.html#sharedfolders" target="_blank" rel="noopener">VirtualBoxæ‰‹å†Œ</a>ã€‚<ul>
<li>å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡å…¨å±€ç¦ç”¨æ­¤é€‰é¡¹ï¼š<code>VAGRANT_DISABLE_VBOXSYMLINKCREATE = 1</code></li>
<li>åœ¨Vagrantfileä¸­é…ç½®å¦‚ä¸‹ä»£ç ï¼š<code>config.vm.synced_folder &#39;/host/path&#39;, &#39;/guest/path&#39;, SharedFoldersEnableSymlinksCreate: false</code></li>
</ul>
</li>
</ul>
<p>é€šè¿‡Vagrantå‘½ä»¤è¿›å…¥centos7ä¸­çš„shellï¼š</p>
<pre><code class="powershell">vagrant ssh</code></pre>
<p>å¦‚æœæƒ³é€šè¿‡å…¶ä»–æ–¹å¼ç™»å½•è™šæ‹Ÿæœºï¼ˆå¦‚ï¼šXshellï¼‰ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è·å–hostnameã€portã€IdentityFileä¸‰ä¸ªé…ç½®ä¿¡æ¯ï¼š</p>
<pre><code class="powershell">E:\Ubuntu&gt;vagrant ssh-config
Host default
  HostName 127.0.0.1
  User vagrant
  Port 2222
  UserKnownHostsFile /dev/null
  StrictHostKeyChecking no
  PasswordAuthentication no
  IdentityFile E:/Ubuntu/.vagrant/machines/default/virtualbox/private_key
  IdentitiesOnly yes
  LogLevel FATAL</code></pre>
<p>å…¶ä¸­ï¼šHostNameä¸ºä¸»æœºIPåœ°å€ï¼ŒPortä¸ºå¼€æ”¾çš„ç«¯å£ï¼ŒIdentityFileä¸ºPublic Keyç§˜é’¥æ–‡ä»¶çš„è·¯å¾„ï¼Œä¾æ¬¡å¡«å…¥å…¶ä»–è½¯ä»¶çš„ç›¸åº”è®¾ç½®ä¸­å³å¯è®¿é—®è¯¥è™šæ‹Ÿæœº</p>
<p>å¦å¤–ï¼Œè¯¥è™šæ‹Ÿæœºé»˜è®¤ç™»å½•è´¦å·ç”¨æˆ·åä¸ºvagrantï¼Œå¯†ç ä¸ºvagrantï¼Œrootè´¦å·å¯†ç ä¸ºvagrantã€‚ä¹Ÿæœ‰å¯èƒ½æ²¡æœ‰rootå¯†ç ï¼Œéœ€è¦é€šè¿‡<code>sudo passwd</code>å‘½ä»¤é‡è®¾å¯†ç </p>
<blockquote>
<p>é™„ï¼šubuntu18.04æ¢æ¸…åæºï¼š</p>
<p>ç¼–è¾‘<code>/etc/apt/sources.list</code>æ–‡ä»¶ï¼Œä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹</p>
<pre><code class="bash"># é»˜è®¤æ³¨é‡Šäº†æºç é•œåƒä»¥æé«˜ apt update é€Ÿåº¦ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Š
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiverse

# é¢„å‘å¸ƒè½¯ä»¶æºï¼Œä¸å»ºè®®å¯ç”¨
# deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse</code></pre>
</blockquote>
<h3 id="å®‰è£…Docker-Engine-Community"><a href="#å®‰è£…Docker-Engine-Community" class="headerlink" title="å®‰è£…Docker Engine - Community"></a>å®‰è£…Docker Engine - Community</h3><p>å®˜æ–¹æ–‡æ¡£æ•™ç¨‹è¯¦è§<a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/" target="_blank" rel="noopener">è¿™é‡Œ</a></p>
<p>è®¾ç½®æº</p>
<pre><code class="bash">#æ›´æ–°
sudo apt-get update
#å®‰è£…ä¾èµ–
sudo apt-get install apt-transport-https ca-certificates curl gnupg-agent software-properties-common
#æ·»åŠ Dockerå®˜æ–¹GPGç§˜é’¥
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
#æ·»åŠ Dockeræº
sudo add-apt-repository &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot;</code></pre>
<blockquote>
<p>ç”±äºDockerå®˜æ–¹æºä¸ç¨³å®šï¼Œæ¨èå›½å†…æºï¼š</p>
<ul>
<li>dockerå®˜æ–¹ä¸­å›½åŒº <code>https://registry.docker-cn.com</code></li>
<li>ç½‘æ˜“ <code>http://hub-mirror.c.163.com</code></li>
<li>ustc <code>http://docker.mirrors.ustc.edu.cn</code></li>
<li>é˜¿é‡Œäº‘ <code>http://&lt;ä½ çš„ID&gt;.mirror.aliyuncs.com</code></li>
</ul>
<p>ustcå¸®åŠ©æ–‡æ¡£ï¼š<a href="https://lug.ustc.edu.cn/wiki/mirrors/help/docker" target="_blank" rel="noopener">https://lug.ustc.edu.cn/wiki/mirrors/help/docker</a></p>
<pre><code class="bash">sudo vi /etc/docker/daemon.json
#æ·»åŠ ä»¥ä¸‹å†…å®¹ æ³¨æ„ä¸èƒ½æ˜¯https å¦åˆ™æœ€åä¸€ç‚¹ä¸‹è½½ä¸ä¸‹æ¥
{
    &quot;registry-mirrors&quot;: [&quot;https://docker.mirrors.ustc.edu.cn/&quot;,&quot;https://hub-mirror.c.163.com&quot;,&quot;https://registry.docker-cn.com&quot;],
    ......
}
#é‡å¯dockeræœåŠ¡
service docker restart</code></pre>
</blockquote>
<p>å®‰è£…</p>
<pre><code class="bash">#å®‰è£…Docker Engine - Community
sudo apt-get update
#å®‰è£…æœ€æ–°ç‰ˆ
sudo apt-get install docker-ce docker-ce-cli containerd.io
#éªŒè¯
sudo docker version
sudo docker run hello-world</code></pre>
<blockquote>
<p>æˆ–è€…è‡ªå·±é€‰æ‹©ç‰ˆæœ¬å®‰è£…</p>
<pre><code class="bash">apt-cache madison docker-ce

sudo apt-get install docker-ce=&lt;VERSION_STRING&gt; docker-ce-cli=&lt;VERSION_STRING&gt; containerd.io</code></pre>
</blockquote>
<p>å¸è½½Docker Engine - Community</p>
<pre><code class="bash">sudo apt-get purge docker-ce
#åˆ é™¤æ‰€æœ‰é•œåƒï¼Œå®¹å™¨å’Œå·(volumes)ï¼š
sudo rm -rf /var/lib/docker</code></pre>
<h2 id="äºŒã€Dockerçš„é•œåƒå’Œå®¹å™¨"><a href="#äºŒã€Dockerçš„é•œåƒå’Œå®¹å™¨" class="headerlink" title="äºŒã€Dockerçš„é•œåƒå’Œå®¹å™¨"></a>äºŒã€Dockerçš„é•œåƒå’Œå®¹å™¨</h2><h3 id="æ¶æ„å’Œåº•å±‚"><a href="#æ¶æ„å’Œåº•å±‚" class="headerlink" title="æ¶æ„å’Œåº•å±‚"></a>æ¶æ„å’Œåº•å±‚</h3><ul>
<li>Dockeræ˜¯ä¸€ä¸ªå¹³å°ï¼Œæä¾›ä¸€ä¸ªå¼€å‘ã€æ‰“åŒ…ã€è¿è¡Œappçš„å¹³å°</li>
<li>æŠŠappå’Œåº•å±‚è®¾å¤‡éš”ç¦»å¼€</li>
</ul>
<p><img src="//NU-LL.github.io/2020/01/16/Docker/image-20200204233756060.png" alt="Dockeræ¶æ„"></p>
<p>Docker Engineï¼š</p>
<ul>
<li>åå°è¿›ç¨‹ï¼ˆdockerdï¼‰<ul>
<li>æä¾› REST API çš„æœåŠ¡ï¼ˆServerï¼‰<ul>
<li>æä¾› CLIï¼ˆclientï¼Œå®¢æˆ·ç«¯ï¼‰</li>
</ul>
</li>
<li>C-Sæ¶æ„</li>
</ul>
</li>
</ul>
<p><img src="//NU-LL.github.io/2020/01/16/Docker/image-20200204233846121.png" alt="Docker Engine"></p>
<p>æ•´ä½“æ¶æ„ï¼š</p>
<p><img src="//NU-LL.github.io/2020/01/16/Docker/image-20200204234359788.png" alt="æ•´ä½“æ¶æ„"></p>
<ul>
<li>Clientï¼šDockeræä¾›çš„å‘½ä»¤ï¼ˆå¯ä»¥å’Œhoståœ¨ä¸€å°æœºå™¨ä¸Šï¼‰</li>
<li>Docker Hostï¼šå¯åŠ¨äº†dockerdçš„æœºå™¨<ul>
<li>images</li>
<li>containers</li>
</ul>
</li>
<li>Registryï¼šåº“ï¼Œç±»ä¼¼äºGitHub</li>
</ul>
<p>dockeråº•å±‚æŠ€æœ¯æ”¯æŒï¼š</p>
<ul>
<li>Namespaces:éš”ç¦»pidã€netã€ipcã€mntã€uts</li>
<li>Control groups:åšèµ„æºé™åˆ¶</li>
<li>Union file systems:Containerå’Œ nimageçš„åˆ†å±‚</li>
</ul>
<h3 id="Image"><a href="#Image" class="headerlink" title="Image"></a>Image</h3><p>å®˜æ–¹å‘½ä»¤æ‰‹å†Œï¼š<a href="https://docs.docker.com/engine/reference/commandline/image/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/image/</a></p>
<ul>
<li>æ–‡ä»¶å’Œ meta dataçš„é›†åˆ( root filesystem)</li>
<li>åˆ†å±‚çš„,å¹¶ä¸”æ¯ä¸€å±‚éƒ½å¯ä»¥æ·»åŠ æ”¹å˜åˆ é™¤æ–‡ä»¶,æˆä¸ºä¸€ä¸ªæ–°çš„image</li>
<li>ä¸åŒçš„imageå¯ä»¥å…±äº«ç›¸åŒçš„ layer</li>
<li>Imageæœ¬èº«æ˜¯read-onlyçš„</li>
</ul>
<p>Dockerfileï¼šé€šè¿‡è¯¥æ–‡ä»¶å®šä¹‰ä¸€ä¸ªimageå¹¶èƒ½å¤Ÿæ„å»ºè¯¥image</p>
<p>BaseImgeï¼šç›´æ¥åŸºäºLinuxçš„å†…æ ¸ï¼Œåœ¨å†…æ ¸ä¸Šåˆ¶ä½œçš„ä¸€ä¸ªé•œåƒï¼ˆå¦‚å„ç§Linuxçš„å‘è¡Œç‰ˆï¼šubuntuã€centosç­‰ï¼‰ï¼Œå¯ä»¥åœ¨è¯¥é•œåƒä¸Šåœ¨åˆ¶ä½œä¸€ä¸ªæ–°çš„image</p>
<p><img src="//NU-LL.github.io/2020/01/16/Docker/image-20200205000255254.png" alt="image-20200205000255254"></p>
<p>å¸¸ç”¨å‘½ä»¤ï¼š</p>
<pre><code class="bash">#ä½¿dockerå‰ä¸éœ€è¦åŠ sudo
sudo groupadd docker#æ–°å»ºä¸€ä¸ªç»„
sudo gpasswd -a ç”¨æˆ·å ç»„å#æ·»åŠ ç”¨æˆ·åˆ°ç»„
sudo service docker restart#é‡å¯docker

#æŸ¥çœ‹dockerhubä¸Šçš„é•œåƒ
sudo docker search imageåå­—
#æŸ¥çœ‹æœ¬æœºä¸Šçš„é•œåƒ
sudo docker image ls
sudo docker images
#ä»Dockerhubä¸Šæ‹‰å–
sudo docker pull ubuntu:14.04
#ä»Dockerhubä¸Šxxxå¤„æ‹‰å–ï¼ˆç¬¬ä¸‰æ–¹ï¼‰
sudo docker pull ubuntu:14.04/XXX
#è¿è¡Œdocker
sudo docker run imageåå­—
sudo docker run -d imageåå­—#åå°è¿è¡Œ
sudo docker run -d -e PENG=xxxx imageåå­—#åå°è¿è¡Œï¼Œä¸”è®¾ç½®ä¸€ä¸ªPENGçš„ç¯å¢ƒå˜é‡ï¼Œå€¼ä¸ºxxxx
#äº¤äº’å¼çš„è¿è¡Œdockerï¼Œå¹¶è¿›å…¥å…¶æ§åˆ¶å°
sudo docker run -it imageåå­—
#æŸ¥çœ‹æœ¬æœºä¸Šçš„åœ¨è¿è¡Œçš„å®¹å™¨ï¼ˆæ­£åœ¨è¿è¡Œçš„ï¼Œå¸¸é©»å†…å­˜ï¼‰
sudo docker container ls
#æŸ¥çœ‹æœ¬æœºä¸Šæ‰€æœ‰çš„å®¹å™¨ï¼ˆæ­£åœ¨è¿è¡Œçš„å’Œå·²ç»é€€å‡ºçš„ï¼‰
sudo docker container ls -a
sudo docker container ls -aq#åˆ—å‡ºæ‰€æœ‰çš„id
sudo docker ps -a
#åˆ é™¤contaniner
sudo docker container rm id
sudo docker rm id
sudo docker rm $(sudo docker container ls -aq)#åˆ é™¤æ‰€æœ‰
#åœæ­¢contaniner
sudo docker container stop id
sudo docker stop id
#åˆ é™¤image
sudo docker image rm id
sudo docker rmi id

#æ˜¾ç¤ºå®¹å™¨çš„è¯¦ç»†ä¿¡æ¯
sudo docker inspect id
#æŸ¥çœ‹å®¹å™¨è¿è¡Œçš„è¾“å‡ºlog
sudo docker logs idæˆ–--nameæŒ‡å®šçš„åå­—</code></pre>
<h3 id="Container"><a href="#Container" class="headerlink" title="Container"></a>Container</h3><p>å®˜æ–¹å‘½ä»¤æ‰‹å†Œï¼š<a href="https://docs.docker.com/engine/reference/commandline/container/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/container/</a></p>
<ul>
<li>é€šè¿‡imageåˆ›å»º(copy)</li>
<li>åœ¨image layerä¹‹ä¸Šå»ºç«‹ä¸€ä¸ªcontainer layer(å¯è¯»å†™)</li>
<li>ç±»æ¯”é¢å‘å¯¹è±¡:ç±»ï¼ˆimageï¼‰å’Œå®ä¾‹ï¼ˆcontainerï¼‰</li>
<li>Imageè´Ÿè´£appçš„å­˜å‚¨å’Œåˆ†å‘, Containerè´Ÿè´£è¿è¡Œapp</li>
</ul>
<p><img src="//NU-LL.github.io/2020/01/16/Docker/image-20200205001054091.png" alt="Container"></p>
<h3 id="æ„å»ºè‡ªå·±çš„image"><a href="#æ„å»ºè‡ªå·±çš„image" class="headerlink" title="æ„å»ºè‡ªå·±çš„image"></a>æ„å»ºè‡ªå·±çš„image</h3><pre><code class="bash">#åŸºäºcontainer(xxx,åå­—,name)åˆ›å»ºä¸€ä¸ªimage(yyy)  ä¸æå€¡ï¼Œä¸å®‰å…¨
sudo docker container commit xxx yyy
sudo docker commit xxx yyy
#ä»dockerfileæ„å»ºä¸€ä¸ªimage
sudo docker image build -t tag(dockerçš„tag) .(åŸºäºé‚£ä¸ªç›®å½•æ„å»º)
sudo docker build -t tag(dockerçš„tag) .(åŸºäºé‚£ä¸ªç›®å½•æ„å»º)
#ä¾‹å­
sudo docker build -t dockerusernull/flask-hello-world /home/null/Code/docker/helloworld/</code></pre>
<p><strong>è°ƒè¯•</strong></p>
<p>æ¯æ¬¡æ„å»ºçš„æ—¶å€™ï¼Œåœ¨æ¯ä¸€å±‚éƒ½ä¼šç”Ÿæˆä¸´æ—¶å®¹å™¨å¹¶é€šè¿‡<code>--&gt;</code>æ˜¾ç¤ºå‡ºè¯¥å®¹å™¨çš„idï¼Œå¯ä»¥é€šè¿‡</p>
<pre><code class="bash">sudo docker run -it ä¸´æ—¶å®¹å™¨id /bin/bash</code></pre>
<p><strong>è¿è¡Œ</strong></p>
<pre><code class="bash">sudo docker run imageåå­—
sudo docker run -d imageåå­—#åå°è¿è¡Œ
sudo docker run -d --name=demo imageåå­—#åå°è¿è¡Œ å¹¶æŒ‡å®šä¸€ä¸ªåå­— å¦åˆ™ä¼šè‡ªåŠ¨åˆ†é…
#åœæ­¢contaniner
sudo docker container stop id
sudo docker stop id
#å¯åŠ¨contaniner
sudo docker start idæˆ–åå­—
#ä¾‹å­
sudo docker run dockerusernull/flask-hello-world</code></pre>
<ul>
<li><code>--name</code>æŒ‡å®šçš„åå­—å…·æœ‰å”¯ä¸€æ€§ï¼Œå¯ä»¥æ›¿ä»£idç”¨äºåˆ«çš„å‘½ä»¤</li>
<li><code>docker start</code>ï¼šåªè¦ä¸åˆ é™¤ï¼Œè¯¥å‘½ä»¤å°±èƒ½å¤Ÿé‡æ–°å¯åŠ¨stopçš„å®¹å™¨</li>
</ul>
<p><strong>exec</strong>ï¼šè¿›è¿è¡Œä¸­çš„å®¹å™¨å†…éƒ¨ï¼Œçœ‹å…·ä½“çš„ç»†èŠ‚</p>
<pre><code class="bash">sudo docker exec -it å®¹å™¨id /bin/bash#execï¼šå¯¹è¿è¡Œä¸­çš„å®¹å™¨æ‰§è¡Œçš„å‘½ä»¤(/bin/bash) -itï¼šäº¤äº’å¼çš„æ‰§è¡Œ
sudo docker exec -it å®¹å™¨id ip a#æ‰“å°è¿è¡Œä¸­çš„å®¹å™¨çš„ipåœ°å€</code></pre>
<ul>
<li>ä¸æ­¢è¿è¡Œ/bin/bashï¼Œè¿˜å¯è¿è¡Œå…¶ä»–å‘½ä»¤ï¼Œå¦‚ï¼špythonç­‰</li>
</ul>
<h3 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h3><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/" target="_blank" rel="noopener">https://docs.docker.com/develop/develop-images/dockerfile_best-practices/</a></p>
<ul>
<li><p><code>FROM</code>ï¼šé€‰æ‹©base imageï¼Œåœ¨è¯¥base imageä¸Šæ„å»ºæ–°çš„image</p>
<ul>
<li><code>FROM scratch</code>ï¼šä»å¤´åˆ¶ä½œbase image</li>
<li>å°½é‡ä½¿ç”¨å®˜æ–¹çš„imageä½œä¸º base image</li>
</ul>
</li>
<li><p><code>LABEL</code>ï¼šå®šä¹‰imageçš„metadataï¼ˆç±»ä¼¼ä»£ç ä¸­çš„æ³¨é‡Šï¼‰</p>
<ul>
<li><pre><code class="dockerfile">  LABEL maintainer=&quot;xiaoquwl@gmail.com&quot;
  LABEL version=&quot;1.0&quot;
  LABEL description=&quot;This is description&quot;</code></pre>
</li>
<li><p>ä¸å¯å°‘ï¼Œèƒ½å¤Ÿè®©äººæ›´åŠ æ˜ç™½</p>
</li>
</ul>
</li>
<li><p><code>RUN</code>ï¼šè¿è¡Œå‘½ä»¤ï¼Œæ¯ä¸€æ¬¡RUNéƒ½ä¼šä½¿imageç”Ÿæˆæ–°çš„ä¸€å±‚</p>
<ul>
<li><p>ä¸ºäº†ç¾è§‚,å¤æ‚çš„RUNè¯·ç”¨åæ–œçº¿æ¢è¡Œ</p>
</li>
<li><p>é¿å…æ— ç”¨åˆ†å±‚,åˆå¹¶å¤šæ¡å‘½ä»¤æˆä¸€è¡Œ</p>
</li>
<li><pre><code class="dockerfile">  RUN yum update &amp;&amp; yum install -y vim \
      python-dev#åæ–œçº¿æ¢è¡Œ
  RUN apt-get update &amp;&amp; apt-get install -y perl \
      pwgen --no-install-recommends &amp;&amp; rm -rf \
      /var/ib/apt/ists/*#æ³¨æ„æ¸…ç† cache 
  RUN /bin/bash -c &#39;source $HOME/.bashrc; echo $HOME&#39;</code></pre>
</li>
</ul>
</li>
<li><p><code>WORKDIR</code>ï¼šè®¾å®šå½“å‰å·¥ä½œç›®å½•ï¼ˆç±»ä¼¼äºcdï¼‰</p>
<ul>
<li><pre><code class="dockerfile">  WORKDIR /test#å¦‚æœæ²¡æœ‰ä¼šè‡ªåŠ¨åˆ›å»ºtestç›®å½•
  WORKDIR demo
  RUN pwd#è¾“å‡ºç»“æœåº”è¯¥æ˜¯/test/demo</code></pre>
</li>
<li><p>ç”¨ <code>WORKDIR</code>,ä¸è¦ç”¨ <code>RUN cd</code></p>
</li>
<li><p>å°½é‡ä½¿ç”¨ç»å¯¹ç›®å½•</p>
</li>
</ul>
</li>
<li><p><code>ADD</code>å’Œ<code>COPY</code>ï¼šæŠŠæœ¬åœ°çš„ä¸€äº›æ–‡ä»¶æ·»åŠ åˆ°docker imageä¸­</p>
<ul>
<li><p>ADDé™¤äº†æ‹·è´çš„åŠŸèƒ½å¤–è¿˜èƒ½å¤Ÿè§£å‹ç¼©</p>
</li>
<li><p>å¤§éƒ¨åˆ†æƒ…å†µ,COPYä¼˜äºADD</p>
</li>
<li><p>æ·»åŠ è¿œç¨‹æ–‡ä»¶/ç›®å½•è¯·ä½¿ç”¨curlæˆ–è€…wget</p>
</li>
<li><pre><code class="dockerfile">  ADd hello /#ç®€å•æ‹·è´
  ADD test.tar.gz /#æ·»åŠ åˆ°æ ¹ç›®å½•å¹¶è§£å‹
  #WORKDIRå’ŒADDè”åˆä½¿ç”¨
  WORKDIR /root
  ADD hello test/ #helloæ–‡ä»¶ä½ç½®/root/test/hello 
  WORKDIR /root
  COPY hello test/ #helloæ–‡ä»¶ä½ç½®/root/test/hello </code></pre>
</li>
</ul>
</li>
<li><p><code>ENV</code>ï¼šè®¾ç½®ä¸€ä¸ªç¯å¢ƒå˜é‡æˆ–å¸¸é‡</p>
<ul>
<li><p>å°½é‡ä½¿ç”¨ENVå¢åŠ å¯ç»´æŠ¤æ€§</p>
</li>
<li><pre><code class="dockerfile">  ENV MYSQL_VERSION 5.6#è®¾ç½®å¸¸é‡
  RUN apt-get install -y mysql-server=&quot;${MYSQL_VERSION}&quot; \
      &amp;&amp; rm -rf /var/lib/apt/lists/*#å¼•ç”¨å¸¸é‡</code></pre>
</li>
</ul>
</li>
<li><p><code>VOLUME</code>å’Œ<code>EXPOSE</code>ï¼šä¸»è¦ç”¨äºå­˜å‚¨å’Œç½‘ç»œ</p>
<ul>
<li><code>VOLUME</code>ï¼šæŒ‡å®šåœ¨å®¹å™¨ä¸­æŸä¸€ä¸ªç›®å½•ä¸­äº§ç”Ÿçš„æ•°æ®ï¼ŒåŒæ—¶æŒ‚è½½åˆ°Linuxä¸»æœºä¸­çš„æŸä¸€ä¸ªç›®å½•ä¸Šï¼Œå¹¶ä¸”ä¼šåˆ›å»ºä¸€ä¸ªdocker volumeçš„å¯¹è±¡</li>
<li><code>EXPOSE</code>ï¼šä¼šå°†è¿è¡Œä¸­çš„containerä¸­çš„ç«¯å£æš´éœ²å‡ºæ¥</li>
</ul>
</li>
<li><p>shellå’Œexecæ ¼å¼</p>
<ul>
<li><p>shellæ ¼å¼ï¼šåé¢æ˜¯shellå‘½ä»¤</p>
<ul>
<li><pre><code class="dockerfile">  RUN apt-get install -y vim
  CMD echo &quot;hello docker&quot;
  ENTRYPOINT echo &quot;hello docker&quot;</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>* execæ ¼å¼ï¼šéœ€è¦æ ¹æ®ç‰¹ç‚¹çš„æ ¼å¼æŒ‡å‡ºå‘½ä»¤å’Œå‚æ•°

    * ```dockerfile
        #XXX [&quot;å‘½ä»¤&quot;,&quot;å‚æ•°&quot;,...]
        RUN [&quot;apt-get&quot;,&quot;install&quot;,&quot;-y&quot;,&quot;vim&quot;]
        CMD [&quot;/bin/echo&quot;,&quot;hello docker&quot;]
        ENTRYPOINT [&quot;/bin/echo&quot;,&quot;hello docker&quot;]
        #ä»¥ä¸‹ä¸¤ç§è¾“å‡ºç»“æœä¸ä¸€æ ·
        ENV name Docker
        ENTRYPOINT [&quot;/bin/echo&quot;,&quot;hello $name&quot;]#hello $name
        ENTRYPOINT [&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;echo hello $name&quot;]#hello Docker(-cè¡¨ç¤ºåé¢çš„äº‹bashçš„å‚æ•°)
        ```</code></pre><ul>
<li><p><code>CMD</code>å’Œ<code>ENTRYPOINT</code>ï¼š</p>
<ul>
<li><p><code>RUN</code>:æ‰§è¡Œå‘½ä»¤å¹¶åˆ›å»ºæ–°çš„ image Layer</p>
</li>
<li><p><code>CMD</code>:è®¾ç½®å®¹å™¨å¯åŠ¨åé»˜è®¤æ‰§è¡Œçš„å‘½ä»¤å’Œå‚æ•°</p>
<ul>
<li>å®¹å™¨å¯åŠ¨æ—¶é»˜è®¤æ‰§è¡Œçš„å‘½ä»¤</li>
<li>å¦‚æœ docker runæŒ‡å®šäº†å…¶å®ƒå‘½ä»¤,CMDå‘½ä»¤è¢«å¿½ç•¥<ul>
<li>æ­¤å¤„docker runæŒ‡<code>docker run é•œåƒå</code>ï¼Œå†åŠ ä»»æ„ä¸€ä¸ªå‚æ•°å‡ä¼šå¿½ç•¥CMDå‘½ä»¤ï¼Œå¦‚<code>docker run -it é•œåƒå /bin/bash</code></li>
</ul>
</li>
<li>å¦‚æœå®šä¹‰äº†å¤šä¸ªCMD,åªæœ‰æœ€åä¸€ä¸ªä¼šæ‰§è¡Œ</li>
</ul>
</li>
<li><p><code>ENTRYPOINT</code>:è®¾ç½®å®¹å™¨å¯åŠ¨æ—¶è¿è¡Œçš„å‘½ä»¤</p>
<ul>
<li><p>è®©å®¹å™¨ä»¥åº”ç”¨ç¨‹åºæˆ–è€…æœåŠ¡çš„å½¢å¼è¿è¡Œ</p>
</li>
<li><p>ä¸ä¼šè¢«å¿½ç•¥,ä¸€å®šä¼šæ‰§è¡Œ</p>
</li>
<li><pre><code class="dockerfile">  #æ‰§è¡Œä¸€ä¸ªshelè„šæœ¬
  COPY docker-entrypoint.sh /usr/local/bin/ 
  ENTRYPOINT [&quot;docker-entrypoint sh&quot;]</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="å‘å¸ƒé•œåƒ"><a href="#å‘å¸ƒé•œåƒ" class="headerlink" title="å‘å¸ƒé•œåƒ"></a>å‘å¸ƒé•œåƒ</h3><p>ç›´æ¥å‘å¸ƒé•œåƒï¼š</p>
<ul>
<li><p>åœ¨<a href="https://hub.docker.com/" target="_blank" rel="noopener">DockerHub</a>ç½‘ç«™ä¸Šæ³¨å†Œè´¦å·</p>
</li>
<li><p><code>sudo docker login</code>ï¼Œåœ¨æœ¬æœºä¸Šé€šè¿‡å‘½ä»¤è¡Œç™»å½•DockerHub</p>
</li>
<li><p><code>sudo docker push è´¦å·å/imageåå­—:tag</code>æˆ–<code>sudo push è´¦å·å/imageåå­—:tag</code>å¾€DockerHubä¸Šæ¨</p>
</li>
</ul>
<p>å‘å¸ƒDockerfileï¼š</p>
<ul>
<li>åœ¨DockerHubä¸Šç»‘å®šGithubè´¦å·</li>
<li>åœ¨GitHubä¸Šåˆ†äº«Dockerfile</li>
<li>DockerHubä¼šè‡ªåŠ¨ä»GitHubä¸Šå…‹éš†Dockerfile</li>
<li>DockerHubåå°æœåŠ¡å™¨ä¼šè‡ªåŠ¨æ ¹æ®Dockerfileæ„å»ºimage</li>
</ul>
<h3 id="å®¹å™¨èµ„æºé™åˆ¶"><a href="#å®¹å™¨èµ„æºé™åˆ¶" class="headerlink" title="å®¹å™¨èµ„æºé™åˆ¶"></a>å®¹å™¨èµ„æºé™åˆ¶</h3><p>ä¸åšé™åˆ¶çš„å®¹å™¨ä¼šå°½æœ€å¤§å¯èƒ½å ç”¨ç‰©ç†æœºçš„èµ„æºï¼Œå¯ä»¥é€šè¿‡<code>docker run</code>å‘½ä»¤æŒ‡å®šå¯¹å®¹å™¨çš„é™åˆ¶</p>
<ul>
<li>å¯¹memoryçš„é™åˆ¶<ul>
<li><code>--memory</code>ï¼šè‹¥åªæŒ‡å®šè¯¥å‚æ•°ï¼Œåˆ™swap memoryä¹Ÿæ˜¯åŒæ ·å¤§å°ï¼Œæ€»å…±æ¶ˆè€—å†…å­˜ä¸º2*memory<ul>
<li>egï¼šsudo docker run â€“memory=200M å®¹å™¨id</li>
</ul>
</li>
<li><code>--memory-swap</code>ï¼šæŒ‡å®šswap memoryå‚æ•°</li>
</ul>
</li>
<li>å¯¹cpuçš„é™åˆ¶<ul>
<li><code>--cpu-shares</code>ï¼šé™åˆ¶ç›¸å¯¹æƒé‡ï¼Œå³æ¯ä¸ªå®¹å™¨æ ¹æ®è¯¥å€¼æ¥åˆ†é…ç‰©ç†æœºä¸Šçš„cpuç®—åŠ›<ul>
<li>sudo docker run â€“cpu-shares=10 â€“name=test1 å®¹å™¨id â€“cpu 1</li>
<li>sudo docker run â€“cpu-shares=5 â€“name=test2 å®¹å™¨id â€“cpu 1</li>
<li>ä¸Šè¿°ä¸¤ä¸ªå®¹å™¨ä¼šæŒ‰ç…§test1ï¼štest2=2ï¼š1å ç”¨cpu</li>
</ul>
</li>
<li><code>--cpu</code>ï¼šåˆ©ç”¨ç¼–å·æŒ‡å®šè¿è¡Œçš„cpu</li>
</ul>
</li>
</ul>
<h3 id="å®æˆ˜â€”â€”ubuntuä¸Šæ‰“åŒ…stress"><a href="#å®æˆ˜â€”â€”ubuntuä¸Šæ‰“åŒ…stress" class="headerlink" title="å®æˆ˜â€”â€”ubuntuä¸Šæ‰“åŒ…stress"></a>å®æˆ˜â€”â€”ubuntuä¸Šæ‰“åŒ…stress</h3><h4 id="pythonå¸¸é©»ç¨‹åº"><a href="#pythonå¸¸é©»ç¨‹åº" class="headerlink" title="pythonå¸¸é©»ç¨‹åº"></a>pythonå¸¸é©»ç¨‹åº</h4><p>æ–°å»ºDockerfileï¼š</p>
<pre><code class="dockerfile">FROM python:2.7
LABEL maintainer=&quot;NULL&quot;

WORKDIR /pyapp

RUN pip install flask
COPY app.py /pyapp
EXPOSE 5000
CMD python app.py</code></pre>
<ul>
<li><code>EXPOSE</code>ï¼šåœ¨æ­¤å¤„ä»£è¡¨è¦æš´éœ²å‡ºå»çš„ç«¯å£</li>
<li><code>CMD</code>ï¼šæ­¤å¤„ç”¨äºè¡¨ç¤ºä¹‹åä¸€ç›´è¿è¡Œçš„ç¨‹åº</li>
</ul>
<h4 id="ubuntuä¸Šæ‰“åŒ…stress"><a href="#ubuntuä¸Šæ‰“åŒ…stress" class="headerlink" title="ubuntuä¸Šæ‰“åŒ…stress"></a>ubuntuä¸Šæ‰“åŒ…stress</h4><p>æ–°å»ºDockerfileï¼š</p>
<pre><code class="dockerfile">FROM ubuntu
RUN apt-get updata &amp;&amp; apt-get install -y stress
ENTRYPOINT [&quot;/user/bin/stress&quot;]
CMD []</code></pre>
<ul>
<li><code>ENTRYPOINT</code>ï¼šåœ¨æ­¤å¤„ä»£è¡¨è¦æ‰§è¡Œçš„å‘½ä»¤</li>
<li><code>CMD</code>ï¼šæ­¤å¤„ç”¨äºæ¥å—ä¹‹ådocker runåçš„å‚æ•°ï¼Œä¼ é€’ç»™<code>ENTRYPOINT</code>æŒ‡å®šçš„å‘½ä»¤<ul>
<li>å¯ä»¥åœ¨<code>[]</code>ä¸­æŒ‡å®šé»˜è®¤çš„å‚æ•°</li>
</ul>
</li>
</ul>
<h2 id="ä¸‰ã€dockerç½‘ç»œ"><a href="#ä¸‰ã€dockerç½‘ç»œ" class="headerlink" title="ä¸‰ã€dockerç½‘ç»œ"></a>ä¸‰ã€dockerç½‘ç»œ</h2><p>dockerç½‘ç»œåˆ†ç±»ï¼š</p>
<ul>
<li>å•æœºç½‘ç»œ<ul>
<li><strong>Bridge Network</strong></li>
<li>Host Network</li>
<li>None Network</li>
</ul>
</li>
<li>å¤šæœºç½‘ç»œ<ul>
<li>Overlay Network</li>
</ul>
</li>
</ul>
<h3 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><p>æ•´ä¸ªç½‘ç»œçš„æ•°æ®ä¼ è¾“æ˜¯é€šè¿‡<strong>æ•°æ®åŒ…</strong>çš„å½¢å¼æ¥ä¼ è¾“çš„</p>
<p>æ•°æ®åŒ…çš„æ‰“åŒ…æœ‰ä¸€ä¸ªåˆ†å±‚çš„æ¦‚å¿µï¼Œå³ISO/OSIçš„ä¸ƒå±‚æ¨¡å‹å’ŒTCP/IPçš„äº”å±‚æ¨¡å‹ï¼š</p>
<p><img src="//NU-LL.github.io/2020/01/16/Docker/image-20200209142623011.png" alt="ç½‘ç»œåˆ†å±‚"></p>
<p>æ•°æ®åŒ…åˆ°è¾¾å¦ä¸€å°ç”µè„‘æˆ–æœåŠ¡å™¨ï¼Œéœ€è¦é€šè¿‡<strong>è·¯ç”±</strong></p>
<p>IPåœ°å€ï¼šè®¾å¤‡çš„æ ‡è¯†</p>
<ul>
<li>å…¬æœ‰IPï¼šäº’è”ç½‘ä¸Šçš„å”¯ä¸€æ ‡è¯†,å¯ä»¥è®¿é—® Internet</li>
<li>ç§æœ‰IPï¼šä¸å¯åœ¨äº’è”ç½‘ä¸Šä½¿ç”¨,ä»…ä¾›æœºæ„å†…éƒ¨ä½¿ç”¨</li>
<li>ABCä¸‰ç±»ipåœ°å€ï¼š<a href="https://blog.csdn.net/kzadmxz/article/details/73658168" target="_blank" rel="noopener">https://blog.csdn.net/kzadmxz/article/details/73658168</a></li>
</ul>
<p>ç§æœ‰IPåœ°å€è®¿é—®äº’è”ç½‘ï¼Œéœ€è¦<strong>ç½‘ç»œåœ°å€è½¬æ¢</strong>ï¼Œå³<strong>NAT</strong></p>
<p><img src="//NU-LL.github.io/2020/01/16/Docker/image-20200209150545483.png" alt="ç½‘ç»œåœ°å€è½¬æ¢"></p>
<p>Linuxå‘½ä»¤ï¼š</p>
<ul>
<li><code>ping</code>ï¼š<strong>æ£€æŸ¥ipçš„å¯è¾¾æ€§</strong>ï¼Œpingä¸é€šä¸èƒ½ä¿è¯æœºå™¨å‡ºé—®é¢˜äº†ï¼Œå¯èƒ½æ˜¯ä¸­é—´è·¯ç”±æˆ–è€…é˜²ç«å¢™ç­‰å…¶ä»–æŸä¸€ç¯èŠ‚å‡ºé—®é¢˜äº†</li>
<li><code>telnet</code>ï¼š<strong>æ£€æŸ¥æœåŠ¡çš„å¯ç”¨æ€§</strong></li>
</ul>
<h3 id="Linuxä¸­network-namespace"><a href="#Linuxä¸­network-namespace" class="headerlink" title="Linuxä¸­network namespace"></a>Linuxä¸­network namespace</h3><p>æ¯åˆ›å»ºä¸€ä¸ªcontainerï¼Œä¼šåŒæ—¶åˆ›å»ºä¸€ä¸ªnetwork namespace</p>
<pre><code class="bash">#æŸ¥çœ‹æœ¬æœºnetwork namespace
sudo ip netns list
#åˆ é™¤æœ¬æœºnetwork namespace
sudo ip netns delete xxxx
#æ·»åŠ network namespace
sudo ip netns add xxxx
#åœ¨xxxxè¿™ä¸ªnetwork namespaceä¸­æ‰§è¡Œå‘½ä»¤
sudo ip netns exec xxxx ip a
sudo ip netns exec xxxx ip link
sudo ip netns exec xxxx ip link set dev lo up#å°†xxxxä¸­çš„loç½‘å¡up</code></pre>
<p>å…¶ä»–ç›¸å…³å‘½ä»¤å’ŒçŸ¥è¯†å¯ä»¥å‚è€ƒ<a href="https://cizixs.com/2017/02/10/network-virtualization-network-namespace/" target="_blank" rel="noopener">è¿™ç¯‡åšå®¢</a>ï¼Œå¦‚é“¾æ¥æ¶ˆå¤±ï¼Œå¯è§æˆ‘åšå®¢ä¸­çš„å¤‡ä»½</p>
<h3 id="Docker-Bridge0è¯¦è§£"><a href="#Docker-Bridge0è¯¦è§£" class="headerlink" title="Docker Bridge0è¯¦è§£"></a>Docker Bridge0è¯¦è§£</h3><p>å³bridge Networkã€‚</p>
<p>å»ºè®®å‚è€ƒä¸Šä¸€å°èŠ‚ä¸­æåˆ°çš„åšå®¢</p>
<pre><code class="bash">#åˆ—å‡ºå½“å‰dockerä¸­æœ‰å“ªäº›ç½‘ç»œ
sudo docker network ls
#åˆ—å‡ºbridgeçš„è¯¦ç»†æƒ…å†µï¼Œé€šè¿‡Containersä¸€æ å¯ä»¥çœ‹å‡ºå“ªä¸ªcontainerè¿æ¥ä¸Šè¯¥bridge
sudo docker network inspect bridge
#åˆ—å‡ºæœ¬æœºä¸Šbridgeçš„ç›¸å…³ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡è¯¥å‘½ä»¤çœ‹å‡ºdocker0ç½‘å¡æ¥ä¸Šäº†é‚£ä¸ªvethæ¥å£
brctl show</code></pre>
<p>ä¸¤ä¸ªå®¹å™¨ä¹‹é—´ç›¸äº’é€šä¿¡çš„æƒ…å†µï¼š</p>
<p><img src="//NU-LL.github.io/2020/01/16/Docker/image-20200210150411463.png" alt="image-20200210150411463"></p>
<ul>
<li>è“è‰²æ¡†æ¡†ä¸ºä¸¤ä¸ªå®¹å™¨</li>
<li>ç»¿è‰²çš„ä¸€å¯¹ä¸ºvethï¼ˆè™šæ‹Ÿç½‘ç»œæ¥å£ï¼‰</li>
<li>dockerå®¹å™¨ä¸­ä¼šè¿æ¥åˆ°ä¸»æœºçš„docker0ç½‘å¡ä¸Š</li>
</ul>
<p>å•ä¸ªå®¹å™¨è®¿é—®internetçš„æƒ…å†µï¼š</p>
<p><img src="//NU-LL.github.io/2020/01/16/Docker/image-20200210150701170.png" alt="image-20200210150701170"></p>
<ul>
<li>ä¸»æœºé€šè¿‡eth0è®¿é—®å¤–ç½‘</li>
<li>docker0ä¸­çš„æ•°æ®é€šè¿‡NATï¼ˆç½‘ç»œåœ°å€è½¬æ¢ï¼‰è½¬æ¢åˆ°eth0ä¸­</li>
<li>è¿™é‡Œçš„NATæ˜¯é€šè¿‡iptableså®ç°</li>
</ul>
<h3 id="dockerä¹‹é—´çš„link"><a href="#dockerä¹‹é—´çš„link" class="headerlink" title="dockerä¹‹é—´çš„link"></a>dockerä¹‹é—´çš„link</h3><p>å³é€šè¿‡<code>link</code>æŒ‡ä»¤ï¼Œå¯ä»¥å°†ä¸€ä¸ªå®¹å™¨åªéœ€æŒ‡å®šå¯¹æ–¹å®¹å™¨åå­—å°±å¯ä»¥é“¾æ¥åˆ°å¦ä¸€ä¸ªå®¹å™¨ä¸Šï¼Œè€Œæ— éœ€æŒ‡å®šIPåœ°å€åŠç«¯å£ã€‚æ³¨æ„ï¼ŒlinkæŒ‡ä»¤å«æœ‰æ–¹å‘ï¼Œåªèƒ½å•å‘é“¾æ¥</p>
<p>è¯¥æŒ‡ä»¤å®é™…ä½¿ç”¨ä¸å¤š</p>
<p>ç›´æ¥ä¸Šä¾‹å­</p>
<pre><code class="bash">#åˆ›å»ºbusyboxå®¹å™¨test1
sudo docker run -d --name test1 busybox /bin/sh -c &quot;while true; do sleep 3600; done&quot;
#åˆ›å»ºbusyboxå®¹å™¨test2ï¼Œå¹¶è¿æ¥åˆ°test1
sudo docker run -d --name test2 --link test1 busybox /bin/sh -c &quot;while true; do sleep 3600; done&quot;
#è¿›å…¥test2ä¸­
sudo docker exec -it test2 /bin/sh
#åœ¨test2ä¸­ping test1(ip:172.17.0.3) æ— è®ºåå­—è¿˜æ˜¯ipå‡å¯
ping 172.17.0.3
ping test1
#åä¹‹ï¼Œè¿›å…¥test1
sudo docker exec -it test1 /bin/sh
#åœ¨test1ä¸­ping test2(ip:172.17.0.2) åªæœ‰ipå¯ä»¥
ping 172.17.0.2
ping test2#pingä¸é€š
ping 172.17.0.3
ping test1</code></pre>
<p>åˆ›å»ºä¸€ä¸ªæ–°çš„Bridgeå¹¶è¿æ¥ä¸ŠContainerï¼š</p>
<pre><code class="bash">#åˆ›å»ºä¸€ä¸ªæ–°çš„bridgeï¼Œå«my-bridgeï¼ˆ-dï¼šdriverï¼‰
sudo docker nerwork create -d bridge my-bridge
#æŸ¥çœ‹bridge
sudo docker network ls
brctl show#å’Œä¸Šä¸ªå‘½ä»¤ä¸€æ ·
#åˆ›å»ºbusyboxå®¹å™¨test3ï¼ŒæŒ‡å®šnetworkä¸ºmy-bridge
sudo docker run -d --name test3 --network my-bridge busybox /bin/sh -c &quot;while true; do sleep 3600; done&quot;
#æ˜¾ç¤ºbridgeåŠè¿æ¥çš„æƒ…å†µ
brctl show
#æ˜¾ç¤ºbridgeçš„è¯¦ç»†ä¿¡æ¯
sudo docker network inspect bridgeçš„id(é€šè¿‡sudo docker network lså’Œbrctl showå¯ä»¥æŸ¥çœ‹)
#å°†å…¶ä»–containerè¿æ¥åˆ°æ–°å»ºçš„bridgeä¸Š
sudo docker network connect my-bridge test2</code></pre>
<p>å¤šä¸ªå®¹å™¨è‹¥éƒ½è¿æ¥åœ¨äº†åŒä¸€ä¸ªç”¨æˆ·è‡ªå·±åˆ›å»ºçš„bridgeä¸Šï¼Œåˆ™å¯ä»¥<strong>ä¸éœ€é€šè¿‡é“¾æ¥</strong>å°±èƒ½å¤Ÿé€šè¿‡åå­—ç›´æ¥è®¿é—®</p>
<pre><code class="bash">#è¿›å…¥my-bridgeç»‘å®šçš„test3ä¸­ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡åå­—pingé€šåæ¥æ¥å…¥çš„test2(ip:192.18.0.3)
sudo docker rxrc -it test3 /bin/sh
ping 192.18.0.3
ping test2</code></pre>
<h3 id="ç«¯å£æ˜ å°„"><a href="#ç«¯å£æ˜ å°„" class="headerlink" title="ç«¯å£æ˜ å°„"></a>ç«¯å£æ˜ å°„</h3><p>å¦‚æœæƒ³è¦å°†dockerä¸­çš„ç«¯å£è½¬å‘ç»™å¤–éƒ¨ï¼š</p>
<pre><code class="bash">#å°†å®¹å™¨ä¸­çš„80ç«¯å£æ˜ å°„åˆ°æœ¬åœ°çš„80ç«¯å£
sudo docker run --name web -d -p 80:80 nginx
#æŸ¥çœ‹æ˜ å°„çš„ç«¯å£
sudo docker ps
#æ­¤æ—¶å¯ä»¥é€šè¿‡curlåœ¨å¤–éƒ¨ï¼ˆè™šæ‹Ÿæœºä¸Šï¼‰ç›´æ¥è®¿é—®å®¹å™¨å†…éƒ¨çš„ç«¯å£
curl 192.168.205.10</code></pre>
<p>ç¤ºæ„å›¾ï¼š</p>
<p><img src="//NU-LL.github.io/2020/01/16/Docker/image-20200211000724333.png" alt="image-20200211000724333"></p>
<ul>
<li>æ³¨ï¼šeth1åˆ°æœ¬åœ°ç½‘å¡ä¸Šçš„ç«¯å£è½¬å‘æ˜¯é€šè¿‡è®¾ç½®è™šæ‹Ÿæœºä¿®æ”¹è€Œæˆçš„</li>
</ul>
<h3 id="hostå’Œnoneç½‘ç»œ"><a href="#hostå’Œnoneç½‘ç»œ" class="headerlink" title="hostå’Œnoneç½‘ç»œ"></a>hostå’Œnoneç½‘ç»œ</h3><p>none networkï¼š</p>
<pre><code class="bash">#åˆ›å»ºbusyboxå®¹å™¨test1ï¼ŒæŒ‡å®šnetworkä¸ºnone
sudo docker run -d --name test1 --network none busybox /bin/sh -c &quot;while true; do sleep 3600; done&quot;
#æŸ¥çœ‹noneä¸Šè¿æ¥çš„container
sudo docker network inspect none
#è¿›å…¥containerä¸­
sudo docker exec -it test1 /bin/sh
#è¿è¡Œå‘½ä»¤
ip a#å‘ç°åªæœ‰lo</code></pre>
<ul>
<li>none networkè¡¨ç¤ºä¸€ç§å­¤ç«‹çš„ç½‘ç»œï¼Œé™¤äº†<code>sudo docker exec -it</code>å‘½ä»¤èƒ½å¤Ÿè®¿é—®ä¹‹å¤–ï¼Œä¸èƒ½é€šè¿‡å…¶ä»–æ–¹æ³•è®¿é—®</li>
</ul>
<p>host networkï¼š</p>
<pre><code class="bash">#åˆ›å»ºbusyboxå®¹å™¨test1ï¼ŒæŒ‡å®šnetworkä¸ºhost
sudo docker run -d --name test1 --network host busybox /bin/sh -c &quot;while true; do sleep 3600; done&quot;
#æŸ¥çœ‹hostä¸Šè¿æ¥çš„container
sudo docker network inspect host
#è¿›å…¥containerä¸­
sudo docker exec -it test1 /bin/sh
#è¿è¡Œå‘½ä»¤
ip a#å‘ç°æ­¤å¤„çš„ç½‘å¡å’ŒLinuxä¸»æœºä¸Šçš„ä¸€æ ·</code></pre>
<ul>
<li>host networkè¡¨ç¤ºè¯¥å®¹å™¨æ²¡æœ‰è‡ªå·±ç‹¬ç«‹çš„namespaceï¼Œæ ¹Linuxä¸»æœºä¸­çš„namespace networkå…±äº«åŒä¸€å¥—</li>
<li>å¯èƒ½ä¼šå’ŒLinuxä¸»æœºä¸Šçš„ä¸€äº›ç«¯å£å­˜åœ¨å†²çª</li>
</ul>
<h3 id="å¤šæœºé€šä¿¡"><a href="#å¤šæœºé€šä¿¡" class="headerlink" title="å¤šæœºé€šä¿¡"></a>å¤šæœºé€šä¿¡</h3><p>ä¸ºå®ç°å¦‚ä¸‹æ•ˆæœï¼š</p>
<p><img src="//NU-LL.github.io/2020/01/16/Docker/image-20200211004225893.png" alt="å¤šæœºé€šä¿¡"></p>
<ul>
<li>ä¸¤ä¸ªdockerçš„ipåœ°å€éœ€è¦ä¸ä¸€æ ·</li>
<li>è¿ç”¨VXLANæŠ€æœ¯</li>
<li>é€šè¿‡overlay networkå®ç°ï¼Œåˆ›å»ºoverlayä¸bridgeã€hostã€noneä¸€è‡´</li>
<li>éœ€è¦ç”¨åˆ°åˆ†å¸ƒå¼å­˜å‚¨æŠ€æœ¯ï¼ˆé‡‡ç”¨etcdï¼‰ï¼Œç”¨äºåœ¨å•æœºä¸Šå æ®ipåœ°å€</li>
</ul>
<h2 id="å››ã€Dockerçš„æŒä¹…åŒ–å­˜å‚¨å’Œæ•°æ®å…±äº«"><a href="#å››ã€Dockerçš„æŒä¹…åŒ–å­˜å‚¨å’Œæ•°æ®å…±äº«" class="headerlink" title="å››ã€Dockerçš„æŒä¹…åŒ–å­˜å‚¨å’Œæ•°æ®å…±äº«"></a>å››ã€Dockerçš„æŒä¹…åŒ–å­˜å‚¨å’Œæ•°æ®å…±äº«</h2><p>å›é¡¾ä¹‹å‰è®²çš„Containerï¼ŒContainerå…·æœ‰å¯è¯»å¯å†™çš„èƒ½åŠ›ï¼Œimageåªå…·æœ‰å¯è¯»çš„èƒ½åŠ›ã€‚ä½†æ˜¯åœ¨stopå†rm Containerä¹‹åï¼ŒContainerä¸­çš„æ•°æ®ä¸ä¼šä¿å­˜ï¼ŒContainerä¸­çš„æ•°æ®ç›¸å½“äºä¸€ä¸ªä¸´æ—¶çš„æ•°æ®</p>
<p><img src="//NU-LL.github.io/2020/01/16/Docker/image-20200205001054091.png" alt="Container"></p>
<p>dockeræŒä¹…åŒ–æ•°æ®çš„æ–¹æ¡ˆåˆ†ä»¥ä¸‹ä¸¤ç§ï¼š</p>
<ul>
<li>åŸºäº<strong>æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ</strong>çš„ Volume.å¯ä»¥åœ¨æ‰§è¡Œ Docker createæˆ– Docker runæ—¶,é€šè¿‡<code>-v</code>å‚æ•°å°†ä¸»æœºçš„ç›®å½•ä½œä¸ºå®¹å™¨çš„æ•°æ®å·.è¿™éƒ¨åˆ†åŠŸèƒ½ä¾¿æ˜¯åŸºäºæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„ volumeç®¡ç†.</li>
<li>åŸºäº<strong>plugin</strong>çš„ Volume,æ”¯æŒç¬¬ä¸‰æ–¹çš„å­˜å‚¨æ–¹æ¡ˆ,æ¯”å¦‚NASï¼Œaws</li>
</ul>
<p>Volumeçš„ç±»å‹ï¼š</p>
<ul>
<li>å—ç®¡ç†çš„ data Volume,ç”± dockeråå°è‡ªåŠ¨åˆ›å»º.</li>
<li>ç»‘å®šæŒ‚è½½çš„ Volume,å…·ä½“æŒ‚è½½ä½ç½®å¯ä»¥ç”±ç”¨æˆ·æŒ‡å®š.</li>
</ul>
<h3 id="Data-Volume"><a href="#Data-Volume" class="headerlink" title="Data Volume"></a>Data Volume</h3><p>åœºæ™¯ï¼šä¸€èˆ¬æ¥è¯´æœ‰äº›å®¹å™¨è‡ªå·±ä¼šäº§ç”Ÿä¸€äº›æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯è¿™äº›æ•°æ®çš„å®‰å…¨ï¼Œä¸æƒ³éšç€containerçš„æ¶ˆå¤±è€Œæ¶ˆå¤±ï¼Œæ¯”å¦‚è¯´æ•°æ®åº“ç­‰ï¼Œé€šè¿‡Dockerfileä¸­çš„<code>VOLUME</code>å…³é”®å­—å®ç°ã€‚</p>
<pre><code class="bash">#åˆ›å»ºmysql container(mysqlçš„Dockerfileä¸­æœ‰ï¼šVOLUME /var/lib/mysql),åˆå§‹å¯†ç ä¸ºç©ºï¼Œå°†åœ¨/var/lib/mysqlå¤„äº§ç”Ÿçš„volumeé‡å‘½åä¸ºmysql(å°†mysql volumeæ˜ å°„åˆ°containerä¸­çš„/var/lib/mysqlç›®å½•)
sudo docker run -d -v mysql:/var/lib/mysql --name mysql1 -e MYSQL_ALLOW_EMPTY_PASSWORD=true mysql
sudo docker ps
#æŸ¥çœ‹volume
sudo docker volume ls
sudo docker volume ä¸Šä¸€æ­¥å‘½ä»¤æŸ¥çœ‹çš„id#ä¼šè‡ªåŠ¨æŒ‚è½½åˆ°/var/lib/docker/volumes/xxxx(id)/_data
#åˆ é™¤volume
sudo docker volume rm idæˆ–è€…-væŒ‡å®šçš„åå­—</code></pre>
<h3 id="Bind-Mounting"><a href="#Bind-Mounting" class="headerlink" title="Bind Mounting"></a>Bind Mounting</h3><p>bind Mountingä¸éœ€è¦åœ¨Dockerfileä¸­å®šä¹‰æ–‡ä»¶äº§ç”Ÿçš„è·¯å¾„ï¼Œåªéœ€åœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šå³å¯ï¼š</p>
<pre><code class="bash">#åˆ›å»ºå®¹å™¨ï¼Œå°†å½“å‰ç›®å½•$(pwd)æ˜ å°„åˆ°containerä¸­çš„/usr/share/nginx/htmlç›®å½•
sudo docker run -d -v $(pwd):/usr/share/nginx/html id</code></pre>
<h2 id="äº”ã€Docker-Composeå¤šå®¹å™¨éƒ¨ç½²"><a href="#äº”ã€Docker-Composeå¤šå®¹å™¨éƒ¨ç½²" class="headerlink" title="äº”ã€Docker Composeå¤šå®¹å™¨éƒ¨ç½²"></a>äº”ã€Docker Composeå¤šå®¹å™¨éƒ¨ç½²</h2><p>å®˜æ–¹é“¾æ¥ï¼š<a href="https://docs.docker.com/compose/" target="_blank" rel="noopener">https://docs.docker.com/compose/</a>ã€<a href="https://docs.docker.com/compose/compose-file/" target="_blank" rel="noopener">https://docs.docker.com/compose/compose-file/</a></p>
<p>å¤šå®¹å™¨çš„appä¼šå¸¦æ¥çš„ç¼ºç‚¹ï¼š</p>
<ul>
<li>è¦ä» Dockerfile build imageæˆ–è€… Dockerhubæ‹‰å– image</li>
<li>è¦åˆ›å»ºå¤šä¸ª container</li>
<li>è¦ç®¡ç†è¿™äº› container(å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤)</li>
</ul>
<p>Docker Composeçš„è¯ç”Ÿå°±æ˜¯ä¸ºäº†è§£å†³è¯¥é—®é¢˜ï¼Œå¯ä»¥çœ‹æˆæ˜¯æ‰¹å¤„ç†</p>
<ul>
<li>Docker Composeæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·</li>
<li>è¿™ä¸ªå·¥å…·å¯ä»¥é€šè¿‡ä¸€ä¸ª<code>yml</code>æ–‡ä»¶å®šä¹‰å¤šå®¹å™¨çš„ dockeråº”ç”¨</li>
<li>é€šè¿‡ä¸€æ¡å‘½ä»¤å°±å¯ä»¥æ ¹æ®<code>yml</code>æ–‡ä»¶çš„å®šä¹‰å»åˆ›å»ºæˆ–è€…ç®¡ç†è¿™å¤šä¸ªå®¹å™¨</li>
</ul>
<p>ymlæ–‡ä»¶é»˜è®¤åï¼š<code>docker-compose.yml</code>ï¼ŒåŒ…å«ä¸‰ä¸ªé‡è¦æ¦‚å¿µï¼šServicesã€Networksã€Volumes</p>
<p>Servicesï¼š</p>
<ul>
<li><p>ä¸€ä¸ª serviceä»£è¡¨ä¸€ä¸ª container,è¿™ä¸ª containerå¯ä»¥ä»dockerhubçš„imageæ¥åˆ›å»º,æˆ–è€…ä»æœ¬åœ°çš„ Dockerfile buildå‡ºæ¥çš„imageæ¥åˆ›å»º</p>
</li>
<li><p>Serviceçš„å¯åŠ¨ç±»ä¼¼ docker run,æˆ‘ä»¬å¯ä»¥ç»™å…¶æŒ‡å®šnetworkå’Œ volume,æ‰€ä»¥å¯ä»¥ç»™ serviceæŒ‡å®š networkå’ŒVolumeçš„å¼•ç”¨ï¼ˆserviceä¸­çš„å‚æ•°å’Œdocker runä¸­çš„å‚æ•°ç±»ä¼¼ï¼‰</p>
<pre><code class="yaml">  services:
    db:#servicesåå­—
      image:postgres:9.4#é‡‡ç”¨çš„image
      volumes:
        - â€œdb-data:/var/lib/postgresql/dataâ€
      network:#æ–°å»ºçš„bridge
       - back-tier</code></pre>
<pre><code class="yaml">  services:
    worker:
      build:./worker
      links:#æœ‰äº†networkï¼Œlinkså¯æœ‰å¯æ— 
        - db
        - redis
      network:
       - back-tier</code></pre>
</li>
</ul>
<p>å®ä¾‹ï¼š</p>
<pre><code class="yaml">version: &#39;3&#39;

services:

  wordpress:
    image: wordpress
    ports:
      - 8080:80
    environment:
      WORDPRESS_DB_HOST: mysql
      WORDPRESS_DB_PASSWORD: root
    networks:
      - my-bridge

  mysql:
    image: mysql
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: wordpress
    volumes:
      - mysql-data:/var/lib/mysql
    networks:
      - my-bridge

volumes:
  mysql-data:

networks:
  my-bridge:
    driver: bridge</code></pre>
<h3 id="å®‰è£…å’ŒåŸºæœ¬ä½¿ç”¨"><a href="#å®‰è£…å’ŒåŸºæœ¬ä½¿ç”¨" class="headerlink" title="å®‰è£…å’ŒåŸºæœ¬ä½¿ç”¨"></a>å®‰è£…å’ŒåŸºæœ¬ä½¿ç”¨</h3><p>å®‰è£…ï¼š</p>
<ul>
<li><p>docker for macæˆ–windows ä¼šè‡ªåŠ¨å®‰è£…</p>
</li>
<li><p>Linuxå®‰è£…æ­¥éª¤ï¼š<a href="https://docs.docker.com/compose/install/" target="_blank" rel="noopener">https://docs.docker.com/compose/install/</a></p>
<pre><code class="bash">  #ä¸‹è½½è‡³/usr/local/bin/docker-compose
  sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.25.3/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose
  #æ·»åŠ å¯æ‰§è¡Œæƒé™
  sudo chmod +x /usr/local/bin/docker-compose
  #æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯ éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ
  docker-compose --version</code></pre>
</li>
</ul>
<p>ä½¿ç”¨ï¼š</p>
<p>docker Composeçš„ä½¿ç”¨å¤§éƒ¨åˆ†éƒ½ä¼šè”åˆ<code>yml</code>æ–‡ä»¶çš„ä½¿ç”¨</p>
<pre><code class="bash">#åˆ›å»ºdocker-compose.ymlæ–‡ä»¶ä¸­çš„service
docker-compose up
docker-compose up -d#åå°è¿è¡Œï¼Œä½†æ˜¯ä¸ä¼šæ‰“å°log

#æŸ¥çœ‹docker-composeä¸­çš„æƒ…å†µ
docker-compose ps
docker-compose images#åˆ—å‡ºæ‰€å®šä¹‰çš„containerä»¥åŠä½¿ç”¨çš„image
#æ‰§è¡Œcontainerä¸­çš„å‘½ä»¤
docker-compose exec ymlæ–‡ä»¶ä¸­å®šä¹‰çš„service containerä¸­çš„å‘½ä»¤

#åœæ­¢docker-composeä¸­çš„å®¹å™¨
docker-compose stop
#åœæ­¢å¹¶åˆ é™¤docker-composeä¸­çš„å®¹å™¨ã€bridgeã€volume
docker-compose down</code></pre>
<h3 id="æ°´å¹³æ‰©å±•å’Œè´Ÿè½½å‡è¡¡"><a href="#æ°´å¹³æ‰©å±•å’Œè´Ÿè½½å‡è¡¡" class="headerlink" title="æ°´å¹³æ‰©å±•å’Œè´Ÿè½½å‡è¡¡"></a>æ°´å¹³æ‰©å±•å’Œè´Ÿè½½å‡è¡¡</h3><p>é€šè¿‡docker-composeå‘½ä»¤çš„<code>--scale</code>å‚æ•°</p>
<pre><code class="bash">#å¤šå¼€serviceä¸­çš„container
docker-compose up --sacle ymlæ–‡ä»¶serviceä¸­çš„æŸä¸€ä¸ªcontainer=ä¸ªæ•°</code></pre>
<h2 id="å…­ã€å®¹å™¨ç¼–æ’Swarm-mode"><a href="#å…­ã€å®¹å™¨ç¼–æ’Swarm-mode" class="headerlink" title="å…­ã€å®¹å™¨ç¼–æ’Swarm mode"></a>å…­ã€å®¹å™¨ç¼–æ’Swarm mode</h2><p>Swarmæ˜¯ä¸€ç§é›†ç¾¤çš„æ¶æ„ï¼Œå…¶ä¸­å«æœ‰èŠ‚ç‚¹ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸­å¯ä»¥å«æœ‰ä¸¤ç§è§’è‰²ï¼Œå³managerå’Œworker</p>
<ul>
<li>managerï¼šæ•´ä¸ªé›†ç¾¤çš„å¤§è„‘ï¼Œè‡³å°‘éœ€è¦2ä¸ªåŠä»¥ä¸Šï¼Œæ‰€ä»¥éœ€è¦åŒæ­¥ï¼Œdockeræä¾›äº†ä¸€ä¸ªå†…ç½®çš„åˆ†å¸ƒå¼çš„å­˜å‚¨æ•°æ®åº“ï¼Œé€šè¿‡raftåè®®è¿›è¡ŒåŒæ­¥</li>
<li>workerï¼šèŠ‚ç‚¹æ¯”managerå¤šï¼Œé€šè¿‡gossipç½‘ç»œè¿›è¡ŒåŒæ­¥</li>
</ul>
<p><img src="//NU-LL.github.io/2020/01/16/Docker/image-20200212235626905.png" alt="åº•å±‚æ¶æ„"></p>
<p>é‡è¦æ¦‚å¿µï¼š</p>
<ul>
<li>Serviceï¼šä¸docker Composeä¸­çš„serviceç±»ä¼¼ï¼Œä½†æ˜¯æœ€ç»ˆè¿è¡Œåœ¨é‚£å°æœºå™¨ä¸Šæ˜¯ä¸ç¡®å®šçš„</li>
<li>Replicasï¼šæ¨ªå‘æ‰©å±•æ—¶ï¼Œä¸€ä¸ªreplicaså°±æ˜¯ä¸€ä¸ªå®¹å™¨</li>
</ul>
<p><img src="//NU-LL.github.io/2020/01/16/Docker/image-20200212235931699.png" alt="Serviceå’ŒReplicas"></p>
<p>æ³¨ï¼šæ­¤å›¾äº§ç”Ÿäº†ä¸‰ä¸ªå®¹å™¨ï¼Œä¼šè°ƒåº¦ç³»ç»Ÿè°ƒåº¦åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šå»ï¼Œå³è¯¥serviceæœ€ç»ˆä¼šè¿è¡Œåœ¨é‚£äº›swarmèŠ‚ç‚¹ä¸Šæ˜¯ä¸çŸ¥é“çš„</p>
<p><img src="//NU-LL.github.io/2020/01/16/Docker/image-20200213000340881.png" alt="swarmä¸Šåˆ›å»ºserviceæ—¶çš„è°ƒåº¦è¿‡ç¨‹"></p>
<p>ä¾‹å­ï¼š</p>
<p>åˆ›å»ºä¸€ä¸ªä¸‰èŠ‚ç‚¹çš„swarmé›†ç¾¤ï¼š</p>
<p>èŠ‚ç‚¹ä¸€ï¼š</p>
<pre><code class="bash">#åˆå§‹åŒ–swarmå¹¶åˆ›å»ºmanagerèŠ‚ç‚¹ï¼ŒåŒæ—¶æŒ‡å®šmanagerçš„åœ°å€
sudo docker swarm init --advertise-addr=192.168.205.10
#æŸ¥çœ‹swarmå½“å‰çš„èŠ‚ç‚¹
sudo docker node ls</code></pre>
<p>å€Ÿç‚¹äºŒï¼š</p>
<pre><code class="bash">#åˆ›å»ºworkerèŠ‚ç‚¹å¹¶åŠ å…¥è¯¥swarmé›†ç¾¤ï¼ˆinitåä¼šæä¾›è¯¥å‘½ä»¤ï¼‰ï¼Œç”¨äºå°†å¦ä¸€å°æœºå™¨åŠ å…¥ç§°ä¸ºworker
sudo docker join --token xxxx(initåä¼šæä¾›) 192.168.205.10:ç«¯å£å·</code></pre>
<p>èŠ‚ç‚¹ä¸‰ï¼š</p>
<pre><code class="bash">#åˆ›å»ºworkerèŠ‚ç‚¹å¹¶åŠ å…¥è¯¥swarmé›†ç¾¤ï¼ˆinitåä¼šæä¾›è¯¥å‘½ä»¤ï¼‰ï¼Œç”¨äºå°†å¦ä¸€å°æœºå™¨åŠ å…¥ç§°ä¸ºworker
sudo docker join --token xxxx(initåä¼šæä¾›) 192.168.205.10:ç«¯å£å·</code></pre>
<h3 id="Serviceçš„åˆ›å»ºç»´æŠ¤å’Œæ°´å¹³æ‰©å±•"><a href="#Serviceçš„åˆ›å»ºç»´æŠ¤å’Œæ°´å¹³æ‰©å±•" class="headerlink" title="Serviceçš„åˆ›å»ºç»´æŠ¤å’Œæ°´å¹³æ‰©å±•"></a>Serviceçš„åˆ›å»ºç»´æŠ¤å’Œæ°´å¹³æ‰©å±•</h3><p><code>docker service</code>å‘½ä»¤ç±»ä¼¼äº<code>docker run</code>ï¼Œåªæ˜¯ä¸æ˜¯åœ¨æœ¬åœ°ä¸Šè¿è¡Œ</p>
<pre><code class="bash">#åˆ›å»ºä¸€ä¸ªbusyboxçš„serviceï¼Œå«demo
sudo docker service create --name demo busybox sh -c &quot;while true; do sleep 3600;done&quot;
#æŸ¥çœ‹service
sudo docker service ls
sudo docker service ps serviceåå­—#æŸ¥çœ‹serviceçš„è¯¦ç»†æƒ…å†µï¼ˆåŒ…æ‹¬åˆ†å¸ƒåœ¨é‚£å°æœºå™¨/èŠ‚ç‚¹ä¸Šï¼‰
#æ¨ªå‘æ‰©å±•service
sudo docker service scale serviceåå­—=æ‰©å±•æ•°#é€šè¿‡lså‘½ä»¤æ˜¾ç¤ºçš„REPLICASæ å¯ä»¥æŸ¥çœ‹
#åˆ é™¤service
sudo docker service rm demo#ç”±äºå¯èƒ½å­˜åœ¨æ¨ªå‘æ‰©å±•ï¼Œæ‰€ä»¥å®é™…ä¸Šä¼šæ¯”è¾ƒæ…¢</code></pre>
<ul>
<li><code>sudo docker service ls</code>å‘½ä»¤æ˜¾ç¤ºçš„REPLICASæ ï¼š<ul>
<li>åˆ†æ¯ï¼šåˆ›å»ºæ—¶è§„å®šçš„æ¨ªå‘æ‰©å±•æ•°é‡ï¼ˆscaleï¼‰</li>
<li>åˆ†å­ï¼šæœ‰å‡ ä¸ªå·²ç»readyäº†</li>
</ul>
</li>
<li><code>scale</code>å‘½ä»¤æ‰©å±•æ—¶ï¼Œå¦‚æœæœ‰éƒ¨åˆ†èŠ‚ç‚¹ä¸Šçš„serviceå¤±æ•ˆäº†ï¼ˆé€€å‡ºã€shutdownç­‰ï¼‰ï¼Œç³»ç»Ÿä¼šåœ¨ä»»æ„èŠ‚ç‚¹ä¸Šå†èµ·ä¸€ä¸ªç›´åˆ°è¾¾åˆ°scaleè§„å®šçš„æ•°ç›®</li>
</ul>
<h3 id="é›†ç¾¤æœåŠ¡å™¨é€šä¿¡â€”â€”RoutingMesh"><a href="#é›†ç¾¤æœåŠ¡å™¨é€šä¿¡â€”â€”RoutingMesh" class="headerlink" title="é›†ç¾¤æœåŠ¡å™¨é€šä¿¡â€”â€”RoutingMesh"></a>é›†ç¾¤æœåŠ¡å™¨é€šä¿¡â€”â€”RoutingMesh</h3><p>RoutingMeshçš„ä¸¤ç§ä½“ç°ï¼š</p>
<ul>
<li>Internalï¼šContainerå’ŒContainerä¹‹é—´çš„è®¿é—®é€šè¿‡overlayç½‘ç»œï¼ˆé€šè¿‡VIPè™šæ‹ŸIPï¼‰</li>
<li>Ingressï¼šå¦‚æœæœåŠ¡æœ‰ç»‘å®šæ¥å£ï¼Œåˆ™æ­¤æœåŠ¡å¯ä»¥é€šè¿‡ä»»æ„swarmèŠ‚ç‚¹çš„ç›¸åº”æ¥å£è®¿é—®</li>
</ul>
<h4 id="Internal"><a href="#Internal" class="headerlink" title="Internal"></a>Internal</h4><p>docker Composeåœ¨å•æœºçš„æƒ…å†µä¸‹ï¼Œä¸åŒçš„serviceå¯ä»¥é€šè¿‡å¯¹æ–¹çš„åå­—ç›¸äº’è®¿é—®ï¼ˆåº•å±‚é€šè¿‡DNSæœåŠ¡å®ç°ï¼‰ã€‚è€Œåœ¨swarm classä¸­ï¼Œä¸åŒçš„serviceæœ‰å¯èƒ½åœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œä¸åŒçš„serviceä¹‹é—´ä¹Ÿèƒ½é€šè¿‡service nameé€šä¿¡ï¼Œä¹Ÿæœ‰DNSæœåŠ¡ã€‚</p>
<p>å¯¹äºSwarmæ¥è¯´ï¼Œæœ‰å†…ç½®çš„DNSæœåŠ¡å‘ç°çš„åŠŸèƒ½ï¼Œé€šè¿‡serviceå‘½ä»¤åˆ›å»ºserviceæ—¶ï¼Œå¦‚æœæ˜¯è¿æ¥åˆ°ä¸€ä¸ªoverlayçš„ç½‘ç»œä¸Šï¼Œä¼šä¸ºè¿æ¥åˆ°overlayç½‘ç»œä¸Šçš„æ‰€æœ‰çš„serviceå»å¢åŠ ä¸€æ¡DNSçš„è®°å½•ï¼Œé€šè¿‡è¯¥è®°å½•å°±èƒ½çŸ¥é“IPåœ°å€ï¼ˆå¹¶ä¸æ˜¯å®é™…ä¸Šè¯¥serviceæ‰€åœ¨çš„å®¹å™¨çš„ipåœ°å€ï¼Œè€Œæ˜¯è™šæ‹Ÿçš„ipåœ°å€ï¼Œå³VIPï¼Œä¸€æ—¦serviceåˆ›å»ºå¥½åï¼ŒVIPå°±ä¸ä¼šæ”¹å˜ï¼Œä½†æ˜¯å’Œå…·ä½“çš„ipåœ°å€ç»‘å®šæ˜¯é€šè¿‡LVSï¼ˆLinux Virtual Serviceï¼‰å®ç°çš„ï¼‰ï¼Œå°±å¯ä»¥è®¿é—®å…¶æœåŠ¡</p>
<p>ä¾‹å­ï¼š</p>
<p><code>swarm-manager</code>èŠ‚ç‚¹ï¼š</p>
<pre><code class="bash">#åˆ›å»ºoverlayç½‘ç»œï¼Œå‘½ådemo
sudo docker network create -d overlay demo
#åˆ›å»ºä¸€ä¸ªwhoamiçš„serviceï¼Œæä¾›webæœåŠ¡ï¼Œå¦‚æœè®¿é—®8000ç«¯å£ä¼šè¿”å›ä»–çš„hostname
sudo docker service create --name whoami -p 8000:8000 --network demo -d jwilder/whoami#å°†å†…éƒ¨8000ç«¯å£æ˜ å°„åˆ°æœ¬åœ°8000ç«¯å£
#æŸ¥çœ‹æ˜¯å¦è¿è¡Œ
sudo docker service ls
#æŸ¥çœ‹è¿è¡Œåœ¨å“ªé‡Œ
sudo docker service ps whoami#swarm-manager
#æŸ¥çœ‹å®¹å™¨ æ˜¯å¦æ˜ å°„å‡ºäº†8000
sudo docker ps
#æŸ¥çœ‹8000ç«¯å£
curl 127.0.0.1:8000


#åˆ›å»ºç¬¬äºŒä¸ªserviceï¼Œé‡‡ç”¨busyboxï¼Œå‘½åclient
sudo docker service create --name client -d --network demo busybox sh -c &quot;while true; do sleep 3600; done&quot;
#æŸ¥çœ‹æ˜¯å¦è¿è¡Œ
sudo docker service ls
#æŸ¥çœ‹è¿è¡Œåœ¨å“ªé‡Œ
sudo docker service ps client#swarm-worker1
#æŸ¥çœ‹å®¹å™¨ æ˜¯å¦æ˜ å°„å‡ºäº†8000
sudo docker ps


#æ‰©å±•ä¸‹whoami
sudo docker service scale whoami=2
#æŸ¥çœ‹å¦ä¸€å°åœ¨å“ªé‡Œ
sudo docker service ps whoami#swarm-managerã€swarm-worker2
</code></pre>
<p>è¿›å…¥<code>swarm-worker1</code>èŠ‚ç‚¹ï¼š</p>
<pre><code class="bash">#å°šæœªæ‰©å±•å‰ï¼š
#æŸ¥çœ‹serviceæ˜¯å¦è¿è¡Œ
sudo docker ps
#è¿›å…¥serviceä¸­
sudo docker exec -it serviceçš„id sh
#ç›´æ¥pingå¦ä¸€å°service
ping whoami#èƒ½å¤Ÿpingé€šï¼Œèƒ½å¤Ÿå‘ç°å®é™…ä¸Šæ˜¯ping10.0.0.7

#æ¨ªå‘æ‰©å±•åï¼š
ping whoami#èƒ½å¤Ÿpingé€šï¼Œèƒ½å¤Ÿå‘ç°å®é™…ä¸Šæ˜¯ping10.0.0.7

#ç›´æ¥å»æŸ¥çœ‹swarm classä¸­ç»´æŠ¤çš„dnsæœåŠ¡å™¨
nslookup whoami
#æŸ¥çœ‹çœŸæ­£çš„å®¹å™¨åœ°å€
nslookup tasks.whoami</code></pre>
<ul>
<li>ä¸ç®¡serviceæœ‰å‡ ä¸ªæ¨ªå‘æ‰©å±•ï¼Œä½†æ˜¯æœ€åçš„VIPåªæœ‰ä¸€ä¸ªï¼Œè€Œä¸”è®¿é—®è¿™ä¸ªVIPæ—¶ï¼ŒSwarmä¼šè‡ªåŠ¨åšè´Ÿè½½å‡è¡¡ï¼Œä¾æ¬¡è½®æµè®¿é—®è¿™å‡ ä¸ªæ¨ªå‘æ‰©å±•çš„service</li>
<li>ä¸Šè¿°çš„è´Ÿè½½å‡è¡¡ä»¥åŠVIPå‡é€šè¿‡LVSï¼ˆLinux Virtual Serviceï¼‰å®ç°</li>
</ul>
<h4 id="Ingress"><a href="#Ingress" class="headerlink" title="Ingress"></a>Ingress</h4><ul>
<li>å¤–éƒ¨è®¿é—®çš„è´Ÿè½½å‡è¡¡</li>
<li>æœåŠ¡ç«¯å£è¢«æš´éœ²åˆ°å„ä¸ª swarmèŠ‚ç‚¹</li>
<li>å†…éƒ¨é€šè¿‡IPVSè¿›è¡Œè´Ÿè½½å‡è¡¡</li>
</ul>
<p>å½“æˆ‘ä»¬å»ä»»ä½•ä¸€å°SwarmèŠ‚ç‚¹ä¸Šå»è®¿é—®ç«¯å£æœåŠ¡çš„æ—¶å€™ï¼Œä¼šæŠŠè¯¥æœåŠ¡é€šè¿‡æœ¬åœ°èŠ‚ç‚¹çš„IPVSï¼ˆIPçš„virtual serviceï¼‰ï¼Œé€šè¿‡LVSæŠŠè¯¥æœåŠ¡è´Ÿè½½å‡è¡¡ï¼š</p>
<p><img src="//NU-LL.github.io/2020/01/16/Docker/image-20200218173537430.png" alt="ç¤ºæ„å›¾"></p>
<ul>
<li>å½“å¤–éƒ¨è®¿é—®docker host3çš„8080ç«¯å£æ—¶ï¼ˆè¯¥èŠ‚ç‚¹ä¸Šæ²¡æœ‰å¯¹åº”serviceï¼‰ï¼ŒIPVSä¼šå°†è¯¥è¯·æ±‚è½¬å‘åˆ°å¦å¤–ä¸¤å°å…·æœ‰serviceçš„èŠ‚ç‚¹ä¸Š</li>
</ul>
<p>ä¾‹å­ï¼š</p>
<p><code>swarm-manager</code>èŠ‚ç‚¹ï¼š</p>
<pre><code class="bash">#åˆ›å»ºoverlayç½‘ç»œï¼Œå‘½ådemo
sudo docker network create -d overlay demo
#åˆ›å»ºä¸€ä¸ªwhoamiçš„serviceï¼Œæä¾›webæœåŠ¡ï¼Œå¦‚æœè®¿é—®8000ç«¯å£ä¼šè¿”å›ä»–çš„hostname
sudo docker service create --name whoami -p 8000:8000 --network demo -d jwilder/whoami#å°†å†…éƒ¨8000ç«¯å£æ˜ å°„åˆ°æœ¬åœ°8000ç«¯å£
#æ‰©å±•ä¸‹whoami
sudo docker service scale whoami=2
#æŸ¥çœ‹è¿è¡Œæƒ…å†µ
suod docker service ps whoami#swarm-managerã€swarm-worker2
#ä¸æ–­è·å–ï¼Œä¼šä¾æ¬¡è¿”å›ä¸¤å°ä¸åŒèŠ‚ç‚¹æœºå™¨çš„id(è´Ÿè½½å‡è¡¡)
curl 127.0.0.1:8000
curl 127.0.0.1:8000
curl 127.0.0.1:8000
...</code></pre>
<p>è¿›å…¥<code>swarm-worker1</code>èŠ‚ç‚¹ï¼š</p>
<pre><code class="bash">#è·å–ï¼Œå‘ç°ä»»å¯ä»¥è®¿é—®
curl 127.0.0.1:8000

#æŸ¥çœ‹æœ¬åœ°è½¬å‘è§„åˆ™
iptables -nl -t nat</code></pre>
<h3 id="docker-stackéƒ¨ç½²swarm"><a href="#docker-stackéƒ¨ç½²swarm" class="headerlink" title="docker stackéƒ¨ç½²swarm"></a>docker stackéƒ¨ç½²swarm</h3><p>åˆ©ç”¨Docker compose fileï¼Œå³<code>yml</code>æ–‡ä»¶ï¼Œä¸»è¦é€šè¿‡<code>deploy</code>å‘½ä»¤ï¼Œå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.docker.com/compose/compose-file/#deploy" target="_blank" rel="noopener">https://docs.docker.com/compose/compose-file/#deploy</a></p>
<p>æ³¨æ„ï¼šè¯¥å¤„çš„docker compose fileä¸­ä¸èƒ½åˆ©ç”¨buildå‘½ä»¤æ„å»ºæœ¬åœ°imageï¼Œåªèƒ½é€šè¿‡<strong>è¿œç¨‹æ‹‰å–</strong></p>
<p>ä»¥ä¸‹å‡ä¸º<code>deploy</code>ä¸‹çš„å­å‘½ä»¤ï¼š</p>
<ul>
<li><code>endpoint_mode</code>ï¼š<ul>
<li>vipï¼ˆé»˜è®¤ï¼‰ï¼šserviceä¹‹é—´é€šè¿‡vipäº’è®¿ï¼ˆåº•å±‚ä¼šé€šè¿‡LVSè‡ªåŠ¨åšå‡è¡¡è´Ÿè½½ï¼‰</li>
<li>dnsrrï¼šç›´æ¥ä½¿ç”¨serviceçš„ipåœ°å€äº’è®¿ï¼Œä¹Ÿä¼šé€šè¿‡dnsrrï¼ˆDNS round-robinï¼‰åšå‡è¡¡è´Ÿè½½</li>
</ul>
</li>
<li><code>labels</code>ï¼šå¸®åŠ©ä¿¡æ¯</li>
<li><code>mode</code>ï¼š<ul>
<li>globalï¼šä¸èƒ½é€šè¿‡scaleå‘½ä»¤åšæ¨ªå‘æ‰©å±•ï¼Œæ•´ä¸ªclassä¸­åªæœ‰ä¸€ä¸ªservice</li>
<li>replicatedï¼ˆé»˜è®¤ï¼‰ï¼šå¯ä»¥æ¨ªå‘æ‰©å±•</li>
</ul>
</li>
<li><code>placement</code>ï¼š<ul>
<li>constraintsï¼š<ul>
<li><code>- node.role==manager</code>ï¼šä¸€å®šä¼šéƒ¨ç½²åˆ°managerä¸Š</li>
</ul>
</li>
<li>preferencesï¼š<ul>
<li>è¯¦è§ï¼š<a href="https://docs.docker.com/compose/compose-file/#placement" target="_blank" rel="noopener">https://docs.docker.com/compose/compose-file/#placement</a></li>
</ul>
</li>
</ul>
</li>
<li><code>replicas</code>ï¼š<ul>
<li>å½“<code>mode</code>è®¾ç½®æˆreplicatedæ—¶ï¼Œå¯ä»¥åœ¨åˆå§‹åŒ–æ—¶å°±æŒ‡å®šéœ€è¦å‡ ä¸ªservice</li>
</ul>
</li>
<li><code>resources</code>ï¼šèµ„æºçš„é™åˆ¶<ul>
<li>cpuï¼šâ€˜0.5â€™</li>
<li>memoryï¼š20M</li>
</ul>
</li>
<li><code>restart_policy</code>ï¼šé‡å¯æ¡ä»¶å³å‚æ•°è®¾ç½®<ul>
<li>delayï¼šå»¶æ—¶</li>
<li>max_attemptsï¼šæœ€å¤§å°è¯•æ¬¡æ•°</li>
</ul>
</li>
<li><code>update_config</code>ï¼šæ›´æ–°æ—¶è¦éµå¾ªçš„åŸåˆ™<ul>
<li>parallelismï¼šå¹¶è¡Œæ•°ï¼ˆæœ€å¤šèƒ½å¤ŸåŒæ—¶æ›´æ–°å‡ ä¸ªserviceï¼‰</li>
<li>delayï¼šå»¶æ—¶ï¼ˆæ¯æ¬¡æ›´æ–°çš„é—´éš”æ—¶é—´ï¼‰</li>
</ul>
</li>
</ul>
<p>ä¾‹å­ï¼š</p>
<p>åˆ©ç”¨ymlæ–‡ä»¶éƒ¨ç½²wordpress</p>
<pre><code class="yaml">version: &#39;3&#39;

services:

  web:
    image: wordpress
    ports:
      - 8080:80
    environment:
      WORDPRESS_DB_HOST: mysql
      WORDPRESS_DB_PASSWORD: root
    networks:
      - my-network
    depends_on:
      - mysql
    deploy:
      mode: replicated
      replicas: 3
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
      update_config:
        parallelism: 1
        delay: 10s

  mysql:
    image: mysql
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: wordpress
    volumes:
      - mysql-data:/var/lib/mysql
    networks:
      - my-network
    deploy:
      mode: global
      placement:
        constraints:
          - node.role == manager

volumes:
  mysql-data:

networks:
  my-network:
    driver: overlay</code></pre>
<p>è¿›å…¥swarm managerèŠ‚ç‚¹ï¼š</p>
<pre><code class="bash">#è¯­æ³•ï¼šsudo docker stack deploy è‡ªå®šä¹‰çš„åå­— --compose-file=xxxx.yml
sudo docker stack deploy wordpress --compose-file=docker-compose.yml

#æŸ¥çœ‹æƒ…å†µ
sudo docker stack ps wordpress
#åªæŸ¥çœ‹service
sudo docker stack services wordpress

#åˆ é™¤æ‰€æœ‰containeråŠç½‘ç»œ
sudo docker stack rm wordpress</code></pre>
<h3 id="å¯†ç ç®¡ç†"><a href="#å¯†ç ç®¡ç†" class="headerlink" title="å¯†ç ç®¡ç†"></a>å¯†ç ç®¡ç†</h3><p>docker compose fileä¸­æœ‰äº›æ˜¯å…³äºæ•°æ®åº“çš„ç”¨æˆ·åå’Œå¯†ç çš„ï¼Œä¸ºäº†å®‰å…¨æ€§è€ƒè™‘éœ€è¦secret manager</p>
<p>éœ€è¦åŠ å¯†çš„éƒ¨åˆ†ï¼š</p>
<ul>
<li>ç”¨æˆ·åå¯†ç </li>
<li>SSH Key</li>
<li>TLSè®¤è¯</li>
<li>ä»»ä½•ä¸æƒ³è®©åˆ«äººçœ‹åˆ°çš„æ•°æ®</li>
</ul>
<p>docker secret managementç‰¹ç‚¹ï¼š</p>
<ul>
<li>å­˜åœ¨ Swarm ManagerèŠ‚ç‚¹ Raft databaseé‡Œï¼ˆåŠ å¯†çš„ï¼‰.<ul>
<li>å¤šä¸ªmanagerèŠ‚ç‚¹é€šè¿‡Raft databaseç¡®ä¿æ•°æ®ä¸€è‡´</li>
</ul>
</li>
<li>Secretå¯ä»¥ assignç»™ä¸€ä¸ª service,è¿™ä¸ª serviceå°±èƒ½çœ‹åˆ°è¿™ä¸ª secret</li>
<li>åœ¨ containerå†…éƒ¨ Secretçœ‹èµ·æ¥åƒæ–‡ä»¶,ä½†æ˜¯å®é™…æ˜¯åœ¨å†…å­˜ä¸­</li>
</ul>
<p>ä½¿ç”¨ä¾‹å­ï¼š</p>
<pre><code class="bash">#åˆ›å»ºsecret
#æ–¹æ³•ä¸€ï¼š
#ä»æ–‡ä»¶ä¸­åˆ›å»ºsecretï¼Œåˆ›å»ºå®Œæˆåæœ€å¥½åˆ é™¤æ‰è¯¥æ–‡ä»¶
sudo docker secret create secretçš„åå­— è¦åŠ å¯†çš„æ–‡ä»¶
#æŸ¥çœ‹
sudo docker secret ls
#æ–¹æ³•äºŒ
#ä»æ ‡å‡†è¾“å…¥ä¸­åˆ›å»ºsecret
echo &quot;admin&quot; | sudo docker secret create secretçš„åå­— -
#æŸ¥çœ‹
sudo docker secret ls

#åˆ é™¤secret
sudo docker secret rm secretçš„åå­—

#ä½¿ç”¨secret
#åˆ›å»ºä¸€ä¸ªbusyboxçš„containerï¼Œå‘½åclientï¼ˆå¯ä»¥é€šè¿‡å¤šæ¬¡ä½¿ç”¨--secretä¼ å…¥å‡ ä¸ªsecretï¼‰
sudo docker service create --name client --secret secretçš„åå­— busybox sh -c &quot;while true; do sleep 3600; done&quot;
#è¿›å…¥container
sudo docker exec -it å®¹å™¨çš„id(å¯é€šè¿‡docker psæŸ¥çœ‹) sh
cd /run/secrets#ä¼šå­˜åœ¨ä¸€ä¸ªsecretåå­—çš„æ–‡ä»¶
#å¯ä»¥ç›´æ¥æŸ¥çœ‹secretçš„æ˜æ–‡
cat secretåå­—çš„æ–‡ä»¶</code></pre>
<p>æœ€å…¸å‹ä½¿ç”¨mysqlæ—¶ä¼ å…¥å¯†ç çš„ä¾‹å­ï¼š</p>
<pre><code class="bash">echo &quot;admin&quot; | sudo docker secret create my-pw -
#é€šè¿‡MYSQLä¸­çš„MYSQL_ROOT_PASSWORD_FILEç¯å¢ƒå˜é‡æŒ‡å®šå¯†ç 
sudo docker service create --name db --secret my-pw -e MYSQL_ROOT_PASSWORD_FILE=/run/secrets/my-pw mysql
#è¿›å…¥containerå†…éƒ¨ç¡®è®¤mysqlå¯†ç 
sudo docker exec -it å®¹å™¨çš„id(å¯é€šè¿‡docker psæŸ¥çœ‹) sh
mysql -u root -p#ä¹‹åè¾“å…¥å¯†ç ï¼šadminå³å¯è¿›å…¥mysqlçš„äº¤äº’ä¸­</code></pre>
<h3 id="docker-stackä¸­ä½¿ç”¨secret"><a href="#docker-stackä¸­ä½¿ç”¨secret" class="headerlink" title="docker stackä¸­ä½¿ç”¨secret"></a>docker stackä¸­ä½¿ç”¨secret</h3><p>é€šè¿‡<code>secret</code>æŒ‡å®šä½¿ç”¨å“ªä¸ªsecret</p>
<p>ä¾‹å­ï¼š</p>
<p>åˆ©ç”¨ymlæ–‡ä»¶éƒ¨ç½²wordpress</p>
<pre><code class="yaml">version: &#39;3&#39;

services:

  web:
    image: wordpress
    ports:
      - 8080:80
    secrets:
      - my-pw
    environment:
      WORDPRESS_DB_HOST: mysql
      WORDPRESS_DB_PASSWORD_FILE: /run/secrets/my-pw
    networks:
      - my-network
    depends_on:
      - mysql
    deploy:
      mode: replicated
      replicas: 3
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
      update_config:
        parallelism: 1
        delay: 10s

  mysql:
    image: mysql
    secrets:
      - my-pw
    environment:
      MYSQL_ROOT_PASSWORD_FILE: /run/secrets/my-pw
      MYSQL_DATABASE: wordpress
    volumes:
      - mysql-data:/var/lib/mysql
    networks:
      - my-network
    deploy:
      mode: global
      placement:
        constraints:
          - node.role == manager

volumes:
  mysql-data:

networks:
  my-network:
    driver: overlay

#
# secrets:
#   my-pw:
#    file: ./password</code></pre>
<h3 id="serviceæ›´æ–°"><a href="#serviceæ›´æ–°" class="headerlink" title="serviceæ›´æ–°"></a>serviceæ›´æ–°</h3><p>æ³¨æ„ï¼šä¸ºä¿è¯serviceä¸ä¼šä¸­æ–­ï¼Œéœ€è¦ä¿è¯scale&gt;=2</p>
<p>å¯¹æ­£åœ¨è¿è¡Œçš„serviceè¿›è¡Œæ›´æ–°ï¼š</p>
<pre><code class="bash">#åˆ›å»ºoverlayç½‘ç»œï¼Œå‘½ådemo
sudo docker network create -d overlay demo
#åˆ›å»ºä¸€ä¸ªwhoamiçš„serviceï¼Œæä¾›webæœåŠ¡ï¼Œå°†æœ¬åœ°çš„5000æ˜ å°„åˆ°classä¸­çš„8080ç«¯å£
sudo docker service create --name web -p 8080:5000 --network demo xiaopeng163/python-flask-demo:1.0
#æŸ¥çœ‹
sudo docker service ps web
#æ‰©å±•ä¸‹web
sudo docker service scale web=2
#æŸ¥çœ‹è¿è¡Œæƒ…å†µ
curl 127.0.0.1:8080


#æ›´æ–°image
sudo docker service update --image xiaopeng163/python-flask-demo:2.0 web
#å†æ¬¡æŸ¥çœ‹ï¼Œä¼šå‘ç°1.0çš„å·²ç»è¢«shutdownäº†ï¼Œå¹¶é‡æ–°å¼€äº†ä¸¤ä¸ª2.0çš„container
sudo docker service ps web


#æ›´æ–°ç«¯å£
sudo service updata --publish-rm 8080:5000 --publish-add 8088:5000 web</code></pre>
<h2 id="ä¸ƒã€å®¹å™¨ç¼–æ’Kubernetes"><a href="#ä¸ƒã€å®¹å™¨ç¼–æ’Kubernetes" class="headerlink" title="ä¸ƒã€å®¹å™¨ç¼–æ’Kubernetes"></a>ä¸ƒã€å®¹å™¨ç¼–æ’Kubernetes</h2><p>kubernetesæ¶æ„ï¼š</p>
<p><img src="//NU-LL.github.io/2020/01/16/Docker/image-20200219235941920.png" alt="æ¶æ„å›¾"></p>
<p>å…¶ä¸­MasterèŠ‚ç‚¹æ¶æ„ï¼š</p>
<p><img src="//NU-LL.github.io/2020/01/16/Docker/image-20200220000101254.png" alt="MasterèŠ‚ç‚¹æ¶æ„"></p>
<ul>
<li>API Serviceï¼šæš´éœ²ç»™å¤–ç•Œè®¿é—®</li>
<li>Schedulerï¼šè°ƒåº¦æ¨¡å—</li>
<li>Controllerï¼šæ§åˆ¶æ¨¡å—ï¼Œå¯¹èŠ‚ç‚¹çš„æ§åˆ¶</li>
<li>etcdï¼šåˆ†å¸ƒå¼çš„å­˜å‚¨ï¼Œå­˜å‚¨k8sçš„çŠ¶æ€å’Œé…ç½®</li>
</ul>
<p>nodeèŠ‚ç‚¹æ¶æ„ï¼š</p>
<p><img src="//NU-LL.github.io/2020/01/16/Docker/image-20200220000307417.png" alt="nodeèŠ‚ç‚¹æ¶æ„"></p>
<ul>
<li>Podï¼šåœ¨k8sä¸­ï¼Œæ˜¯åœ¨å®¹å™¨ä¸­è°ƒåº¦çš„æœ€å°å•ä½ï¼Œæ˜¯å…·æœ‰ç›¸åŒçš„namespaceï¼ˆåŒ…å«äº†æ‰€æœ‰namespaceï¼Œå¦‚user namespaceã€network namespaceï¼‰çš„ä¸€äº›Containerç»„åˆ</li>
<li>Dockerï¼šå®¹å™¨æŠ€æœ¯ä¹‹ä¸€ï¼ˆk8sä¸­é‡‡ç”¨dockerï¼Œè¿˜æœ‰å…¶ä»–å®¹å™¨æŠ€æœ¯ï¼‰</li>
<li>kubeletï¼šç±»ä¼¼äºä¸€ä¸ªä»£ç†ï¼Œå—masterèŠ‚ç‚¹æ§åˆ¶ï¼Œè´Ÿè´£åœ¨nodeèŠ‚ç‚¹ä¸Šåˆ›å»ºã€ç®¡ç†å®¹å™¨ã€networkä»¥åŠvolume</li>
<li>kube-proxyï¼šç«¯å£çš„ä»£ç†è½¬å‘ä»¥åŠserviceçš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡</li>
<li>Flientdï¼šæ—¥å¿—çš„é‡‡é›†ã€å­˜å‚¨ã€æŸ¥è¯¢</li>
<li>Optional Add-onsï¼šæ’ä»¶</li>
</ul>
<h3 id="æ­å»ºk8så•èŠ‚ç‚¹ç¯å¢ƒ"><a href="#æ­å»ºk8så•èŠ‚ç‚¹ç¯å¢ƒ" class="headerlink" title="æ­å»ºk8så•èŠ‚ç‚¹ç¯å¢ƒ"></a>æ­å»ºk8så•èŠ‚ç‚¹ç¯å¢ƒ</h3><p>k8sé¦–å¸­æ„é€ å¸ˆgithubï¼š<a href="https://github.com/kelseyhightower" target="_blank" rel="noopener">https://github.com/kelseyhightower</a></p>
<p>å¸¸ç”¨å·¥å…·ä»‹ç»ï¼š</p>
<ul>
<li><a href="https://github.com/kelseyhightower/kubernetes-the-hard-way" target="_blank" rel="noopener">kubernetes-the-hard-way</a>ï¼šä¸å€ŸåŠ©ä»»ä½•è„šæœ¬ï¼Œä»å‘½ä»¤è¡Œå»æ“ä½œå®‰è£…kubernetes</li>
<li><a href="https://github.com/kubernetes/minikube" target="_blank" rel="noopener">minikube</a>ï¼šæœ¬åœ°å¿«é€Ÿåˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹çš„kubernetesé›†ç¾¤<ul>
<li>é€šè¿‡åˆ©ç”¨virtualboxåˆ›å»ºä¸€å°è™šæ‹Ÿæœºï¼Œè¯¥è™šæ‹Ÿæœºä¸­ä¼šå®‰è£…å¥½kubernetes</li>
</ul>
</li>
<li><a href="https://github.com/kubernetes/kubeadm" target="_blank" rel="noopener">kubeadm</a>ï¼šæ–¹ä¾¿çš„æœ¬åœ°æ­å»ºå¤šèŠ‚ç‚¹çš„kubernetesé›†ç¾¤</li>
<li><a href="https://github.com/kubernetes/kops" target="_blank" rel="noopener">kops</a>ï¼šåœ¨äº‘ä¸Šæ­å»ºkubernetesé›†ç¾¤</li>
<li><a href="https://cores.com/tectonic" target="_blank" rel="noopener">tectonic</a>ï¼šå°‘äº10ä¸ªèŠ‚ç‚¹å…è´¹</li>
<li><a href="https://labs.play-with-k8s.com" target="_blank" rel="noopener">play with kubernetes</a>ï¼šç½‘ç«™ä¸Šæ­å»ºï¼Œæ— éœ€ä»»ä½•å·¥ä½œï¼Œå››ä¸ªå°æ—¶ä¿å­˜æ—¶é—´</li>
</ul>
<p>minikubeå®‰è£…ï¼ˆ<a href="https://minikube.sigs.k8s.io/docs/start/" target="_blank" rel="noopener">å‚è€ƒæ–‡æ¡£</a>ï¼‰ï¼š</p>
<ul>
<li><p>ubuntuä¸Šï¼š</p>
<pre><code class="bash">curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube_1.7.2-0_amd64.deb \
 &amp;&amp; sudo dpkg -i minikube_1.7.2-0_amd64.deb
#ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ä¸‹
egrep -q &#39;vmx|svm&#39; /proc/cpuinfo &amp;&amp; echo yes || echo no
#å¦‚æœè¾“å‡º no ä¸”å¦‚æœ¬æ–‡ä¸€æ ·ä½¿ç”¨Windows + VirtualBox + minikubeï¼Œéœ€è¦é€šè¿‡ä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªå•èŠ‚ç‚¹çš„kubernetesé›†ç¾¤ï¼ˆå…·ä½“å‘½ä»¤åæ–‡ä¼šç»†è¯´ï¼‰
sudo minikube start --vm-driver=none#
sudo minikube config set vm-driver none#</code></pre>
</li>
<li><p>éœ€è¦å®‰è£…ä¾èµ–çš„<code>kubectl</code>ï¼ˆå®¢æˆ·ç«¯çš„CLIï¼Œå¯çœ‹ä¸Šé¢çš„æ¶æ„å›¾ï¼‰</p>
<pre><code class="bash">  #ubuntuä¸Šå¯ä»¥ä½¿ç”¨è¯¥å‘½ä»¤å®‰è£…ï¼š
  sudo snap install kubectl --classic
  #å…¶ä½™Linuxå‘è¡Œç‰ˆå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤
  curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl
  chmod +x ./kubectl
  sudo mv ./kubectl /usr/local/bin/kubectl</code></pre>
</li>
<li><p>è™šæ‹ŸåŒ–å·¥å…·virtualbox</p>
<pre><code class="bash">  #æµ‹è¯•ç‰ˆæœ¬å·
  minikube version
  kubectl version</code></pre>
</li>
</ul>
<p><code>kubectl</code>çš„ä¸Šä¸‹æ–‡ï¼šä¸€äº›é…ç½®ä¿¡æ¯æˆ–è€…è®¤è¯ä¿¡æ¯ï¼Œç§°ä¹‹ä¸ºcontextï¼Œå³ä¸Šä¸‹æ–‡</p>
<p>kubectlçš„<a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands" target="_blank" rel="noopener">å®˜æ–¹å¸®åŠ©æ–‡æ¡£</a></p>
<p>å‘½ä»¤ï¼š</p>
<pre><code class="bash">#åˆ›å»ºä¸€ä¸ªå•èŠ‚ç‚¹çš„kubernetesé›†ç¾¤ï¼ˆé€‚ç”¨äºmacæˆ–Linuxä¸Šç›´æ¥è£…minikube+virtualboxç”¨æˆ·ï¼‰
sudo minikube start --vm-driver=virtualbox
#é€‚ç”¨äºæœ¬æ–‡ä¸­Windows+virtualboxï¼Œåœ¨virtualboxä¸­çš„è™šæ‹Ÿæœºä¸­å®‰è£…minikubeç”¨æˆ·ï¼Œç¼ºç‚¹æ˜¯æœ‰å¯èƒ½ä¼šå½±å“Linuxè™šæ‹Ÿæœºå’Œä¸èƒ½ä½¿ç”¨minikube sshç­‰å‘½ä»¤
sudo minikube start --vm-driver=none
#å¦‚æœæ˜¯å›½å†…ï¼Œå¯ä»¥å°è¯•å¦‚ä¸‹å‘½ä»¤
sudo minikube start --vm-driver=none --image-mirror-country=cn
sudo minikube start --vm-driver=none --image-mirror-country=cn --registry-mirror=https://registry.docker-cn.com --image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers
#è¿›å…¥é€šè¿‡minikubeåˆ›å»ºçš„è™šæ‹Ÿæœºä¸­
sudo minikube ssh
#åœæ­¢è™šæ‹Ÿæœº
sudo minikube stop

#å½“å‰ä½¿ç”¨çš„configçš„åŸºæœ¬æƒ…å†µ
sudo kubectl config view
#æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„ä¸Šä¸‹æ–‡
sudo kubectl config get-contexts
#å½“å‰çš„kubernetesçš„é›†ç¾¤æƒ…å†µ
sudo kubectl cluster-info</code></pre>
<h4 id="kubectlå‘½ä»¤è¡Œè¡¥å…¨è¡¥ä¸"><a href="#kubectlå‘½ä»¤è¡Œè¡¥å…¨è¡¥ä¸" class="headerlink" title="kubectlå‘½ä»¤è¡Œè¡¥å…¨è¡¥ä¸"></a>kubectlå‘½ä»¤è¡Œè¡¥å…¨è¡¥ä¸</h4><p>kubectlè‡ªå¸¦å‘½ä»¤è¡Œè¡¥å…¨çš„è„šæœ¬ï¼Œé€šè¿‡å‘½ä»¤ï¼š</p>
<pre><code class="bash">#Linux
kubectl completion bash
source &lt;(kubectl completion bash)</code></pre>
<p>è¿›è¡Œæ‰“è¡¥ä¸è¡¥å…¨ã€‚å…¶ä»–ç³»ç»Ÿå¯ä»¥å‚è€ƒ<a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>æœ€åä¸€èŠ‚<code>Optional kubectl configurations</code></p>
<h3 id="æœ€å°è°ƒåº¦å•ä½pod"><a href="#æœ€å°è°ƒåº¦å•ä½pod" class="headerlink" title="æœ€å°è°ƒåº¦å•ä½pod"></a>æœ€å°è°ƒåº¦å•ä½pod</h3><p>Podæ˜¯k8sé›†ç¾¤ä¸­è¿è¡Œéƒ¨ç½²åº”ç”¨æˆ–æœåŠ¡çš„æœ€å°å•å…ƒï¼Œä¸€ä¸ªPodç”±ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ç»„æˆï¼Œkubernetesä¸­ä¸å¯¹å®¹å™¨è¿›è¡Œç›´æ¥æ“ä½œã€‚åœ¨ä¸€ä¸ªPodä¸­ï¼Œå®¹å™¨å…±äº«ç½‘ç»œå’Œå­˜å‚¨ï¼Œå¹¶ä¸”åœ¨ä¸€ä¸ªNodeä¸Šè¿è¡Œã€‚</p>
<p>Kubernetesä¸ºæ¯ä¸ªPodéƒ½åˆ†é…äº†å”¯ä¸€çš„IPåœ°å€ï¼Œç§°ä¹‹ä¸ºPod IPï¼Œä¸€ä¸ªPodé‡Œçš„å¤šä¸ªå®¹å™¨å…±äº«Pod IPåœ°å€ã€‚Kubernetesè¦æ±‚åº•å±‚ç½‘ç»œæ”¯æŒé›†ç¾¤å†…ä»»æ„ä¸¤ä¸ªPodä¹‹é—´çš„TCP/IPç›´æ¥é€šä¿¡ï¼Œè¿™é€šå¸¸é‡‡ç”¨è™šæ‹ŸäºŒå±‚ç½‘ç»œæŠ€æœ¯æ¥å®ç°ï¼Œä¾‹å¦‚Flannelã€Open vSwitchç­‰ã€‚å› æ­¤ï¼Œåœ¨Kubernetesé‡Œï¼Œä¸€ä¸ªPodé‡Œçš„å®¹å™¨ä¸å¦å¤–ä¸»æœºä¸Šçš„Podå®¹å™¨èƒ½å¤Ÿç›´æ¥é€šä¿¡ã€‚</p>
<p>podå…·æœ‰å¦‚ä¸‹çš„ä¸€äº›ç‰¹æ€§ï¼š</p>
<ul>
<li>podå…±äº«ä¸€ä¸ªnamespaceï¼ˆåŒ…å«ç”¨æˆ·ã€ç½‘ç»œã€å­˜å‚¨ç­‰ï¼‰<ul>
<li>å¦‚æœä¸€ä¸ªpodä¸­æœ‰ä¸¤ä¸ªContainerï¼Œåˆ™è¿™ä¸¤ä¸ªContainerå¯ä»¥ç›´æ¥é€šè¿‡localhostè¿›è¡Œé€šä¿¡ï¼Œå¦‚åŒåœ¨æœ¬åœ°ä¸€ä¸ªLinuxä¸Šè¿è¡Œçš„ä¸¤ä¸ªè¿›ç¨‹</li>
</ul>
</li>
</ul>
<p>åŸºæœ¬æ“ä½œä¾‹å­ï¼š</p>
<p>pod_nginx.ymlæ–‡ä»¶ï¼ˆæ ¹æ®kubernetesæä¾›çš„ä¸€ä¸ªAPIæ ¼å¼å®šä¹‰ä¸€ä¸ªèµ„æºï¼Œè¿™é‡Œæ˜¯podï¼‰ï¼š</p>
<pre><code class="yaml">apiVersion: v1
kind: Pod #èµ„æºç±»å‹
metadata:
  name: nginx #podåå­—
  labels:
    app: nginx
spec: #podä¸­çš„å…³é”®éƒ¨åˆ†
  containers: #å¯ä»¥åŒ…å«å¤šä¸ªå®¹å™¨
  - name: nginx #ç¬¬ä¸€ä¸ªContainer Containeråå­—
    image: nginx
    ports:
    - containerPort: 80</code></pre>
<p>åˆ›å»ºåŠåŸºæœ¬ç®¡ç†ï¼š</p>
<pre><code class="bash">#æŸ¥çœ‹kubernetesé›†ç¾¤æ˜¯å¦æ­£å¸¸
kubectl version

#æ ¹æ®pod_nginx.ymlåˆ›å»ºpod
kubectl create -f pod_nginx.yml
#kubectl delete -f pod_nginx.yml#åˆ é™¤pod
#æŸ¥çœ‹pod
kubectl get pods
#æ˜¾ç¤ºpodçš„è¯¦ç»†ä¿¡æ¯(åŒ…æ‹¬å®¹å™¨çš„ip(172.17.0.4)ã€åœ¨é‚£ä¸ªèŠ‚ç‚¹ä¸Š)
kubectl get pods -o wide

#è¿›å…¥minikubeä¸­çš„è™šæ‹Ÿæœºä¸­
minikube ssh
#æŸ¥çœ‹è™šæ‹Ÿæœºä¸­container
docker ps
#è¿›å…¥å®¹å™¨å†…éƒ¨
docker exec -it å®¹å™¨id sh
#é€€å‡ºå®¹å™¨
exit
#æŸ¥çœ‹bridgeç½‘ç»œçš„è¯¦ç»†æƒ…å†µ å¯ä»¥æ‰¾åˆ°åˆ›å»ºçš„iginxè¿æ¥åˆ°äº†bridgeç½‘ç»œä¸Šï¼ˆip:172.17.0.4/16ï¼‰
docker network inspect bridge
exit#é€€å‡ºminikube

#ç›´æ¥å¯¹podè¿›è¡Œå¯äº¤äº’çš„æ“ä½œï¼Œè¿›å…¥podä¸­çš„ç¬¬ä¸€ä¸ªå®¹å™¨å†…éƒ¨ï¼ˆå¯ä»¥é€šè¿‡-cæŒ‡å®šè¿›å…¥é‚£ä¸ªå®¹å™¨å†…éƒ¨ï¼Œé»˜è®¤ç¬¬ä¸€ä¸ªï¼‰ æ‰§è¡Œsh
kubectl exec -it nginx(podåå­—) sh
#å…·ä½“æè¿°ä¸€ä¸ªpod
kubectl desrcibe pods nginx(podåå­—)

#å°†minikubeä¸­çš„80ç«¯å£æš´éœ²å‡ºæ¥ä¸º8080ç«¯å£
kubectl port-forward nginx8080:80#ä¸€æ—¦åœæ­¢ï¼Œç«¯å£æ˜ å°„å°±ä¼šåœæ­¢</code></pre>
<h3 id="æ¨ªå‘æ‰©å±•"><a href="#æ¨ªå‘æ‰©å±•" class="headerlink" title="æ¨ªå‘æ‰©å±•"></a>æ¨ªå‘æ‰©å±•</h3><p><strong>ReplicationController</strong>ç§ç±»ï¼š</p>
<p>rc_nginx.ymlæ–‡ä»¶ï¼š</p>
<pre><code class="yaml">apiVersion: v1
kind: ReplicationController 
metadata:
  name: nginx
spec:
  replicas: 3 #3ä¸ªæ¨ªå‘æ‰©å±•
  selector:
    app: nginx
  template:
    metadata:
      name: nginx
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx
        ports:
        - containerPort: 80</code></pre>
<ul>
<li>é€šè¿‡ReplicationControlleråˆ›å»ºçš„podï¼Œkubernetesèƒ½å¤Ÿè‡ªåŠ¨å¸®æˆ‘ä»¬ç»´æŒå¯¹åº”æ•°é‡çš„pods</li>
</ul>
<p>åˆ›å»ºï¼š</p>
<pre><code class="bash">#æ ¹æ®rc_nginx.ymlåˆ›å»ºpod
kubectl create -f rc_nginx.yml

#æŸ¥çœ‹ ReplicationController æƒ…å†µ
kubectl get rc
#æŸ¥çœ‹pod(å¯ä»¥å‘ç°æœ‰3ä¸ªpod)
kubectl get pods

#å°è¯•åˆ é™¤ä¸€ä¸ªpod
kubectl delete pods podçš„id(é€šè¿‡get podsæŸ¥è¯¢)
#å†æ¬¡æŸ¥çœ‹pod(å‘ç°ä»æœ‰3ä¸ªpod)
kubectl get pods


#æ¨ªå‘æ‰©å±• ä¿®æ”¹ä¸º2
kubectl scale rc nginx(åå­—) --replicas=2
kubectl get pods#æŸ¥çœ‹ååªæœ‰ä¸¤ä¸ª
kubectl get rc</code></pre>
<p><strong>ReplicaSet</strong>ç§ç±»ï¼š</p>
<p>rs_nginx.ymlæ–‡ä»¶ï¼š</p>
<pre><code class="yaml">apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: nginx
  labels:
    tier: frontend
spec:
  replicas: 3 #3ä¸ªæ¨ªå‘æ‰©å±•
  selector:
    matchLabels:
      tier: frontend
  template:
    metadata:
      name: nginx
      labels:
        tier: frontend
    spec:
      containers:
      - name: nginx
        image: nginx
        ports:
        - containerPort: 80</code></pre>
<ul>
<li>ReplicaSetæ˜¯ReplicationControllerçš„å‡çº§ç‰ˆï¼ŒReplicaSetæ”¯æŒnew set-based selector</li>
</ul>
<p>åˆ›å»ºï¼š</p>
<pre><code class="bash">#æ ¹æ®rs_nginx.ymlåˆ›å»ºpod
kubectl create -f rs_nginx.yml

#æŸ¥çœ‹ ReplicaSet æƒ…å†µ
kubectl get rs
#æŸ¥çœ‹pod(å¯ä»¥å‘ç°æœ‰3ä¸ªpod)
kubectl get pods

#æ¨ªå‘æ‰©å±• ä¿®æ”¹ä¸º2
kubectl scale rs nginx(åå­—) --replicas=2
kubectl get pods#æŸ¥çœ‹ååªæœ‰ä¸¤ä¸ª
kubectl get rs</code></pre>
<h3 id="Deployments"><a href="#Deployments" class="headerlink" title="Deployments"></a>Deployments</h3><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener">https://kubernetes.io/docs/concepts/workloads/controllers/deployment/</a></p>
<p>Deploymentsæ§åˆ¶å™¨æä¾›äº†Podå’ŒReplicaSetsçš„å£°æ˜æ€§æ›´æ–°ã€‚å³Deploymentsä¼šæè¿°ä¸€ç§å¸Œæœ›çš„çŠ¶æ€ï¼Œå¦‚æœ‰ä¸‰ä¸ªæ‰©å±•ï¼ˆâ€“replicas=3ï¼‰ã€podä¸­çš„å…·ä½“çš„docker imageç‰ˆæœ¬ä»¥åŠç›¸å…³çš„æ›´æ–°ï¼ŒDeployments controlleréƒ½ä¼šåŠªåŠ›ä½¿è¯¥å£°æ˜å®ç°ï¼ˆDeploymentsä¼šé€šè¿‡åˆ›å»ºReplicaSetè¿›è€Œæ¥åˆ›å»ºpodsï¼‰</p>
<p>æ³¨æ„ï¼šä¸èƒ½ç‹¬ç«‹å¯¹ é€šè¿‡Deploymentsåˆ›å»ºçš„Podå’ŒReplicaSets è¿›è¡Œæ“ä½œï¼ˆå°¤å…¶æ˜¯åˆ é™¤æ“ä½œï¼‰</p>
<h4 id="åˆ›å»ºå’Œç®¡ç†"><a href="#åˆ›å»ºå’Œç®¡ç†" class="headerlink" title="åˆ›å»ºå’Œç®¡ç†"></a>åˆ›å»ºå’Œç®¡ç†</h4><p>deployment_nginx.ymlæ–‡ä»¶ï¼š</p>
<pre><code class="yaml">apiVersion: apps/v1
kind: Deployment #ç±»å‹ä¸ºDeployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
  replicas: 3  #æ­¤å¤„å…¶å®å°±æ˜¯ReplicaSet ä¿è¯podçš„æ•°é‡
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:  #æŒ‡å®špodéœ€è¦çš„Container
      containers:
      - name: nginx  #Containeråå­—
        image: nginx:1.12.2  #Container image
        ports:
        - containerPort: 80</code></pre>
<p>åˆ›å»ºï¼š</p>
<pre><code class="bash">#æ ¹æ®deployment_nginx.ymlåˆ›å»ºDeployment
kubectl create -f deployment_nginx.yml

#æŸ¥çœ‹Deployment
kubectl get deployment
#æŸ¥çœ‹ ReplicaSet æƒ…å†µ
kubectl get rs
#æŸ¥çœ‹ pod æƒ…å†µ
kubectl get pods</code></pre>
<p>Deploymentç›¸å…³å‘½ä»¤ï¼š</p>
<pre><code class="bash">#æŸ¥çœ‹Deployment
kubectl get deployment
#æŸ¥çœ‹Deployment æ˜¾ç¤ºæ›´å¤šä¿¡æ¯
kubectl get deployment -o wide

#å¯¹deploymentä¸­çš„imageè¿›è¡Œå‡çº§
kubectl set image deployment(resource) nginx-deployment(åå­—) nginx=nginx:1.13(image)
#æŸ¥çœ‹Deployment æ˜¾ç¤ºæ›´å¤šä¿¡æ¯ï¼ˆåŒ…æ‹¬imageç‰ˆæœ¬ï¼‰
kubectl get deployment -o wide
#æŸ¥çœ‹ ReplicaSet æƒ…å†µ
kubectl get rs#ä¼šå‘ç°å­˜åœ¨ä¸€ä¸ªæ—§çš„ï¼ˆåœæ­¢ï¼‰ä¸€ä¸ªæ–°çš„
#æŸ¥çœ‹ pod æƒ…å†µ
kubectl get pods

#æŸ¥çœ‹æ•´ä¸ª deployment çš„å†å²
kubectl rollout history deployment(resource) nginx-deployment(åå­—)
#é€€å› deployment çš„ä¹‹å‰ç‰ˆæœ¬ï¼ˆå³æ²¡æœ‰æ›´æ–°imageä¹‹å‰ï¼‰
kubectl rollout undo deployment(resource) nginx-deployment(åå­—)
#æŸ¥çœ‹Deployment æ˜¾ç¤ºæ›´å¤šä¿¡æ¯ï¼ˆåŒ…æ‹¬imageç‰ˆæœ¬ï¼‰
kubectl get deployment -o wide

#æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ï¼ˆipåœ°å€ï¼‰
kubectl get node -o wide</code></pre>
<h3 id="ä½¿ç”¨Tectonicæ­å»ºæœ¬åœ°å¤šèŠ‚ç‚¹"><a href="#ä½¿ç”¨Tectonicæ­å»ºæœ¬åœ°å¤šèŠ‚ç‚¹" class="headerlink" title="ä½¿ç”¨Tectonicæ­å»ºæœ¬åœ°å¤šèŠ‚ç‚¹"></a>ä½¿ç”¨Tectonicæ­å»ºæœ¬åœ°å¤šèŠ‚ç‚¹</h3><p><a href="https://coreos.com/tectonic/" target="_blank" rel="noopener">Tectonic</a>ä¸ºCoreOSçš„äº§å“ï¼šæ”¶è´¹ä¼ä¸šçº§äº§å“ï¼Œå¯å…è´¹è¯•ç”¨ã€‚</p>
<p>æ­å»ºæœ¬åœ°å¤šèŠ‚ç‚¹æ•™ç¨‹ï¼š<a href="https://coreos.com/tectonic/docs/latest/tutorials/sandbox/install.html" target="_blank" rel="noopener">https://coreos.com/tectonic/docs/latest/tutorials/sandbox/install.html</a>ï¼ˆå®æµ‹Tectonicä¸‹çš„sandboxå·²ç»ä¸èƒ½æ­£å¸¸è·å–ï¼ï¼ï¼è¯¥å®éªŒæ— æ³•æ­£å¸¸è¿›è¡Œï¼ï¼ï¼ï¼‰</p>
<p>æœ¬è´¨æ˜¯é€šè¿‡vagrantåœ¨virtualboxä¸Šåˆ›å»ºå¤šå°è™šæ‹Ÿæœºï¼ˆCoreOSç³»ç»Ÿï¼ŒContainer Linuxï¼‰</p>
<p>ä¿®æ”¹kubeconfigæ–‡ä»¶ï¼Œä½¿kubectlå‘½ä»¤åŒæ—¶æ”¯æŒminikubeå’Œtectnicï¼ˆä¿®æ”¹kubeconfigæ–‡ä»¶ï¼Œæ·»åŠ æ–°çš„clusterã€contextã€userï¼Œå…·ä½“é…ç½®å¯ä»¥å‚çœ‹<a href="https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/" target="_blank" rel="noopener">å®˜æ–¹è¯´æ˜</a>ï¼‰ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯ä»¥è¿›è¡Œåˆ‡æ¢ï¼š</p>
<pre><code class="bash">#æŸ¥çœ‹ç›®å‰çš„ä¸Šä¸‹æ–‡å˜é‡
kubectl config get-contexts
#åˆ‡æ¢
kubectl config use-context ä¸Šä¸€ä¸ªå‘½ä»¤ä¸­çš„NAMEæ åå­—</code></pre>
<h3 id="åŸºç¡€ç½‘ç»œCluster-Network"><a href="#åŸºç¡€ç½‘ç»œCluster-Network" class="headerlink" title="åŸºç¡€ç½‘ç»œCluster Network"></a>åŸºç¡€ç½‘ç»œCluster Network</h3><p>Cluster Networkçš„<a href="https://kubernetes.io/docs/concepts/cluster-administration/networking" target="_blank" rel="noopener">å®˜æ–¹è¯´æ˜</a></p>
<p>pod_busybox.ymlæ–‡ä»¶ï¼š</p>
<pre><code class="yaml">apiVersion: v1
kind: Pod
metadata:
  name: busybox-pod
  labels:
    app: busybox
spec:
  containers:
  - name: busybox-container
    image: busybox
    command:
      - sleep
      - &quot;360000&quot;</code></pre>
<p>pod_nginx.ymlæ–‡ä»¶ï¼š</p>
<pre><code class="yaml">apiVersion: v1
kind: Pod
metadata:
  name: nginx-pod
  labels:
    app: nginx
spec:
  containers:
  - name: nginx-container
    image: nginx
    ports:
    - name: nginx-port
      containerPort: 80</code></pre>
<p>service_nginx.ymlæ–‡ä»¶ï¼š</p>
<pre><code class="yaml">apiVersion: v1
kind: Service
metadata:
  name: nginx-service
spec:
  ports:
  - port: 8080
    nodePort: 8080
    targetPort: nginx-port
    protocol: TCP
  selector:
    app: nginx
  type: NodePort</code></pre>
<p>w1èŠ‚ç‚¹ä¸Šï¼š</p>
<pre><code class="bash">#æ ¹æ®.ymlåˆ›å»ºpod
kubectl create -f pod_busybox.yml
kubectl create -f pod_nginx.yml

#æŸ¥çœ‹å…·ä½“æƒ…å†µ
kubectl get pods -o wide
#ä¸¤ä¸ªpodè¯¦ç»†æƒ…å†µï¼š
#busybox-pod ip:10.2.0.50  èŠ‚ç‚¹w1
#nginx-pod   ip:10.2.0.51  èŠ‚ç‚¹w1

#åœ¨w1ä¸­ï¼ˆæœªè¿›å…¥podä¸­ï¼‰ping
ping 10.2.0.50#èƒ½å¤Ÿpingé€š
ping 10.2.0.51#èƒ½å¤Ÿpingé€š

#è¿›å…¥busybox-pod
kubectl exec -it busybox-pod sh
#æŸ¥çœ‹ip
ip a
#å°è¯•ping nginx-pod
ping 10.2.0.51#èƒ½å¤Ÿpingé€š</code></pre>
<p>c1èŠ‚ç‚¹ï¼š</p>
<pre><code class="bash">#c1èŠ‚ç‚¹ping w1èŠ‚ç‚¹ä¸Šçš„busybox-pod
ping 10.2.0.50#èƒ½å¤Ÿpingé€š
#c1èŠ‚ç‚¹ping w1èŠ‚ç‚¹ä¸Šçš„nginx-pod
ping 10.2.0.51#èƒ½å¤Ÿpingé€š</code></pre>
<p>ä¸Šè¿°ç½‘ç»œå…³ç³»çš„æ‹“æ‰‘å›¾ï¼š</p>
<p><img src="//NU-LL.github.io/2020/01/16/Docker/image-20200225225507153.png" alt="ç½‘ç»œå…³ç³»æ‹“æ‰‘å›¾"></p>
<ul>
<li>flannelæ’ä»¶ï¼šcoreoså‡ºå“ï¼Œå¼€æºå…è´¹ï¼Œé€šè¿‡è¯¥æ’ä»¶å®ç°äº†ä¸¤å°æœºå™¨ä¹‹é—´çš„overlayç½‘ç»œ</li>
<li>è¯¸å¦‚flannelæ’ä»¶çš„å…¶ä»–å¼€æºæ’ä»¶è¿˜æœ‰å¾ˆå¤šï¼Œåœ¨æœ¬èŠ‚å¼€å¤´çš„ç½‘å€è¿›å…¥åä¼šæœ‰å…¶ä»–æ’ä»¶ä»‹ç»è¯´æ˜ä»¥åŠæ’ä»¶å¿…é¡»éµå®ˆçš„åŸåˆ™</li>
</ul>
<h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><p>åœ¨clusterä¸­ï¼Œæ¯ä¸ªpodéƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ipåœ°å€ï¼Œå¹¶ä¸”éƒ½èƒ½å¤Ÿç›¸äº’pingé€šï¼Œä¸è®ºpodæ˜¯å¦åœ¨åŒä¸€å°è®¾å¤‡ï¼ˆèŠ‚ç‚¹ï¼‰ä¸Šï¼ˆæœºå™¨æœ¬èº«ä¹Ÿèƒ½å¤Ÿpingé€šä»»æ„ä¸€ä¸ªpodçš„ipåœ°å€ï¼Œè¯¦è§ä¸Šä¸€èŠ‚ï¼‰</p>
<p>æ³¨æ„ï¼šä¸è¦ç›´æ¥å»ä½¿ç”¨å’Œç®¡ç†podsï¼š</p>
<ul>
<li>å½“æˆ‘ä»¬ä½¿ç”¨ ReplicaSet æˆ–è€… ReplicationController æ°´å¹³æ‰©å±• scale çš„æ—¶å€™,Podsæœ‰å¯èƒ½ä¼šè¢« terminated(ç»ˆæ­¢)</li>
<li>å½“æˆ‘ä»¬ä½¿ç”¨ Deployment çš„æ—¶å€™,æˆ‘ä»¬å»æ›´æ–° Docker Image Version,æ—§çš„Podsä¼šè¢« terminated(ç»ˆæ­¢),ç„¶åæ–°çš„Podsåˆ›å»º</li>
</ul>
<p>åœ¨Kubernetesä¸­ï¼ŒPodä¼šç»å†â€œç”Ÿè€ç—…æ­»â€è€Œæ— æ³•å¤æ´»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ†é…ç»™Podçš„IPä¼šéšç€Podçš„é”€æ¯è€Œæ¶ˆå¤±ï¼Œè¿™å°±å¯¼è‡´ä¸€ä¸ªé—®é¢˜â€”â€”å¦‚æœæœ‰ä¸€ç»„Podç»„æˆä¸€ä¸ªé›†ç¾¤æ¥æä¾›æœåŠ¡ï¼ŒæŸäº›Podæä¾›åç«¯æœåŠ¡APIï¼ŒæŸäº›Podæä¾›å‰ç«¯ç•Œé¢UIï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•ä¿è¯å‰ç«¯èƒ½å¤Ÿç¨³å®šåœ°è®¿é—®è¿™äº›åç«¯æœåŠ¡å‘¢ï¼Ÿè¿™å°±æ˜¯Serviceçš„ç”±æ¥ã€‚</p>
<p>Serviceåœ¨Kubernetesä¸­æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼Œå®ƒå®šä¹‰äº†ä¸€ç»„é€»è¾‘ä¸Šçš„Podå’Œä¸€ä¸ªè®¿é—®å®ƒä»¬çš„ç­–ç•¥ï¼ˆé€šå¸¸ç§°ä¹‹ä¸ºå¾®æœåŠ¡ï¼‰ã€‚è¿™ä¸€ç»„Podèƒ½å¤Ÿè¢«Serviceè®¿é—®åˆ°ï¼Œé€šå¸¸æ˜¯é€šè¿‡Labelé€‰æ‹©å™¨ç¡®å®šçš„ã€‚</p>
<p>åˆ›å»ºserviceï¼š</p>
<p>1ã€å‘½ä»¤è¡Œåˆ›å»º</p>
<pre><code class="bash">#ç»™podåˆ›å»ºservice ä¾›å¤–éƒ¨è®¿é—®
kubectl expoese &lt;resources&gt; &lt;resourcesåå­—&gt;</code></pre>
<p>2ã€ymlæ–‡ä»¶ä¸­é€šè¿‡<code>kind: Service</code>å®šä¹‰ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç§service</p>
<ul>
<li><strong>ClusterIP</strong>ï¼šipåœ°å€æ˜¯clusterå†…éƒ¨å‡å¯ä»¥è®¿é—®çš„ï¼Œä½†æ˜¯å¤–ç•Œç¼ºæ— æ³•è®¿é—®ï¼ˆè¿™ç§å†…éƒ¨çš„ipç§°ä¸ºClusterIPï¼‰ï¼Œå¤–ç•Œå¯ä»¥é€šè¿‡serviceçš„ipè®¿é—®ï¼ˆä¸€èˆ¬serviceçš„ipä¸ä¼šå˜åŠ¨ï¼Œè€Œpodçš„ipä¼šå˜åŠ¨ï¼‰</li>
<li><strong>NodePort</strong>ï¼šå°†è¦è®¿é—®çš„portç»‘å®šåˆ°æ‰€æœ‰nodeä¸Šï¼Œå› ä¸ºnodeå¯¹å¤–å¯ä»¥æä¾›è®¿é—®ï¼ˆå‡è®¾nodeçš„ipä¸ºå…¬ç½‘ipï¼‰ï¼Œæ‰€ä»¥è¯¥ç±»å‹çš„serviceå¤–ç•Œä¹Ÿæ˜¯å¯ä»¥è®¿é—®çš„ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼æš´éœ²çš„portæœ‰èŒƒå›´é™åˆ¶ï¼ˆ30000-32767ï¼‰</li>
<li><strong>LoadBalancer</strong>ï¼šä¸€èˆ¬éœ€è¦ç»“åˆäº‘æœåŠ¡ä½¿ç”¨ï¼Œç”±äº‘æœåŠ¡å•†æä¾›ã€‚å®é™…ç¯å¢ƒä¸­è¿ç”¨è¾ƒå¤š</li>
<li><strong>ExternalName</strong>ï¼šé€šè¿‡DNSçš„æ–¹å¼ã€‚å®é™…ç¯å¢ƒä¸­è¿ç”¨è¾ƒå¤š</li>
<li>Defaultï¼šå³ClusterIPï¼Œé»˜è®¤ä¸ºClusterIPæ–¹å¼</li>
</ul>
<p>ä»¥ä¸Šå‡æ˜¯é€šè¿‡ipåœ°å€è®¿é—®çš„ï¼Œä½†æ˜¯å…¶å®ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡dnsè®¿é—®ï¼Œä½†æ˜¯éœ€è¦ç›¸å…³çš„æ’ä»¶</p>
<hr>
<p>ClusterIPçš„ç›¸å…³ä¾‹å­ï¼š</p>
<p>ä¾‹å­1ï¼š</p>
<p>w1èŠ‚ç‚¹ä¸Šï¼š</p>
<pre><code class="bash">#æ ¹æ®ä¸Šä¸€èŠ‚.ymlåˆ›å»ºpod
kubectl create -f pod_busybox.yml
kubectl create -f pod_nginx.yml

#æŸ¥çœ‹å…·ä½“æƒ…å†µ
kubectl get pods -o wide
#ä¸¤ä¸ªpodè¯¦ç»†æƒ…å†µï¼š
#busybox-pod ip:10.2.0.254  èŠ‚ç‚¹w1
#nginx-pod   ip:10.2.0.252  èŠ‚ç‚¹w1

#åˆ›å»ºservice
kubectl expoese pods nginx-pod

#æŸ¥çœ‹serviceçŠ¶æ€
kubectl get svc
#service name:nginx-pod  ip:10.3.248.3</code></pre>
<p>c1èŠ‚ç‚¹ï¼š</p>
<pre><code class="bash">curl 10.3.248.3#å¯ä»¥ç›´æ¥é€šè¿‡serviceè®¿é—®pod</code></pre>
<hr>
<p>ä¾‹å­2ï¼š</p>
<p>deployment_python_http.ymlæ–‡ä»¶ï¼š</p>
<pre><code class="yaml">apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: service-test
spec:
  replicas: 2
  selector:
    matchLabels:
      app: service_test_pod
  template:
    metadata:
      labels:
        app: service_test_pod
    spec:
      containers:
      - name: simple-http
        image: python:2.7
        imagePullPolicy: IfNotPresent
        command: [&quot;/bin/bash&quot;]
        args: [&quot;-c&quot;, &quot;echo \&quot;&lt;p&gt;Hello from $(hostname)&lt;/p&gt;\&quot; &gt; index.html; python -m SimpleHTTPServer 8080&quot;]
        ports:
        - name: http
          containerPort: 8080</code></pre>
<p>w1èŠ‚ç‚¹ä¸Šï¼š</p>
<pre><code class="bash">#docker pull python:2.7
#æ ¹æ®.ymlæ–‡ä»¶åˆ›å»ºDeployment
kubectl create -f deployment_python_http.yml

kubectl get pods -o wide
#pod1 name:service-test-1863849916-b13b6 ip:10.2.0.142  èŠ‚ç‚¹w1
#pod2 name:service-test-1863849916-ts7xr ip:10.2.0.141  èŠ‚ç‚¹w1</code></pre>
<p>c1èŠ‚ç‚¹ä¸Šï¼š</p>
<pre><code class="bash">curl 10.2.0.142:8080#å¯ä»¥ç›´æ¥è®¿é—®pod1
&lt;p&gt;Hello from service-test-1863849916-b13b6&lt;/p&gt;
curl 10.2.0.141:8080#å¯ä»¥ç›´æ¥è®¿é—®pod2
&lt;p&gt;Hello from service-test-1863849916-ts7xr&lt;/p&gt;</code></pre>
<p>w1èŠ‚ç‚¹ä¸Šï¼š</p>
<pre><code class="bash">#æŸ¥çœ‹deploymentæƒ…å†µ
kubectl get deployment
#åˆ›å»ºdeploymentæœåŠ¡service-test
kubectl expose deployment service-test
#æŸ¥çœ‹æœåŠ¡æƒ…å†µ
kubectl get svc
#service name: service-test  ip:10.3.120.168</code></pre>
<p>c1èŠ‚ç‚¹ä¸Šï¼š</p>
<pre><code class="bash">curl 10.3.120.168:8080#å¯ä»¥ç›´æ¥é€šè¿‡serviceè®¿é—®pod
&lt;p&gt;Hello from service-test-1863849916-b13b6&lt;/p&gt;
curl 10.3.120.168:8080#å¯ä»¥ç›´æ¥é€šè¿‡serviceè®¿é—®pod
&lt;p&gt;Hello from service-test-1863849916-ts7xr&lt;/p&gt;
curl 10.3.120.168:8080#å¯ä»¥ç›´æ¥é€šè¿‡serviceè®¿é—®pod
&lt;p&gt;Hello from service-test-1863849916-ts7xr&lt;/p&gt;
curl 10.3.120.168:8080#å¯ä»¥ç›´æ¥é€šè¿‡serviceè®¿é—®pod
&lt;p&gt;Hello from service-test-1863849916-b13b6&lt;/p&gt;
...</code></pre>
<ul>
<li>è®¿é—®service ipä¼šè‡ªåŠ¨åšä¸€ä¸ª<strong>è´Ÿè½½å‡è¡¡</strong></li>
</ul>
<hr>
<p>ä¾‹å­3ï¼š</p>
<p>æ¥ä¾‹å­2ä¸­çš„æ¢ä»¶ï¼Œåœ¨c1ä¸­ï¼š</p>
<pre><code class="bash">#ä¸åœåœ°è°ƒç”¨
while true; do curl 10.3.120.168:8080; done</code></pre>
<p>w1èŠ‚ç‚¹ä¸­ï¼š</p>
<pre><code class="bash">#ç›´æ¥ç¼–è¾‘deployment_python_http.yml è¾¾åˆ°åº”ç”¨å‡çº§
kubectl edit deployment service-test#ä¼šè‡ªåŠ¨æ‰“å¼€deployment_python_http.ymlæ–‡ä»¶
#å°† Hello from $(hostname) ä¿®æ”¹ä¸º Hello new version from $(hostname)

#æŸ¥çœ‹pods
kubectl get pods#å¯ä»¥çœ‹åˆ°æ—§çš„podså·²ç»ç»ˆæ­¢ï¼ŒåŒæ—¶ä¼šç”Ÿæˆå¹¶è¿è¡Œä¸€ä¸ªæ–°çš„pods</code></pre>
<ul>
<li>ä¿®æ”¹deployment_python_http.ymlæ–‡ä»¶åï¼Œc1ä¸­çš„ç¨‹åºæ£€æµ‹åˆ°è¯¥æœåŠ¡ä¼šåœæ­¢ä¸€æ®µæ—¶é—´ï¼Œä½†æ˜¯æœ€åä¼šæ¢å¤è‡³æ­£å¸¸</li>
<li>è¯¥æ›´æ–°å¹¶ä¸æ˜¯Rolling Updataï¼Œå³å¹¶ä¸æ˜¯é›¶å®•æœºæ›´æ–°ï¼Œæœ‰ä¸€æ®µæ—¶é—´ä¼šå­˜åœ¨ä¸èƒ½è®¿é—®æœåŠ¡å™¨</li>
</ul>
<h3 id="NodePortç±»å‹serviceä»¥åŠLabelç®€å•åº”ç”¨"><a href="#NodePortç±»å‹serviceä»¥åŠLabelç®€å•åº”ç”¨" class="headerlink" title="NodePortç±»å‹serviceä»¥åŠLabelç®€å•åº”ç”¨"></a>NodePortç±»å‹serviceä»¥åŠLabelç®€å•åº”ç”¨</h3><p>æ¼”ç¤ºï¼š</p>
<p>serviceä¸­ï¼ˆc1èŠ‚ç‚¹pod_nginx.ymlï¼‰ï¼š</p>
<p>åˆ›å»ºpod_nginx.ymlï¼š</p>
<pre><code class="yaml">apiVersion: v1
kind: Pod
metadata:
  name: nginx-pod
  labels:
    app: nginx #å…·ä½“çš„labelï¼Œä¸åæ–‡ä¸­çš„serviceçš„ymlæ–‡ä»¶ä¸­çš„labelå¯¹åº”
spec:
  containers:
  - name: nginx-container
    image: nginx
    ports:
    - name: nginx-port #ç«¯å£åå­—
      containerPort: 80 #å…·ä½“çš„ç«¯å£</code></pre>
<ul>
<li>labelsï¼šå‡ ä¹æ‰€æœ‰çš„èµ„æºéƒ½å¯ä»¥è®¾ç½®ä¸€ä¸ªlabelï¼Œç”±ä¸€å¯¹key valueç»„æˆï¼Œä¸”å¯ä»¥è®¾ç½®ä¸æ­¢ä¸€ä¸ª</li>
</ul>
<pre><code class="bash">#åˆ›å»ºpod
kubectl create -f pod_nginx.yml
#æŸ¥çœ‹çŠ¶æ€
kubectl get pods -o wide

#é€šè¿‡exposeç»™æ”¹podåˆ›å»ºä¸€ä¸ªNodePortç±»å‹çš„service
kubectl expose pods nginx-pod --type=NodePort
#æŸ¥çœ‹çŠ¶æ€
kubectl get svc
#name:kubernetes ClusterIP ip:10.3.0.1 port:443/TCP
#name:nginx-pod NodePort ip:10.3.38.138 port:80:31404/TCP
kubectl get node -o wide
#æŸ¥çœ‹c1çš„ip
kubectl describe node c1çš„id#172.17.4.101
#æŸ¥çœ‹w1çš„ip
kubectl describe node w1çš„id#172.17.4.201

#åˆ é™¤è¯¥serviceï¼Œæ³¨æ„podè¿˜åœ¨
kubectl delete service nginx-pod</code></pre>
<ul>
<li>ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€<code>172.17.4.101:31404</code>æˆ–<code>172.17.4.201:31404</code>å³å¯æ­£å¸¸è®¿é—®Nginx</li>
</ul>
<p><strong>NodePort</strong>ç±»å‹çš„serviceä¼šå°†ç«¯å£æ˜ å°„åˆ°æ•´ä¸ªClusterä¸Šçš„æ¯ä¸ªnodeçš„ipåœ°å€ä¸Šï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡Clusterçš„ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„ipåœ°å€+ç«¯å£å»è®¿é—®æœåŠ¡</p>
<p>ç±»ä¼¼åˆ›å»ºpodï¼Œè¯¥serviceä¹Ÿå¯ä»¥é€šè¿‡<code>.yml</code>æ–‡ä»¶ï¼ˆservice_nginx.ymlï¼‰åˆ›å»ºï¼š</p>
<pre><code class="yaml">apiVersion: v1
kind: Service #åˆ›å»ºservice
metadata:
  name: nginx-service #åå­—
spec:
  ports:
  - port: 32333 #éœ€è¦æš´éœ²çš„ç«¯å£
    nodePort: 32333 #æš´éœ²åˆ°nodeportä¸Š
    targetPort: nginx-port #ç›®æ ‡ç«¯å£åï¼Œå¯¹åº”ä¸Šè¿°podçš„ymlæ–‡ä»¶ä¸­æè¿°çš„port
    protocol: TCP
  selector: #é€šè¿‡labelå»é€‰æ‹©åˆ°åº•æš´éœ²é‚£ä¸ªpod
    app: nginx
  type: NodePort #åˆ›å»ºserviceçš„ç±»å‹</code></pre>
<ul>
<li>æ³¨æ„<code>selector</code>åº”è¯¥å’Œä¸Šæ–‡ä¸­çš„podåˆ›å»ºæ—¶æŒ‡åçš„labelä¸€è‡´ï¼ŒæŒ‡åæ˜¯è¯¥pod</li>
</ul>
<p>å†æ¬¡åˆ›å»ºï¼š</p>
<pre><code class="bash">#æŸ¥çœ‹è¿è¡Œä¸­çš„podçš„labelæ˜¯å¦å’Œymlæ–‡ä»¶ä¸­æè¿°çš„å»åˆ
kubectl get pods --show-labels

#åˆ›å»ºservice
kubectl create -f service_nginx.yml
#æŸ¥çœ‹
kubectl get svc
#name:kubernetes ClusterIP ip:10.3.0.1 port:443/TCP
#name:nginx-pod NodePort ip:10.3.124.158 port:32333:32333/TCP</code></pre>
<ul>
<li>æ­¤æ—¶ï¼Œç›´æ¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€<code>172.17.4.101:32333</code>æˆ–<code>172.17.4.201:32333</code>å³å¯æ­£å¸¸è®¿é—®Nginx</li>
</ul>
<hr>
<p>labelä¾‹å­æ¼”ç¤ºï¼š</p>
<p>ç”±ä¸Šæ–‡ä¸­æåˆ°çš„ï¼Œå‡ ä¹æ‰€æœ‰çš„èµ„æºéƒ½å¯ä»¥è®¾ç½®ä¸€ä¸ªlabelï¼Œç”±ä¸€å¯¹key valueç»„æˆï¼Œä¸”å¯ä»¥è®¾ç½®ä¸æ­¢ä¸€ä¸ªï¼Œå…·ä½“ä½¿ç”¨å¦‚ä¸‹ï¼š</p>
<p>pod_busybox.ymlæ–‡ä»¶ï¼š</p>
<pre><code class="yaml">apiVersion: v1
kind: Pod
metadata:
  name: busybox-pod
  labels:
    app: busybox
spec:
  nodeSelector: #å®šä¹‰ä¸€ä¸ªnodeçš„selectorï¼ˆç­›é€‰å™¨ï¼‰
    hardware: good #è‡ªå®šä¹‰çš„label
  containers:
  - name: busybox-container
    image: busybox
    command:
      - sleep
      - &quot;360000&quot;</code></pre>
<p>åˆ›å»ºï¼š</p>
<pre><code class="bash">#åˆ›å»ºpod
kubectl create -f pod_busybox.yml
#æŸ¥çœ‹çŠ¶æ€
kubectl get pods#å¯ä»¥å‘ç°ç°åœ¨è¯¥busybox podçš„çŠ¶æ€éƒ½æ˜¯pending</code></pre>
<ul>
<li>pod_busyboxçŠ¶æ€ä¸€ç›´æ˜¯pendingçš„åŸå› ä¸ºï¼šæ•´ä¸ªClusterä¸­çš„æ‰€æœ‰nodeä¸Šçš„labelåŒ¹é…ä¸åˆ°<code>hardware=good</code>çš„labelï¼Œæ‰€ä»¥è¯¥podä¸€ç›´ä¸èƒ½æ­£å¸¸éƒ¨ç½²åˆ°nodeä¸Š</li>
</ul>
<pre><code class="bash">#æŸ¥çœ‹æ‰€æœ‰nodeä¸Šçš„æ‰€æœ‰label
kubectl get node --show-labels

#è·å–nodeçš„id(name)
kubectl get node
#æ‰‹åŠ¨åœ¨nodeä¸Šæ·»åŠ label
kubectl label node nodeçš„id hardware=good

#ç­‰å¾…ä¸€é˜µä¹‹åï¼ŒæŸ¥çœ‹
kubectl get pods#å‘ç°å·²ç»ç”±pendingçŠ¶æ€å˜ä¸ºRunningçŠ¶æ€</code></pre>

      
       <hr><span style="font-style: italic;color: gray;"> æ¬¢è¿æŒ‡å‡ºä»»ä½•æœ‰é”™è¯¯æˆ–ä¸å¤Ÿæ¸…æ™°çš„è¡¨è¾¾ã€‚é‚®ä»¶ï¼š1125934312@qq.com </span>
    </div>
</article>



<div class="article_copyright">
    <p><span class="copy-title">Title:</span>Docker</p>
    <p><span class="copy-title">Count:</span><span class="post-count">13k</span></p>
    <p><span class="copy-title">Author:</span><a  title="NU-LL">NU-LL</a></p>
    <p><span class="copy-title">Created At:</span>2020-01-16, 20:14:51</p>
    <p><span class="copy-title">Updated At:</span>2020-04-14, 21:06:15</p>
    <span class="copy-title">Url:</span><a class="post-url" href="/2020/01/16/Docker/" title="Docker">http://NU-LL.github.io/2020/01/16/Docker/</a>
    <p>
        <span class="copy-title">Copyright:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">&#39;Attribution-non-commercial-shared in the same way 4.0&#39;</a> Reprint please keep the original link and author.
    </p>
</div>





    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    Â©2016-2020 NU-LL
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="åˆ‡æ¢å…¨å± å¿«æ·é”® s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*æ¸²æŸ“å¯¹åº”çš„è¡¨æ ¼æ ·å¼*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*æ¸²æŸ“æ‰“èµæ ·å¼*/
        

        /*é«˜äº®ä»£ç å—è¡Œå·*/
        
        $('pre code').each(function(){
            var lines = $(this).text().trim().split('\n').length, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*è®¿é—®æ•°é‡*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*ä»£ç é«˜äº®ï¼Œè¡Œå·å¯¹é½*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*æ‰“èµé¡µé¢éšè—ä¸å±•ç¤º*/
    

</script>

<!--åŠ å…¥è¡Œå·çš„é«˜äº®ä»£ç å—æ ·å¼-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: #fafafa;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--è‡ªå®šä¹‰æ ·å¼è®¾ç½®-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*åˆ—è¡¨æ ·å¼*/
    

    /* èƒŒæ™¯å›¾æ ·å¼ */
    
    


    /*å¼•ç”¨å—æ ·å¼*/
    

    /*æ–‡ç« åˆ—è¡¨èƒŒæ™¯å›¾*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("https://i.loli.net/2019/07/22/5d3521411f3f169375.png");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>







</html>
