<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>python迭代器与生成器 | spaceman</title><meta name="keywords" content="python迭代器与生成器"><meta name="author" content="spaceman"><meta name="copyright" content="spaceman"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="python迭代器与生成器  本文转载于Python迭代器，生成器–精华中的精华 - Winter_Ding  迭代器 迭代器是访问集合元素的一种方式。迭代器对象从集合的第一个元素开始访问，直到所有的元素被访问完结束。迭代器只能往前不会后退，不过这也没什么，因为人们很少在迭代途中往后退。另外，迭代器的一大优点是不要求事先准备好整个迭代过程中所有的元素。迭代器仅仅在迭代到某个元素时才计算该元素，而在">
<meta property="og:type" content="article">
<meta property="og:title" content="python迭代器与生成器">
<meta property="og:url" content="http://nu-ll.github.io/2021/12/13/python%E8%BF%AD%E4%BB%A3%E5%99%A8%E4%B8%8E%E7%94%9F%E6%88%90%E5%99%A8/index.html">
<meta property="og:site_name" content="spaceman">
<meta property="og:description" content="python迭代器与生成器  本文转载于Python迭代器，生成器–精华中的精华 - Winter_Ding  迭代器 迭代器是访问集合元素的一种方式。迭代器对象从集合的第一个元素开始访问，直到所有的元素被访问完结束。迭代器只能往前不会后退，不过这也没什么，因为人们很少在迭代途中往后退。另外，迭代器的一大优点是不要求事先准备好整个迭代过程中所有的元素。迭代器仅仅在迭代到某个元素时才计算该元素，而在">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/NU-LL/image-host/raw/master/12.jpg">
<meta property="article:published_time" content="2021-12-13T06:28:34.000Z">
<meta property="article:modified_time" content="2021-12-13T07:40:22.959Z">
<meta property="article:author" content="spaceman">
<meta property="article:tag" content="python迭代器与生成器">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/NU-LL/image-host/raw/master/12.jpg"><link rel="shortcut icon" href="/img/favicon.jpg"><link rel="canonical" href="http://nu-ll.github.io/2021/12/13/python%E8%BF%AD%E4%BB%A3%E5%99%A8%E4%B8%8E%E7%94%9F%E6%88%90%E5%99%A8/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'python迭代器与生成器',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-12-13 15:40:22'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/spaceman.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">94</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">97</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/todo/"><i class="fa-fw fas fa-list"></i><span> 清单</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://gitee.com/NU-LL/image-host/raw/master/12.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">spaceman</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/todo/"><i class="fa-fw fas fa-list"></i><span> 清单</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">python迭代器与生成器</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-12-13T06:28:34.000Z" title="发表于 2021-12-13 14:28:34">2021-12-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-12-13T07:40:22.959Z" title="更新于 2021-12-13 15:40:22">2021-12-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">6.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>26分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="python迭代器与生成器"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>python迭代器与生成器</h1>
<blockquote>
<p>本文转载于<a target="_blank" rel="noopener" href="https://www.cnblogs.com/deeper/p/7565571.html">Python迭代器，生成器–精华中的精华 - Winter_Ding</a></p>
</blockquote>
<h2 id="迭代器">迭代器</h2>
<p>迭代器是访问集合元素的一种方式。迭代器对象从集合的第一个元素开始访问，直到所有的元素被访问完结束。迭代器只能往前不会后退，不过这也没什么，因为人们很少在迭代途中往后退。另外，迭代器的一大优点是不要求事先准备好整个迭代过程中所有的元素。迭代器仅仅在迭代到某个元素时才计算该元素，而在这之前或之后，元素可以不存在或者被销毁。这个特点使得它特别适合用于<strong>遍历一些巨大的或是无限的集合</strong>，比如几个G的文件。</p>
<p>特点：</p>
<ol>
<li>
<p>访问者不需要关心迭代器内部的结构，仅需通过next()方法或不断去取下一个内容</p>
</li>
<li>
<p>不能随机访问集合中的某个值，只能从头到尾依次访问</p>
</li>
<li>
<p>访问到一半时不能往回退</p>
</li>
<li>
<p>便于循环比较大的数据集合，节省内存</p>
</li>
<li>
<p>不能复制一个迭代器。如果要再次（或者同时）迭代同一个对象，只能去创建另一个迭代器对象。enumerate()的返回值就是一个迭代器，我们以enumerate为例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="built_in">enumerate</span>([<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):    <span class="comment">#迭代两次enumerate对象</span></span><br><span class="line">     <span class="keyword">for</span> x, y <span class="keyword">in</span> a:</span><br><span class="line">         <span class="built_in">print</span>(x,y)</span><br><span class="line">     <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.center(<span class="number">50</span>,<span class="string">&#x27;-&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> a</span><br><span class="line"><span class="number">1</span> b</span><br><span class="line">--------------------------------------------------</span><br><span class="line">--------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>可以看到再次迭代enumerate对象时，没有返回值；</p>
</li>
</ol>
<blockquote>
<p>可以<strong>用linux的文件处理命令vim和cat来理解一下：</strong></p>
<ul>
<li>读取很大的文件时，vim需要很久，cat是毫秒级；因为vim是一次性把文件全部加载到内存中读取；而cat是加载一行显示一行</li>
<li>vim读写文件时可以前进，后退，可以跳转到任意一行；而cat只能向下翻页，不能倒退，不能直接跳转到文件的某一页（因为读取的时候这个“某一页“可能还没有加载到内存中）</li>
</ul>
</blockquote>
<h3 id="可迭代对象与迭代器">可迭代对象与迭代器</h3>
<p>正式进入python迭代器之前，我们先要区分两个容易混淆的概念：可迭代对象和迭代器；</p>
<ul>
<li><strong>可迭代对象(Iterable)</strong>：可以直接作用于for循环的对象
<ul>
<li>所有的Iterable均可以通过内置函数iter()来转变为Iterator</li>
<li>只要定义了可以返回一个迭代器的<code>__iter__</code>方法，或者定义了可以支持下标索引的<code>__getitem__</code>方法，就是一个可迭代对象
<ul>
<li>Python内置str、list、tuple、dict、set、file都是可迭代对象</li>
</ul>
</li>
</ul>
</li>
<li><strong>迭代器(Iterator)</strong>：可以被next()函数调用并不断返回下一个值的对象
<ul>
<li>只要实现<code>__next__()</code>（python2中实现<code>next()</code>）方法的对象都是迭代器
<ul>
<li>一般来说会为了兼容Iterable的接口而实现<code>__iter__</code>，从而让Iterator成为Iterable的一种实现</li>
<li>一般来说，<code>__iter__</code>返回迭代器自身，<code>__next__</code>返回容器中的下一个值</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>总结图如下：</p>
<p><img src="/2021/12/13/python%E8%BF%AD%E4%BB%A3%E5%99%A8%E4%B8%8E%E7%94%9F%E6%88%90%E5%99%A8/999584-20170927122209153-2033684386.png" alt="迭代器总结"></p>
<h4 id="可迭代对象">可迭代对象</h4>
<p>首先，<strong>迭代器是一个对象</strong>，不是一个函数；是一个什么样的对象呢？就是只要它定义了可以返回一个迭代器的<code>__iter__</code>方法，或者定义了可以支持下标索引的<code>__getitem__</code>方法，那么它就是一个可迭代对象。</p>
<p>python中大部分对象都是可迭代的，比如list，tuple等。如果给一个准确的定义的话，看一下list，tuple类的源码，都有<code>__iter__</code>(self)方法。</p>
<p>常见的可迭代对象：</p>
<ul>
<li>集合数据类型，如<code>list</code>、<code>tuple</code>、<code>dict</code>、<code>set</code>、<code>str</code>等；</li>
<li><code>generator</code>，包括生成器和带<code>yield</code>的generator function。</li>
</ul>
<p>注意：<strong>生成器都是<code>Iterator</code>对象，但<code>list</code>、<code>dict</code>、<code>str</code>虽然是<code>Iterable</code>，却不是<code>Iterator，关于生成器，继续往下看</code></strong></p>
<p>如何判断一个对象是可迭代对象呢？可以通过collections模块的Iterable类型判断：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> Iterable</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>([], Iterable)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(&#123;&#125;, Iterable)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(<span class="string">&#x27;abc&#x27;</span>, Iterable)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>((x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)), Iterable)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(<span class="number">100</span>, Iterable)</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>
<h4 id="迭代">迭代</h4>
<p>一个可迭代对象是不能独立进行迭代的，Python中，<strong>迭代是通过<code>for ... in</code>来完成的。</strong></p>
<h5 id="for-…-in循环">for … in循环</h5>
<p>for循环在迭代一个可迭代对象的过程中都做了什么呢？</p>
<p>a）当for循环迭代一个可迭代对象时，首先会调用可迭代对象的<code>__iter__()</code>方法，然我们看看源码中关于list类的<code>__iter__()</code>方法的定义：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self, *args, **kwargs</span>): <span class="comment"># real signature unknown</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Implement iter(self). &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p><code>__iter__()</code>方法调用了iter(self)函数，我们再来看一下iter()函数的定义：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">iter</span>(<span class="params">source, sentinel=<span class="literal">None</span></span>): <span class="comment"># known special case of iter</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    iter(iterable) -&gt; iterator</span></span><br><span class="line"><span class="string">    iter(callable, sentinel) -&gt; iterator</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Get an iterator from an object.  In the first form, the argument must</span></span><br><span class="line"><span class="string">    supply its own iterator, or be a sequence.</span></span><br><span class="line"><span class="string">    In the second form, the callable is called until it returns the sentinel.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>iter()函数的参数是一个可迭代对象，最终返回一个迭代器</strong></li>
</ul>
<p>b) for循环会不断调用迭代器对象的<code>__next__()</code>方法(python2.x中是next()方法)，每次循环，都返回迭代器对象的下一个值，直到遇到StopIteration异常。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>lst_iter = <span class="built_in">iter</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>lst_iter.__next__()</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>lst_iter.__next__()</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>lst_iter.__next__()</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>lst_iter.__next__()</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">StopIteration</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>注意：这里的<code>__next__()</code>方法和内置函数next(iterator, default=None)不是一个东西；(内置函数next(iterator, default=None)也可以返回迭代器的下一个值）</strong></li>
</ul>
<p>c) 而for循环可以捕获StopIteration异常并结束循环；</p>
<h5 id="for-…-in总结">for … in总结</h5>
<ul>
<li>for…in iterable，会通过调用iter(iterable)函数（实际上，首先调用的对象的<code>__iter__()</code>方法），返回一个迭代器iterator</li>
<li>每次循环，调用一次对象的<code>__next__(self)</code>，直到最后一个值，再次调用会触发StopIteration</li>
<li>for循环捕捉到StopIteration，从而结束循环</li>
</ul>
<h3 id="迭代器-Iterator">迭代器 Iterator</h3>
<p>上面说了这么多，到底什么是迭代器Iterator呢？</p>
<p><strong>任何实现了<code>__iter__</code>和<code>__next__()</code>（python2中实现<code>next()</code>）方法的对象都是迭代器，<code>__iter__</code>返回迭代器自身，<code>__next__</code>返回容器中的下一个值；</strong></p>
<p>既然知道了什么迭代器，那我们自定义一个迭代器玩玩：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Iterator_test</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, data</span>):</span><br><span class="line">        self.data = data</span><br><span class="line">        self.index = <span class="built_in">len</span>(data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.index &lt;= <span class="number">0</span> :</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line">        self.index -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> self.data[self.index]</span><br><span class="line"></span><br><span class="line">iterator_winter = Iterator_test(<span class="string">&#x27;abcde&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> iterator_winter:</span><br><span class="line">    <span class="built_in">print</span>(item)</span><br></pre></td></tr></table></figure>
<p>如何判断一个对象是一个迭代器对象呢？两个方法：</p>
<ol>
<li>通过内置函数<code>next(iterator, default=None)</code>，可以看到next的第一个参数必须是迭代器；所以迭代器也可以认为是可以被next()函数调用的对象</li>
<li>通过collection中的Iterator类型判断</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> Iterator</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>], Iterator)</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(<span class="built_in">iter</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]), Iterator)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].__iter__(), Iterator)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p>这里大家会不会有个疑问：</p>
<p><strong>对于迭代器而言，看上去作用的不就是<code>__next__</code>方法嘛，<code>__iter__</code>好像没什么卵用，干嘛还需要<code>__iter__</code>方法呢？</strong></p>
<p>我们知道，python中迭代是通过for循环实现的，而for循环的循环对象必须是一个可迭代对象Iterable，而Iterable必须是一个实现了<code>__iter__</code>方法的对象；知道为什么需要<code>__iter__</code>魔术方法了吧；</p>
<p>那么我就是想自定义一个没有实现<code>__iter__</code>方法的迭代器可以吗？可以，像下面这样：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Iterable_test</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, data</span>):</span><br><span class="line">        self.data = data</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> Iterator_test(self.data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Iterator_test</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, data</span>):</span><br><span class="line">        self.data = data</span><br><span class="line">        self.index = <span class="built_in">len</span>(data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.index &lt;= <span class="number">0</span> :</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line">        self.index -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> self.data[self.index]</span><br><span class="line"></span><br><span class="line">iterator_winter = Iterable_test(<span class="string">&#x27;abcde&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> iterator_winter:</span><br><span class="line">    <span class="built_in">print</span>(item)</span><br></pre></td></tr></table></figure>
<p>先定义一个可迭代对象（包含<code>__iter__</code>方法），然后该对象返回一个迭代器；这样看上去是不是很麻烦？是不是同时带有<code>__iter__</code>和<code>__next__</code>魔术方法的迭代器更好呢！</p>
<p>同时，这里要纠正之前的一个迭代器概念：<strong>只要<code>__next__()</code>（python2中实现<code>next()</code>）方法的对象都是迭代器；</strong></p>
<p>既然这样，只需要迭代器Iterator接口就够了，为什么还要设计可迭代对象Iterable呢？</p>
<p>这个和迭代器不能重复使用有关，下面统一讲解：</p>
<h3 id="一些重要知识点">一些重要知识点</h3>
<h4 id="如何复制迭代器">如何复制迭代器</h4>
<p>之前在使用enumerate时，我们说过enumerate对象通过for循环迭代一次后就不能再被迭代：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>e = <span class="built_in">enumerate</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> x,y <span class="keyword">in</span> e:</span><br><span class="line"><span class="meta">... </span>  <span class="built_in">print</span>(x,y)</span><br><span class="line">...</span><br><span class="line"><span class="number">0</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span> <span class="number">2</span></span><br><span class="line"><span class="number">2</span> <span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> x,y <span class="keyword">in</span> e:</span><br><span class="line"><span class="meta">... </span>  <span class="built_in">print</span>(x,y)</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>这是因为enumerate是一个迭代器；</p>
<p>迭代器是<strong>一次性消耗品</strong>，当循环以后就空了。不能再次使用；通过<strong>深拷贝</strong>可以解决；</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> copy</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e = <span class="built_in">enumerate</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e_deepcopy = copy.deepcopy(e)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> x,y <span class="keyword">in</span> e:</span><br><span class="line"><span class="meta">... </span>  <span class="built_in">print</span>(x,y)</span><br><span class="line">...</span><br><span class="line"><span class="number">0</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span> <span class="number">2</span></span><br><span class="line"><span class="number">2</span> <span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> x,y <span class="keyword">in</span> e_deepcopy:</span><br><span class="line"><span class="meta">... </span>  <span class="built_in">print</span>(x,y)</span><br><span class="line">...</span><br><span class="line"><span class="number">0</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span> <span class="number">2</span></span><br><span class="line"><span class="number">2</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>
<h4 id="为什么需要设计Iterable呢？">为什么需要设计Iterable呢？</h4>
<p>因为迭代器迭代一次以后就空了，那么如果list，dict也是一个迭代器，迭代一次就不能再继续被迭代了，这显然是反人类的；所以通过<code>__iter__</code>每次返回一个独立的迭代器，就可以保证不同的迭代过程不会互相影响。而生成器表达式之类的结果往往是一次性的，不可以重复遍历，所以直接返回一个Iterator就好。让Iterator也实现Iterable的兼容就可以很灵活地选择返回哪一种。</p>
<p>总结说，<strong>Iterator实现的<code>__iter__</code>是为了兼容Iterable的接口，从而让Iterator成为Iterable的一种实现。</strong></p>
<p>另外，迭代器是惰性的，只有在需要返回下一个数据时它才会计算。就像一个懒加载的工厂，等到有人需要的时候才给它生成值返回，没调用的时候就处于休眠状态等待下一次调用。所以，<code>Iterator</code>甚至可以表示一个无限大的数据流，例如全体自然数。而使用list是永远不可能存储全体自然数的。</p>
<h4 id="getitem-实现for循环"><code>__getitem__</code>实现for循环</h4>
<p>前面关于可迭代对象的定义是这样的：<strong>定义了可以返回一个迭代器的<code>__iter__</code>方法，或者定义了可以支持下标索引的<code>__getitem__</code>方法，那么它就是一个可迭代对象。</strong></p>
<p>但是如果对象没有<code>__iter__</code>，但是实现了<code>__getitem__</code>，会改用下标迭代的方式。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NoIterable</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, data</span>):</span><br><span class="line">        self.data = data</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, item</span>):</span><br><span class="line">        <span class="keyword">return</span> self.data[item]</span><br><span class="line"></span><br><span class="line">no_iter = NoIterable(<span class="string">&#x27;abcde&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> no_iter:</span><br><span class="line">    <span class="built_in">print</span>(item)</span><br></pre></td></tr></table></figure>
<p>当for发现没有<code>__iter__</code>但是有<code>__getitem__</code>的时候，会从0开始依次读取相应的下标，直到发生IndexError为止，**这是一种旧的迭代方法。**iter方法也会处理这种情况，在不存在<code>__iter__</code>的时候，返回一个下标迭代的iterator对象来代替。</p>
<h4 id="一张图总结迭代器">一张图总结迭代器</h4>
<p><img src="/2021/12/13/python%E8%BF%AD%E4%BB%A3%E5%99%A8%E4%B8%8E%E7%94%9F%E6%88%90%E5%99%A8/999584-20170927122209153-2033684386.png" alt="迭代器总结"></p>
<h4 id="使用迭代器实现斐波那契数列">使用迭代器实现斐波那契数列</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Fib</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, limit</span>):</span><br><span class="line">        self.a, self.b = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">        self.limit = limit</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">        self.a, self.b = self.b, self.a+self.b</span><br><span class="line">        <span class="keyword">while</span> self.a &gt; self.limit:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line">        <span class="keyword">return</span> self.a</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> Fib(<span class="number">1000</span>):</span><br><span class="line">    <span class="built_in">print</span>(n)</span><br></pre></td></tr></table></figure>
<h2 id="生成器">生成器</h2>
<p>理解了迭代器以后，生成器就会简单很多，因为生成器其实是一种特殊的迭代器。不过这种迭代器更加优雅。它不需要再像上面的类一样写<code>__iter__()</code>和<code>__next__()</code>方法了，只需要一个<code>yiled</code>关键字。 生成器一定是迭代器（反之不成立），因此任何生成器也是以一种懒加载的模式生成值。</p>
<p>语法上说，<strong>生成器函数是一个带yield关键字的函数</strong>。</p>
<p>调用<strong>生成器函数</strong>后会得到一个<strong>生成器对象</strong>，这个生成器对象实际上就是一个<strong>特殊的迭代器</strong>，拥有<code>__iter__()</code>和<code>__next__()</code>方法</p>
<p>我们先用一个例子说明一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">generator_winter</span>():</span><br><span class="line"><span class="meta">... </span>  i = <span class="number">1</span></span><br><span class="line"><span class="meta">... </span>  <span class="keyword">while</span> i &lt;= <span class="number">3</span>:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">yield</span> i</span><br><span class="line"><span class="meta">... </span>    i += <span class="number">1</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>generator_winter</span><br><span class="line">&lt;function generator_winter at <span class="number">0x000000000323B9D8</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>generator_iter = generator_winter()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>generator_iter</span><br><span class="line">&lt;generator <span class="built_in">object</span> generator_winter at <span class="number">0x0000000002D9CAF0</span>&gt;</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>generator_iter.__next__()</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>generator_iter.__next__()</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>generator_iter.__next__()</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>generator_iter.__next__()</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">StopIteration</span><br></pre></td></tr></table></figure>
<p>现在解释一下上面的代码：</p>
<ol>
<li>首先我们创建了一个含有yield关键字的函数generator_winter，这是一个生成器函数</li>
<li>然后，我们调用了这个生成器函数，并且将返回值赋值给了generator_iter，generator_iter是一个生成器对象
<ul>
<li>注意：<code>generator_iter = generator_winter()</code>时，函数体中的代码并不会执行，只有显示或隐示地调用next的时候才会真正执行里面的代码</li>
</ul>
</li>
<li>生成器对象就是一个迭代器，所以我们可以调用对象的<code>__next__</code>方法来每次返回一个迭代器的值；迭代器的值通过yield返回；并且迭代完最后一个元素后，触发StopIteration异常；</li>
</ol>
<p>既然生成器对象是一个迭代器，我们就可以使用for循环来迭代这个生成器对象：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">generator_winter</span>():</span><br><span class="line"><span class="meta">... </span>  i = <span class="number">1</span></span><br><span class="line"><span class="meta">... </span>  <span class="keyword">while</span> i &lt;= <span class="number">3</span>:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">yield</span> i</span><br><span class="line"><span class="meta">... </span>    i += <span class="number">1</span></span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> item <span class="keyword">in</span> generator_winter():</span><br><span class="line"><span class="meta">... </span>  <span class="built_in">print</span>(item)</span><br><span class="line">...</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>我们注意到迭代器不是使用return来返回值，而是采用yield返回值；那么这个yield有什么特别之处呢？</p>
<h3 id="yield">yield</h3>
<p>我们知道，一个函数只能返回一次，即return以后，这次函数调用就结束了；</p>
<p>但是<strong>生成器函数</strong>可以<strong>暂停执行</strong>，并且通过yield返回一个<strong>中间值</strong>，当生成器对象的<code>__next__()</code>方法再次被调用的时候，<strong>生成器函数可以从上一次暂停的地方继续执行，直到触发一个StopIteration</strong></p>
<p>上例中，当执行到<code>yield i</code>后，函数返回i值，然后print这个值，下一次循环，又调用<code>__next__()</code>方法，回到生成器函数，并从<code>yield i</code>的下一句继续执行；</p>
<blockquote>
<p>摘一段&lt;python核心编程&gt;的内容：</p>
<p>生成器的另外一个方面甚至更加强力----协同程序的概念。协同程序是可以运行的独立函数调用，可以暂停或者挂起，并从程序离开的地方继续或者重新开始。在有调用者和(被调用的)协同程序也有通信。举例来说，当协同程序暂停时，我们仍可以从其中获得一个中间的返回值，当调用回到程序中时，能够传入额外或者改变了的参数，但是仍然能够从我们上次离开的地方继续，并且所有状态完整。挂起返回出中间值并多次继续的协同程序被称为生成器，那就是python的生成真正在做的事情。这些提升让生成器更加接近一个完全的协同程序，因为允许值(和异常)能传回到一个继续的函数中，同样的，当等待一个生成器的时候，生成器现在能返回控制，在调用的生成器能挂起(返回一个结果)之前，调用生成器返回一个结果而不是阻塞的等待那个结果返回。</p>
</blockquote>
<h3 id="什么情况会触发StopIteration">什么情况会触发StopIteration</h3>
<p>两种情况会触发StopIteration：</p>
<ol>
<li>如果没有return，则默认执行到函数完毕时返回StopIteration</li>
<li>如果在执行过程中 return，则直接抛出 StopIteration 终止迭代
<ul>
<li>如果在return后返回一个值，那么这个值为StopIteration异常的说明，不是程序的返回值</li>
</ul>
</li>
</ol>
<p>例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">generator_winter</span>():</span><br><span class="line"><span class="meta">... </span>  <span class="keyword">yield</span> <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"><span class="meta">... </span>  <span class="keyword">return</span> <span class="string">&#x27;again&#x27;</span></span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>winter = generator_winter()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>winter.__next__()</span><br><span class="line"><span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>winter.__next__()</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">StopIteration: again</span><br></pre></td></tr></table></figure>
<h3 id="生成器的作用">生成器的作用</h3>
<p>说了这么多，生成器有什么用呢？作为python主要特性之一，这是个极其牛逼的东西，由于它是惰性的，在处理大型数据时，可以节省大量内存空间；</p>
<p>当你需要迭代一个巨大的数据集合，比如创建一个有规律的100万个数字，如果采用列表来存储访问，那么会占用大量的内存空间；而且如果我们只是访问这个列表的前几个元素，那么后边大部分元素占据的内存空间就白白浪费了；这时，如果采用生成器，则不必创建完整的列表，一次循环返回一个希望得到的值，这样就可以大量节省内存空间；</p>
<p>这里在举例之前，我们先介绍一个<strong>生成器表达式</strong>（类似于列表推导式，只是把[]换成()），这样就创建了一个生成器。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>gen = (x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>gen</span><br><span class="line">&lt;generator <span class="built_in">object</span> &lt;genexpr&gt; at <span class="number">0x0000000002A923B8</span>&gt;</span><br></pre></td></tr></table></figure>
<p>生成器表达式的语法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(expr <span class="keyword">for</span> iter_var <span class="keyword">in</span> iterable <span class="keyword">if</span> cond_expr)</span><br></pre></td></tr></table></figure>
<p>用生成器来实现斐波那契数列</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">fib</span>(<span class="params">n</span>):</span><br><span class="line">    a, b = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> b &lt;= n:</span><br><span class="line">        <span class="keyword">yield</span> b</span><br><span class="line">        a, b = b, a+b</span><br><span class="line"></span><br><span class="line">f = fib(<span class="number">10</span>)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> f:</span><br><span class="line">    <span class="built_in">print</span>(item)</span><br></pre></td></tr></table></figure>
<h3 id="生成器方法">生成器方法</h3>
<p>直接看生成器源代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">__generator</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;A mock class representing the generator function type.&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.gi_code = <span class="literal">None</span></span><br><span class="line">        self.gi_frame = <span class="literal">None</span></span><br><span class="line">        self.gi_running = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;Defined to support iteration over container.&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;Return the next item from the container.&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;Raises new GeneratorExit exception inside the generator to terminate the iteration.&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;Resumes the generator and &quot;sends&quot; a value that becomes the result of the current yield-expression.&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">throw</span>(<span class="params">self, <span class="built_in">type</span>, value=<span class="literal">None</span>, traceback=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;Used to raise an exception inside the generator.&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>首先看到了生成器是自带<code>__iter__</code>和<code>__next__</code>魔术方法的；</p>
<h4 id="send">send</h4>
<p>生成器函数最大的特点是可以接受外部传入的一个变量，并根据变量内容计算结果后返回。这是生成器函数最难理解的地方，也是最重要的地方，<strong>协程的****实现就全靠它了</strong>。</p>
<p>看一个小猫吃鱼的例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">cat</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;我是一只hello kitty&#x27;</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        food = <span class="keyword">yield</span></span><br><span class="line">        <span class="keyword">if</span> food == <span class="string">&#x27;鱼肉&#x27;</span>:</span><br><span class="line">            <span class="keyword">yield</span> <span class="string">&#x27;好开心&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">yield</span> <span class="string">&#x27;不开心，人家要吃鱼肉啦&#x27;</span></span><br></pre></td></tr></table></figure>
<p>中间有个赋值语句food = yield，可以通过send方法来传参数给food，试一下：</p>
<p>情况1）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">miao = cat()    <span class="comment">#只是用于返回一个生成器对象，cat函数不会执行</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.center(<span class="number">50</span>,<span class="string">&#x27;-&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(miao.send(<span class="string">&#x27;鱼肉&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">--------------------------------------------------</span><br><span class="line">  File <span class="string">&quot;C:/Users//Desktop/Python/cnblogs/subModule.py&quot;</span>, line <span class="number">67</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="built_in">print</span>(miao.send(<span class="string">&#x27;鱼肉&#x27;</span>))</span><br><span class="line">TypeError: can<span class="string">&#x27;t send non-None value to a just-started generator</span></span><br></pre></td></tr></table></figure>
<p>看到了两个信息：</p>
<ol>
<li>miao = cat() ，只是用于返回一个生成器对象，cat函数不会执行</li>
<li>can’t send non-None value to a just-started generator；不能给一个刚创建的生成器对象直接send值</li>
</ol>
<p>改一下</p>
<p>情况2）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">miao = cat()</span><br><span class="line">miao.__next__()</span><br><span class="line"><span class="built_in">print</span>(miao.send(<span class="string">&#x27;鱼肉&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">我是一只hello kitty</span><br><span class="line">好开心</span><br></pre></td></tr></table></figure>
<p>没毛病，那么到底send()做了什么呢？send()的帮助文档写的很清楚，‘’‘Resumes the generator and “sends” a value that becomes the result of the current yield-expression.’‘’；</p>
<p>可以看到<strong>send依次做了两件事</strong>：</p>
<ol>
<li>回到生成器挂起的位置，继续执行</li>
<li>并将send(arg)中的参数赋值给对应的变量，如果没有变量接收值，那么就只是回到生成器挂起的位置</li>
</ol>
<p>但是，我认为<strong>send还做了第三件事</strong>：</p>
<ol start="3">
<li>兼顾<code>__next__()</code>作用，挂起程序并返回值，所以我们在print(miao.send(‘鱼肉’))时，才会看到’好开心’；其实<code>__next__()</code>等价于send(None)</li>
</ol>
<p>所以当我们尝试这样做的时候：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">cat</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;我是一只hello kitty&#x27;</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        food = <span class="keyword">yield</span></span><br><span class="line">        <span class="keyword">if</span> food == <span class="string">&#x27;鱼肉&#x27;</span>:</span><br><span class="line">            <span class="keyword">yield</span> <span class="string">&#x27;好开心&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">yield</span> <span class="string">&#x27;不开心，人家要吃鱼肉啦&#x27;</span></span><br><span class="line"></span><br><span class="line">miao = cat()</span><br><span class="line"><span class="built_in">print</span>(miao.__next__())</span><br><span class="line"><span class="built_in">print</span>(miao.send(<span class="string">&#x27;鱼肉&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(miao.send(<span class="string">&#x27;骨头&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(miao.send(<span class="string">&#x27;鸡肉&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>就会得到这个结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">我是一只hello kitty</span><br><span class="line"><span class="literal">None</span></span><br><span class="line">好开心</span><br><span class="line"><span class="literal">None</span></span><br><span class="line">不开心，人家要吃鱼肉啦</span><br></pre></td></tr></table></figure>
<p>我们按步骤分析一下：</p>
<ol>
<li>执行到<code>print(miao.__next__())</code>，执行cat()函数，print了”我是一只hello kitty”，然后在food = yield挂起，并返回了None，打印None</li>
<li>接着执行<code>print(miao.send('鱼肉'))</code>，回到food = yield，并将’鱼肉’赋值给food，生成器函数恢复执行；直到运行到yield ‘好开心’，程序挂起，返回’好开心’，并print’好开心’</li>
<li>接着执行<code>print(miao.send('骨头'))</code>，回到yield ‘好开心’，这时没有变量接收参数’骨头’，生成器函数恢复执行；直到food = yield，程序挂起，返回None，并print None</li>
<li>接着执行<code>print(miao.send('鸡肉'))</code>，回到food = yield，并将’鸡肉’赋值给food，生成器函数恢复执行；直到运行到yield’不开心，人家要吃鱼肉啦’，程序挂起，返回’不开心，人家要吃鱼肉啦’，，并print ‘不开心，人家要吃鱼肉啦’</li>
</ol>
<p>大功告成；那我们优化一下代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">cat</span>():</span><br><span class="line">    msg = <span class="string">&#x27;我是一只hello kitty&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        food = <span class="keyword">yield</span> msg</span><br><span class="line">        <span class="keyword">if</span> food == <span class="string">&#x27;鱼肉&#x27;</span>:</span><br><span class="line">            msg = <span class="string">&#x27;好开心&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            msg = <span class="string">&#x27;不开心，人家要吃鱼啦&#x27;</span></span><br><span class="line"></span><br><span class="line">miao = cat()</span><br><span class="line"><span class="built_in">print</span>(miao.__next__())</span><br><span class="line"><span class="built_in">print</span>(miao.send(<span class="string">&#x27;鱼肉&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(miao.send(<span class="string">&#x27;鸡肉&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>我们再看一个更实用的例子，一个计数器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">counter</span>(<span class="params">start_at = <span class="number">0</span></span>):</span><br><span class="line">    count = start_at</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        val = (<span class="keyword">yield</span> count)</span><br><span class="line">        <span class="keyword">if</span> val <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            count = val</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">count = counter(<span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(count.__next__())</span><br><span class="line"><span class="built_in">print</span>(count.__next__())</span><br><span class="line"><span class="built_in">print</span>(count.send(<span class="number">0</span>))</span><br><span class="line"><span class="built_in">print</span>(count.__next__())</span><br><span class="line"><span class="built_in">print</span>(count.__next__())</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>
<h4 id="close">close</h4>
<p>帮助文档：‘’‘Raises new GeneratorExit exception inside the generator to terminate the iteration.’‘’</p>
<p>手动关闭生成器函数，后面的调用会直接返回StopIteration异常</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">gene</span>():</span><br><span class="line"><span class="meta">... </span>  <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">yield</span> <span class="string">&#x27;ok&#x27;</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>g = gene()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>g.__next__()</span><br><span class="line"><span class="string">&#x27;ok&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>g.__next__()</span><br><span class="line"><span class="string">&#x27;ok&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>g.close()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>g.__next__()</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">StopIteration</span><br></pre></td></tr></table></figure>
<p>在close以后再执行<code>__next__</code>会触发StopIteration异常</p>
<h4 id="throw">throw</h4>
<p>用来向生成器函数送入一个异常，throw()后直接抛出异常并结束程序，或者消耗掉一个yield，或者在没有下一个yield的时候直接进行到程序的结尾。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">gene</span>():</span><br><span class="line"><span class="meta">... </span>  <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>      <span class="keyword">yield</span> <span class="string">&#x27;normal value&#x27;</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">except</span> ValueError:</span><br><span class="line"><span class="meta">... </span>      <span class="keyword">yield</span> <span class="string">&#x27;we got ValueError here&#x27;</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">except</span> TypeError:</span><br><span class="line"><span class="meta">... </span>      <span class="keyword">break</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>g = gene()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(g.__next__())</span><br><span class="line">normal value</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(g.__next__())</span><br><span class="line">normal value</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(g.throw(ValueError))</span><br><span class="line">we got ValueError here</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(g.__next__())</span><br><span class="line">normal value</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(g.throw(TypeError))</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">StopIteration</span><br></pre></td></tr></table></figure>
<h3 id="通过yield实现单线程情况下的异步并发效果">通过yield实现单线程情况下的异步并发效果</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">consumer</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s准备吃包子了&#x27;</span> % name)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        baozi_name = <span class="keyword">yield</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[%s]来了，被[%s]吃了&#x27;</span>% (baozi_name, name))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">producer</span>(<span class="params">*name</span>):</span><br><span class="line">    c1 = consumer(name[<span class="number">0</span>])</span><br><span class="line">    c2 = consumer(name[<span class="number">1</span>])</span><br><span class="line">    c1.__next__()</span><br><span class="line">    c2.__next__()</span><br><span class="line">    <span class="keyword">for</span> times <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;做了两个包子&#x27;</span>)</span><br><span class="line">        c1.send(<span class="string">&#x27;豆沙包%s&#x27;</span>%times)</span><br><span class="line">        c2.send(<span class="string">&#x27;菜包%s&#x27;</span>%times)</span><br><span class="line"></span><br><span class="line">producer(<span class="string">&#x27;winter&#x27;</span>, <span class="string">&#x27;elly&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>效果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">winter准备吃包子了</span><br><span class="line">elly准备吃包子了</span><br><span class="line">做了两个包子</span><br><span class="line">[豆沙包<span class="number">0</span>]来了，被[winter]吃了</span><br><span class="line">[菜包<span class="number">0</span>]来了，被[elly]吃了</span><br><span class="line">做了两个包子</span><br><span class="line">[豆沙包<span class="number">1</span>]来了，被[winter]吃了</span><br><span class="line">[菜包<span class="number">1</span>]来了，被[elly]吃了</span><br><span class="line">做了两个包子</span><br><span class="line">[豆沙包<span class="number">2</span>]来了，被[winter]吃了</span><br><span class="line">[菜包<span class="number">2</span>]来了，被[elly]吃了</span><br><span class="line">做了两个包子</span><br><span class="line">[豆沙包<span class="number">3</span>]来了，被[winter]吃了</span><br><span class="line">[菜包<span class="number">3</span>]来了，被[elly]吃了</span><br><span class="line">做了两个包子</span><br><span class="line">[豆沙包<span class="number">4</span>]来了，被[winter]吃了</span><br><span class="line">[菜包<span class="number">4</span>]来了，被[elly]吃了</span><br></pre></td></tr></table></figure>
<p>创建了两个独立的生成器，很有趣，很吊；</p>
<h3 id="补充例子">补充例子</h3>
<p>a）使用生成器创建一个range</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">range</span>(<span class="params">n</span>):</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> count &lt; n:</span><br><span class="line">        <span class="keyword">yield</span> count</span><br><span class="line">        count += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>b ) 使用生成器监听文件输入</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">fileTail</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            tail = f.readline()</span><br><span class="line">            <span class="keyword">if</span> line:</span><br><span class="line">                <span class="keyword">yield</span> tail</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                time.sleep(<span class="number">0.1</span>)</span><br></pre></td></tr></table></figure>
<p>c）计算移动平均值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">averager</span>(<span class="params">start_with = <span class="number">0</span></span>):</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    aver = start_with</span><br><span class="line">    total = start_with</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        val = <span class="keyword">yield</span> aver</span><br><span class="line">        total += val</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        aver = total/count</span><br></pre></td></tr></table></figure>
<p>有个弊端，需要通过<code>__next__</code>或next()初始化一次，通过预激解决</p>
<p>d）预激计算移动平均值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">init</span>(<span class="params">f</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">start_with = <span class="number">0</span></span>):</span><br><span class="line">        g_aver = f(start_with)</span><br><span class="line">        g_aver.__next__()</span><br><span class="line">        <span class="keyword">return</span> g_aver</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@init</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">averager</span>(<span class="params">start_with = <span class="number">0</span></span>):</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    aver = start_with</span><br><span class="line">    total = start_with</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        val = <span class="keyword">yield</span> aver</span><br><span class="line">        total += val</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        aver = total/count</span><br></pre></td></tr></table></figure>
<p>e）读取文件字符数最多的行的字符数</p>
<p>最传统的写法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">longestLine</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        alllines = [<span class="built_in">len</span>(x.strip()) <span class="keyword">for</span> x <span class="keyword">in</span> f]</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(alllines)</span><br></pre></td></tr></table></figure>
<p>使用生成器以后的写法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">longestLine</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">max</span>(<span class="built_in">len</span>(x.strip()) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">open</span>(filename))</span><br></pre></td></tr></table></figure>
<p>f）<strong>多生成器迭代</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>g = (i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> j <span class="keyword">in</span> g:</span><br><span class="line"><span class="meta">... </span>  <span class="built_in">print</span>(j)</span><br><span class="line">...</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> j <span class="keyword">in</span> g:</span><br><span class="line"><span class="meta">... </span>  <span class="built_in">print</span>(j)</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>因为<code>for j in g</code>， 每次循环执行一次<code>g.__next__()</code>；直到结束，触发StopIteration；</p>
<p>主意下面结果的输出：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>g = (i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>g1 = (x <span class="keyword">for</span> x <span class="keyword">in</span> g)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>g2 = (y <span class="keyword">for</span> y <span class="keyword">in</span> g1)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">list</span>(g1))</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">list</span>(g2))</span><br><span class="line">[]</span><br></pre></td></tr></table></figure>
<p>为什么print(list(g2))为空呢？理一下，不然会乱：</p>
<p>看下面的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">g</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;1.1&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;1.2&#x27;</span>)</span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;1.3&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g1</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;2.1&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> s:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;2.2&#x27;</span>)</span><br><span class="line">        <span class="keyword">yield</span> x</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;2.3&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g2</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;3.1&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> s1:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;3.2&#x27;</span>)</span><br><span class="line">        <span class="keyword">yield</span> y</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;3.3&#x27;</span>)</span><br><span class="line"></span><br><span class="line">s = g()</span><br><span class="line">s1 = g1()</span><br><span class="line">s2 = g2()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;start first list&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(s1))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;start second list&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(s2))</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">start first <span class="built_in">list</span></span><br><span class="line"><span class="number">2.1</span></span><br><span class="line"><span class="number">1.1</span></span><br><span class="line"><span class="number">1.2</span></span><br><span class="line"><span class="number">2.2</span></span><br><span class="line"><span class="number">2.3</span></span><br><span class="line"><span class="number">1.3</span></span><br><span class="line"><span class="number">1.2</span></span><br><span class="line"><span class="number">2.2</span></span><br><span class="line"><span class="number">2.3</span></span><br><span class="line"><span class="number">1.3</span></span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">start second <span class="built_in">list</span></span><br><span class="line"><span class="number">3.1</span></span><br><span class="line">[]</span><br></pre></td></tr></table></figure>
<p>注意第11行之后，g触发了StopIteration，被<code>for x in s</code>捕捉，即不能继续<code>s.__next__()</code>了；同样的g1触发StopIteration，被list捕捉，即不能继续<code>s1.__next__()</code>了；于是打印[0,1]</p>
<p>当进行<code>print(list(s2))</code>时，执行<code>s2.__next__()</code>，停留在代码的第17行<code>for y in s1</code>，但是这是不能继续<code>s1.__next__()</code>了；于是直接触发了StopIteration；结果为[]</p>
<p>再看一个有意思的输出：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">n,i</span>):</span><br><span class="line">    <span class="keyword">return</span> n+i</span><br><span class="line"></span><br><span class="line">g = (i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> [<span class="number">1</span>,<span class="number">10</span>]:</span><br><span class="line">    g = (add(n,i) <span class="keyword">for</span> i <span class="keyword">in</span> g)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(g))</span><br></pre></td></tr></table></figure>
<p>输出为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>]</span><br></pre></td></tr></table></figure>
<p>其实上面的代码翻译如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">n,i</span>):</span><br><span class="line">    <span class="keyword">return</span> n+i</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g1</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> g:</span><br><span class="line">        <span class="keyword">yield</span> add(n,i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g2</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s1:</span><br><span class="line">        <span class="keyword">yield</span> add(n,i)</span><br><span class="line"></span><br><span class="line">n = <span class="number">1</span></span><br><span class="line">s1 = g1()</span><br><span class="line">n = <span class="number">10</span></span><br><span class="line">s2 = g2()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(s2))</span><br></pre></td></tr></table></figure>
<p>最终n用的是10</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/python%E8%BF%AD%E4%BB%A3%E5%99%A8%E4%B8%8E%E7%94%9F%E6%88%90%E5%99%A8/">python迭代器与生成器</a></div><div class="post_share"><div class="social-share" data-image="https://gitee.com/NU-LL/image-host/raw/master/12.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/02/22/JetsonTX2%E9%81%BF%E5%9D%91%E6%8C%87%E5%8D%97/"><img class="prev-cover" src="https://gitee.com/NU-LL/image-host/raw/master/139-150515124111.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">JetsonTX2避坑指南</div></div></a></div><div class="next-post pull-right"><a href="/2021/11/22/Arch%20Linux%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/"><img class="next-cover" src="https://gitee.com/NU-LL/image-host/raw/master/12.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Arch Linux安装指南</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/spaceman.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">spaceman</div><div class="author-info__description">CtrlC CtrlV大师</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">94</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">97</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/NU-LL"><i class="fab fa-github"></i><span>Github</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">白嫖一时爽，一直白嫖一直爽</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">python迭代器与生成器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-text">迭代器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E8%BF%AD%E4%BB%A3%E5%AF%B9%E8%B1%A1%E4%B8%8E%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-text">可迭代对象与迭代器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AF%E8%BF%AD%E4%BB%A3%E5%AF%B9%E8%B1%A1"><span class="toc-text">可迭代对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3"><span class="toc-text">迭代</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#for-%E2%80%A6-in%E5%BE%AA%E7%8E%AF"><span class="toc-text">for … in循环</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#for-%E2%80%A6-in%E6%80%BB%E7%BB%93"><span class="toc-text">for … in总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8-Iterator"><span class="toc-text">迭代器 Iterator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E9%87%8D%E8%A6%81%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-text">一些重要知识点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%A4%8D%E5%88%B6%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-text">如何复制迭代器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E8%AE%BE%E8%AE%A1Iterable%E5%91%A2%EF%BC%9F"><span class="toc-text">为什么需要设计Iterable呢？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getitem-%E5%AE%9E%E7%8E%B0for%E5%BE%AA%E7%8E%AF"><span class="toc-text">__getitem__实现for循环</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E5%BC%A0%E5%9B%BE%E6%80%BB%E7%BB%93%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-text">一张图总结迭代器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%AE%9E%E7%8E%B0%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97"><span class="toc-text">使用迭代器实现斐波那契数列</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%99%A8"><span class="toc-text">生成器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#yield"><span class="toc-text">yield</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%BC%9A%E8%A7%A6%E5%8F%91StopIteration"><span class="toc-text">什么情况会触发StopIteration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%99%A8%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-text">生成器的作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%99%A8%E6%96%B9%E6%B3%95"><span class="toc-text">生成器方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#send"><span class="toc-text">send</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#close"><span class="toc-text">close</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#throw"><span class="toc-text">throw</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87yield%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BA%BF%E7%A8%8B%E6%83%85%E5%86%B5%E4%B8%8B%E7%9A%84%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91%E6%95%88%E6%9E%9C"><span class="toc-text">通过yield实现单线程情况下的异步并发效果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A5%E5%85%85%E4%BE%8B%E5%AD%90"><span class="toc-text">补充例子</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/06/06/%E5%9F%BA%E4%BA%8EVSCode%E6%90%AD%E5%BB%BAESP-IDF%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/" title="基于VSCode搭建ESP-IDF开发环境">基于VSCode搭建ESP-IDF开发环境</a><time datetime="2022-06-06T06:27:54.000Z" title="发表于 2022-06-06 14:27:54">2022-06-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/06/05/JetsonXavierNX%E6%91%84%E5%83%8F%E5%A4%B4%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/" title="JetsonXavierNX摄像头驱动开发指南">JetsonXavierNX摄像头驱动开发指南</a><time datetime="2022-06-05T11:50:25.000Z" title="发表于 2022-06-05 19:50:25">2022-06-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/06/05/ESP32%E5%BC%95%E8%84%9A%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/" title="ESP32引脚使用注意事项">ESP32引脚使用注意事项</a><time datetime="2022-06-05T03:29:55.000Z" title="发表于 2022-06-05 11:29:55">2022-06-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/06/04/ESP8266%E5%BC%95%E8%84%9A%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/" title="ESP8266引脚使用注意事项">ESP8266引脚使用注意事项</a><time datetime="2022-06-04T15:41:25.000Z" title="发表于 2022-06-04 23:41:25">2022-06-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/05/12/JetsonNano%20Multimedia%20API%E5%B7%A5%E7%A8%8B%E6%90%AD%E5%BB%BA%E5%8F%8A%E7%BC%96%E8%AF%91/" title="JetsonNano Multimedia API工程搭建及编译">JetsonNano Multimedia API工程搭建及编译</a><time datetime="2022-05-12T12:46:23.000Z" title="发表于 2022-05-12 20:46:23">2022-05-12</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2022 By spaceman</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><script type="text/javascript" src="https://api.uixsj.cn/hitokoto/w.php?code=js"></script><div id="xsjhitokoto"><script>xsjhitokoto()</script></div> <iframe scrolling="no" src="https://tianqiapi.com/api.php?style=tx&color=eee" frameborder="0" allowtransparency="false" align="middle" height="20"></iframe></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>