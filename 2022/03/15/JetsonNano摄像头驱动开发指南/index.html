<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>JetsonNano摄像头驱动开发指南 | spaceman</title><meta name="keywords" content="JetsonNano"><meta name="author" content="spaceman"><meta name="copyright" content="spaceman"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="JetsonNano摄像头驱动开发指南  参考手册：NVIDIA Jetson Linux Developer Guide（下文中所指的参考手册均是指该手册） Jetson资料下载中心：Jetson Download Center | NVIDIA Developer Jetson Nano 信息：  Linux jetson-desktop 4.9.253-tegra L4T 32.7.1  p">
<meta property="og:type" content="article">
<meta property="og:title" content="JetsonNano摄像头驱动开发指南">
<meta property="og:url" content="http://nu-ll.github.io/2022/03/15/JetsonNano%E6%91%84%E5%83%8F%E5%A4%B4%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/index.html">
<meta property="og:site_name" content="spaceman">
<meta property="og:description" content="JetsonNano摄像头驱动开发指南  参考手册：NVIDIA Jetson Linux Developer Guide（下文中所指的参考手册均是指该手册） Jetson资料下载中心：Jetson Download Center | NVIDIA Developer Jetson Nano 信息：  Linux jetson-desktop 4.9.253-tegra L4T 32.7.1  p">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/NU-LL/image-host/raw/master/12.jpg">
<meta property="article:published_time" content="2022-03-15T06:07:34.000Z">
<meta property="article:modified_time" content="2022-06-20T13:52:52.801Z">
<meta property="article:author" content="spaceman">
<meta property="article:tag" content="JetsonNano">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/NU-LL/image-host/raw/master/12.jpg"><link rel="shortcut icon" href="/img/favicon.jpg"><link rel="canonical" href="http://nu-ll.github.io/2022/03/15/JetsonNano%E6%91%84%E5%83%8F%E5%A4%B4%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'JetsonNano摄像头驱动开发指南',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-06-20 21:52:52'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/spaceman.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">99</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">101</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/todo/"><i class="fa-fw fas fa-list"></i><span> 清单</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://gitee.com/NU-LL/image-host/raw/master/12.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">spaceman</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/todo/"><i class="fa-fw fas fa-list"></i><span> 清单</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">JetsonNano摄像头驱动开发指南</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-03-15T06:07:34.000Z" title="发表于 2022-03-15 14:07:34">2022-03-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-06-20T13:52:52.801Z" title="更新于 2022-06-20 21:52:52">2022-06-20</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">人工智能</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>23分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="JetsonNano摄像头驱动开发指南"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>JetsonNano摄像头驱动开发指南</h1>
<blockquote>
<p>参考手册：<a target="_blank" rel="noopener" href="https://docs.nvidia.com/jetson/l4t/index.html">NVIDIA Jetson Linux Developer Guide</a>（下文中所指的参考手册均是指该手册）</p>
<p>Jetson资料下载中心：<a target="_blank" rel="noopener" href="https://developer.nvidia.com/embedded/downloads">Jetson Download Center | NVIDIA Developer</a></p>
<p>Jetson Nano 信息：</p>
<ul>
<li>Linux jetson-desktop 4.9.253-tegra</li>
<li>L4T 32.7.1</li>
</ul>
<p>platform代码：</p>
<ul>
<li>t234：Jetson AGX Orin</li>
<li>t194：Jetson Xavier NX 系列、Jetson AGX Xavier 系列</li>
<li>t210：jetson nano、jetson tx1</li>
</ul>
</blockquote>
<h2 id="内核定制化">内核定制化</h2>
<h3 id="下载编译内核">下载编译内核</h3>
<p>从<a target="_blank" rel="noopener" href="https://developer.nvidia.com/embedded/linux-tegra">Jetson Linux | NVIDIA Developer</a>处下载最新的（或者自己选L4T版本号）内核源码<code>L4T Driver Package (BSP) Sources</code></p>
<blockquote>
<p>注意：</p>
<ul>
<li>目前（2022/6/4）L4T 34.1之后，暂时只支持 Jetson AGX 系列和 Jetson Xavier 系列，其余暂不支持</li>
<li>下载的是源码包（L4T Driver Package (BSP) <strong>Sources</strong>）</li>
<li>也可以通过SDK Manager来直接下载，eg：<code>./source_sync.sh -t tegra-l4t-r32.7.1</code></li>
</ul>
</blockquote>
<p>解压TBZ2文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -xjf public_sources.tbz2</span><br><span class="line"><span class="built_in">cd</span> Linux_for_Tegra/source/public</span><br><span class="line">tar –xjf kernel_src.tbz2</span><br></pre></td></tr></table></figure>
<p>安装工具链：</p>
<blockquote>
<p>注意：</p>
<ol>
<li>如果在jetson nano上则不需要该步骤</li>
<li>官方推荐<code>Linaro gcc 7.3.1 2018.05 aarch64</code></li>
</ol>
<p>参考连接：本文最开始说明的参考手册中<code>Kernel Customization -&gt; Jetson Linux Toolchain</code></p>
</blockquote>
<p>下载地址：<a target="_blank" rel="noopener" href="http://releases.linaro.org/components/toolchain/binaries/7.3-2018.05/aarch64-linux-gnu/gcc-linaro-7.3.1-2018.05-x86_64_aarch64-linux-gnu.tar.xz">http://releases.linaro.org/components/toolchain/binaries/7.3-2018.05/aarch64-linux-gnu/gcc-linaro-7.3.1-2018.05-x86_64_aarch64-linux-gnu.tar.xz</a></p>
<p>解压：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> <span class="variable">$HOME</span>/l4t-gcc</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$HOME</span>/l4t-gcc</span><br><span class="line">tar xf gcc-linaro-7.3.1-2018.05-x86_64_aarch64-linux-gnu.tar.xz</span><br></pre></td></tr></table></figure>
<p>编译内核：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装依赖</span></span><br><span class="line">sudo apt install build-essential bc</span><br><span class="line"><span class="comment"># 指定输出目录</span></span><br><span class="line">TEGRA_KERNEL_OUT=&lt;outdir&gt;</span><br><span class="line"><span class="comment"># 如果不在板子上编译则需要指定交叉编译工具链</span></span><br><span class="line"><span class="built_in">export</span> CROSS_COMPILE=<span class="variable">$HOME</span>/l4t-gcc/gcc-linaro-7.3.1-2018.05-x86_64_aarch64-linux-gnu/bin/aarch64-linux-gnu-</span><br><span class="line"><span class="built_in">export</span> LOCALVERSION=-tegra</span><br><span class="line"><span class="comment"># 创建 .config 文件</span></span><br><span class="line"><span class="built_in">cd</span> &lt;kernel_source&gt;</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$TEGRA_KERNEL_OUT</span></span><br><span class="line">make ARCH=arm64 O=<span class="variable">$TEGRA_KERNEL_OUT</span> tegra_defconfig</span><br><span class="line"><span class="comment"># 编译内核、dtb</span></span><br><span class="line">make ARCH=arm64 O=<span class="variable">$TEGRA_KERNEL_OUT</span> -j&lt;n&gt;</span><br><span class="line">make ARCH=arm64 O=<span class="variable">$TEGRA_KERNEL_OUT</span> dtbs</span><br><span class="line"><span class="comment"># 安装内核模块到指定位置</span></span><br><span class="line">sudo make ARCH=arm64 O=<span class="variable">$TEGRA_KERNEL_OUT</span> modules_install INSTALL_MOD_PATH=&lt;modules_install_path&gt;</span><br><span class="line"><span class="comment"># 打包内核模块</span></span><br><span class="line"><span class="built_in">cd</span> &lt;modules_install_path&gt;</span><br><span class="line">tar --owner root --group root -cjf kernel_supplements.tbz2 lib/modules</span><br></pre></td></tr></table></figure>
<p>编译生成的内核以及设备树在：</p>
<ul>
<li>内核：<code>TEGRA_KERNEL_OUT/arch/arm64/boot/Image</code></li>
<li>设备树：<code>TEGRA_KERNEL_OUT/arch/arm64/boot/dts/</code></li>
</ul>
<h3 id="编译内核模块">编译内核模块</h3>
<p>找到内核的头文件目录：</p>
<ul>
<li>
<p>对于在jetson上编译来说，头文件在<code>/usr/src/linux-headers-$(uname -r)-ubuntu18.04_aarch64</code>或<code>/lib/modules/$(uname -r)/build</code></p>
</li>
<li>
<p>对于其他平台来说，需要下载内核源码并解压，按照上述操作，之后运行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make ARCH=arm64 O=<span class="variable">$TEGRA_KERNEL_OUT</span> -j&lt;n&gt; modules_prepare</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>编译：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> &lt;path_to_module_source&gt;</span><br><span class="line">make ARCH=arm64 –C &lt;kernel_directory&gt; M=$(<span class="built_in">pwd</span>)</span><br><span class="line"><span class="comment"># 执行以下命令从内核模块中去除不需要的符号：</span></span><br><span class="line">&lt;tool_chain_path&gt;/aarch64-linux-gnu-strip -–strip-unneeded &lt;path-of-kernel-module.ko&gt;</span><br></pre></td></tr></table></figure>
<h2 id="摄像头驱动开发">摄像头驱动开发</h2>
<p>官方提供两种开发方式：</p>
<ul>
<li>Camera Core Library接口</li>
<li>直接通过V4L2访问</li>
</ul>
<p>对于Camera Core Library来说，Linux Driver Package (L4T)框架上的引用和内核模式的V4L2驱动之间的关系如下所示：</p>
<p><img src="/2022/03/15/JetsonNano%E6%91%84%E5%83%8F%E5%A4%B4%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/image1_4.png" alt="A screenshot of a cell phone Description generated with high confidence"></p>
<p>对于直接通过V4L2访问和方式来说，其驱动于应用之间的关系为：</p>
<p><img src="/2022/03/15/JetsonNano%E6%91%84%E5%83%8F%E5%A4%B4%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/image2.jpg" alt="A screenshot of a cell phone Description generated with very high confidence"></p>
<p>对于这种方式，需要：</p>
<ul>
<li>在内核中添加设备树节点</li>
<li>开发对应的V4L2驱动，对于该驱动官方有两种版本，建议用最新的2.0。以下为可以参考的Sony IMX185驱动代码
<ul>
<li>Version 1.0 driver: imx185_v1.c</li>
<li>Version 2.0 driver: imx185.c</li>
</ul>
</li>
</ul>
<h3 id="设备树">设备树</h3>
<h4 id="位置">位置</h4>
<blockquote>
<p>参考手册中：Bootloader -&gt; U-Boot Customization -&gt; Environment Configuration -&gt; exlinux.conf</p>
</blockquote>
<p>在L4T中，一般最后的设备树启动文件<code>*.dtb</code>在根文件系统的<code>/boot/dtb/</code>下，同时可以通过以下命令找到具体位置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /sys/firmware/devicetree/base/nvidia,dtsfilename</span><br><span class="line"><span class="built_in">cat</span> /proc/device-tree/nvidia,dtsfilename</span><br><span class="line"><span class="comment"># /dvs/git/dirty/git-master_linux/kernel/kernel-4.9/arch/arm64/boot/dts/../../../../../../hardware/nvidia/platform/t210/porg/kernel-dts/tegra210-p3448-0000-p3449-0000-b00.dts</span></span><br></pre></td></tr></table></figure>
<ul>
<li>默认位置：
<ul>
<li>Jetson Nano：<code>XXXX/hardware/nvidia/platform/t210/porg/kernel-dts/tegra210-p3448-0000-p3449-0000-b00.dts</code></li>
<li>Jetson Xavier NX：<code>XXXX/hardware/nvidia/platform/t19x/jakku/kernel-dts/tegra194-p3668-all-p3509-0000.dts</code></li>
</ul>
</li>
</ul>
<p>同时通过<code>/boot/extlinux/extlinux.conf</code>配置文件（参见<a target="_blank" rel="noopener" href="https://wiki.syslinux.org/wiki/index.php?title=EXTLINUX">EXTLINUX - Syslinux Wiki</a>）可以使得uboot通过dtb overlays的方式选取不同的设备树或者启动参数来启动系统，对Linux驱动编写与调试方便很多</p>
<p>如下所示为本文中对应的脚本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">TIMEOUT 30</span><br><span class="line">DEFAULT primary</span><br><span class="line"></span><br><span class="line">MENU TITLE L4T boot options</span><br><span class="line"></span><br><span class="line">LABEL primary</span><br><span class="line">      MENU LABEL primary kernel</span><br><span class="line">      LINUX /boot/Image</span><br><span class="line">      INITRD /boot/initrd</span><br><span class="line">      FDT /boot/dtb/tegra210-p3448-0000-p3449-0000-b00-ice.dtb</span><br><span class="line">      FDTOVERLAYS /boot/dtb/tegra210-p3448-all-p3449-0000-camera-imx219-three.dtbo</span><br><span class="line"><span class="comment">#       FDTOVERLAYS /boot/tegra210-p3448-all-p3449-0000-camera-imx219-dual.dtbo</span></span><br><span class="line">      APPEND <span class="variable">$&#123;cbootargs&#125;</span> quiet root=/dev/mmcblk0p1 rw rootwait rootfstype=ext4 console=ttyS0,115200n8 console=tty0 fbcon=map:0 net.ifnames=0</span><br><span class="line"></span><br><span class="line">LABEL backup</span><br><span class="line">      MENU LABEL backup dtb</span><br><span class="line">      LINUX /boot/Image</span><br><span class="line">      INITRD /boot/initrd</span><br><span class="line">      APPEND <span class="variable">$&#123;cbootargs&#125;</span> quiet root=/dev/mmcblk0p1 rw rootwait rootfstype=ext4 console=ttyS0,115200n8 console=tty0 fbcon=map:0 net.ifnames=0</span><br></pre></td></tr></table></figure>
<p>其中：</p>
<ul>
<li>TIMEOUT：默认等待选择时间</li>
<li>DEFAULT：默认启动方式</li>
<li>LINUX：Linux内核存放位置</li>
<li>FDT：设备树文件（不指定则用默认位置，即/boot/dtb/下文件）</li>
<li>FDTOVERLAYS：xxx.dtbo文件，用于补充或者覆盖设备树文件中的一些配置（uboot会根据该文件自动修改设备树）</li>
</ul>
<p>通过上述命令编译设备树后，其生成的<code>*.dtb</code>文件会出现在<code>output/arch/arm64/boot/dts</code>下，</p>
<h4 id="调试">调试</h4>
<p>设备树目录：<code>/proc/device-tree</code>（软连接）和<code>/sys/firmware/devicetree/base/</code>（实际位置）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 调试</span></span><br><span class="line">fdtdump /boot/tegra210-p3448-0000-p3449-0000-a02-fe-pi-audio.dtbo</span><br><span class="line"><span class="comment"># 反编译</span></span><br><span class="line">dtc -I dtb -O dts &lt;filename&gt;</span><br><span class="line"><span class="comment"># 查看属性（hex）</span></span><br><span class="line">hexdump -C /proc/device-tree/host1x/i2c@546c0000/tca9546@70/i2c@2/reg</span><br></pre></td></tr></table></figure>
<h4 id="基础含义">基础含义</h4>
<p>在设备树文件<code>&lt;top&gt;/hardware/nvidia/platform/t19x/common/kernel-dts/t19x-common-modules/tegra194-camera-imx185-a00.dtsi</code>中找到<code>tegra-camera-platform</code>节点</p>
<p>在<code>tegra-camera-platform</code>节点中创建一个模块表（module table），每个模块必须包含其基本信息和该节点内设备的定义</p>
<p>如下所示为一种典型的节点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">tegra-camera-platform &#123;</span><br><span class="line">       compatible = &quot;nvidia, tegra-camera-platform&quot;;</span><br><span class="line">       modules &#123;</span><br><span class="line">           module0 &#123;</span><br><span class="line">               badge = &quot;imx185_bottom_liimx185&quot;;</span><br><span class="line">               position = &quot;bottom&quot;;</span><br><span class="line">               orientation = &quot;0&quot;;</span><br><span class="line">               drivernode0 &#123;</span><br><span class="line">                   pcl_id = &quot;v4l2_sensor&quot;;</span><br><span class="line">                   devname = &quot;imx185 30-001a&quot;;</span><br><span class="line">                   proc-device-tree =</span><br><span class="line">         &quot;/proc/device-tree/i2c@3180000/tca9546@70/i2c@0/imx185_a@1a&quot;;</span><br><span class="line">               &#125;;</span><br><span class="line">           &#125;;</span><br><span class="line">       &#125;;</span><br><span class="line">   &#125;;</span><br></pre></td></tr></table></figure>
<p>属性含义：</p>
<ul>
<li>badge：标识此模块的唯一名称。
<ul>
<li>名称必须由三部分组成，用下划线隔开：
<ul>
<li>模组的摄像头板卡ID (camera_board_id)</li>
<li>模块的位置，例如后置（rear）或前置（front）</li>
<li>模块的零件号，可在模块数据表中找到。如果零件号不可用，请使用唯一标识符。只有零件号的最后六个字符是有效的</li>
</ul>
</li>
<li>例如，imx185_rear_liimx185代表一个模块，该模块带有一个后置imx185摄像头，零件号为“llimx185”</li>
<li>如果系统有多个相同的模块，则每个模块必须具有不同的位置，从而使模块名称唯一</li>
</ul>
</li>
<li>position：相机位置。支持的值取决于系统中的摄像机数量
<ul>
<li>在双摄像头系统中：rear 和 front</li>
<li>在三摄像头系统中：bottom、top 和 center</li>
<li>在六摄像头系统中：bottomleft、bottomright、centerleft、centerright、topleft 和 topright</li>
</ul>
</li>
<li>orientation：传感器方向；表示传感器方向的数字索引。索引和方向之间的关系是任意的，但通常在双摄像头系统中，0 是“后向”，1 是“前向”</li>
</ul>
<h3 id="单独成像设备">单独成像设备</h3>
<p>成像设备是相机模块内部的组件。有可能：</p>
<ul>
<li>一个传感器</li>
<li>一个聚焦器</li>
<li>一个闪光灯</li>
</ul>
<p>必须将信息添加到设备树节点以支持设备操作。对于每个设备的设备树节点，分配一个包含以下内容的设备树节点：</p>
<ul>
<li>设备名称</li>
<li>器件的从地址（可从器件数据表中获得）</li>
<li>标识节点的兼容属性</li>
</ul>
<blockquote>
<p>注意：除了引用其他设备树节点的设备外，与相机相关的设备树节点中的所有值字段都必须使用字符串数据类型。</p>
</blockquote>
<p>以下是IMX185 V4L2传感器驱动程序的设备树节点示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">imx185_a@1a &#123;</span><br><span class="line">    compatible = &quot;nvidia,imx185&quot;;</span><br><span class="line">    reg = &lt;0x1a&gt;;</span><br><span class="line">    physical_w = &quot;15.0&quot;;</span><br><span class="line">    physical_h = &quot;12.5&quot;;</span><br><span class="line">    sensor_model =&quot;imx185&quot;;</span><br><span class="line">    post_crop_frame_drop = &quot;0&quot;;</span><br><span class="line">    use_decibel_gain = &quot;true&quot;;</span><br><span class="line">    delayed_gain = &quot;true&quot;;</span><br><span class="line">    use_sensor_mode_id = &quot;true&quot;;</span><br><span class="line"> </span><br><span class="line">    mode0 &#123;</span><br><span class="line">        mclk_khz = &quot;37125&quot;;</span><br><span class="line">        num_lanes = &quot;4&quot;;</span><br><span class="line">        tegra_sinterface = &quot;serial_a&quot;;</span><br><span class="line">        phy_mode = &quot;DPHY&quot;;</span><br><span class="line">        discontinuous_clk = &quot;no&quot;;</span><br><span class="line">        dpcm_enable = &quot;false&quot;;</span><br><span class="line">        cil_settletime = &quot;0&quot;;</span><br><span class="line">        dynamic_pixel_bit_depth = &quot;12&quot;;</span><br><span class="line">        csi_pixel_bit_depth = &quot;12&quot;;</span><br><span class="line">        mode_type = &quot;bayer&quot;;</span><br><span class="line">        pixel_phase = &quot;rggb&quot;;</span><br><span class="line">        active_w = &quot;1920&quot;;</span><br><span class="line">        active_h = &quot;1080&quot;;</span><br><span class="line">        readout_orientation = &quot;0&quot;;</span><br><span class="line">        line_length = &quot;2200&quot;;</span><br><span class="line">        inherent_gain = &quot;1&quot;;</span><br><span class="line">        mclk_multiplier = &quot;2&quot;;</span><br><span class="line">        pix_clk_hz = &quot;74250000&quot;;</span><br><span class="line"> </span><br><span class="line">        gain_factor = &quot;10&quot;;</span><br><span class="line">        min_gain_val = &quot;0&quot;;         /* 0dB */</span><br><span class="line">        max_gain_val = &quot;480&quot;;       /* 48dB */</span><br><span class="line">        step_gain_val = &quot;3&quot;;        /* 0.3 */</span><br><span class="line">        default_gain = &quot;0&quot;;</span><br><span class="line">        min_hdr_ratio = &quot;1&quot;;</span><br><span class="line">        max_hdr_ratio = &quot;1&quot;;</span><br><span class="line">        framerate_factor = &quot;1000000&quot;;</span><br><span class="line">        min_framerate = &quot;1500000&quot;;</span><br><span class="line">        max_framerate = &quot;30000000&quot;; /* 30 */</span><br><span class="line">        min_exp_time = &quot;30&quot;;        /* us */</span><br><span class="line">        max_exp_time = &quot;660000&quot;;    /* us */</span><br><span class="line">        step_exp_time = &quot;1&quot;;</span><br><span class="line">        default_exp_time = &quot;33334&quot;; /* us */</span><br><span class="line">        embedded_metadata_height = &quot;1&quot;;</span><br><span class="line">    &#125;;</span><br><span class="line">    . . .</span><br><span class="line">    ports &#123;</span><br><span class="line">        #address-cells = &lt;1&gt;;</span><br><span class="line">        #size-cells = &lt;0&gt;;</span><br><span class="line">        port@0 &#123;</span><br><span class="line">            reg = &lt;0&gt;;</span><br><span class="line">            liimx185_imx185_out0: endpoint &#123;</span><br><span class="line">            port-index = &lt;0&gt;;</span><br><span class="line">            bus-width = &lt;4&gt;;</span><br><span class="line">            remote-endpoint = &lt;&amp;liimx185_csi_in0&gt;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="设备属性">设备属性</h4>
<p>下表介绍了V4L2传感器设备的设备树节点属性（其中<code>*</code>号为可选项）</p>
<p>以下属性可以在不同的 DTSI 文件中指定。例如，时钟、GPIO 和调节器属性可以在platform DTSI 文件中指定，其余属性可以在sensor  DTSI 文件中指定</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>值</th>
</tr>
</thead>
<tbody>
<tr>
<td>compatible</td>
<td>设备标识符。 Linux 内核使用此关键字将设备驱动程序绑定到特定设备</td>
</tr>
<tr>
<td>reg</td>
<td>I2C 从机地址</td>
</tr>
<tr>
<td>mclk*</td>
<td>设备输入时钟的名称。默认值为 extperiph1。<br>extperiph1 的最大频率为 24 MHz。如果需要大于 24 MHz 的频率，请使用外部时钟源。<br>如果传感器使用相机模块提供的时钟源，则不需要</td>
</tr>
<tr>
<td><xxx>-gpio*</xxx></td>
<td>设备的通用输入/输出 (GPIO) 引脚，其中 <xxx> 标识相机的 GPIO 引脚。<br>相机的默认 GPIO 引脚为：<br>• H3-gpio：Camera0 复位<br>• H6-gpio：Camera0 断电<br>• T6-gpio：Camera1 复位<br>• T5-gpio：Camera1 断电<br>如果传感器有自己的 I/O 控制机制并且不需要来自 Jetson 的特定 I/O 控制，则不需要</xxx></td>
</tr>
<tr>
<td><xxx>-supply*</xxx></td>
<td>指定设备的监管者（regulator），其中 <xxx> 是传感器驱动程序的监管者名称。该值是对实际监管者名称（在设备树文件中的其他位置定义）的引用，用尖括号括起来。<br>定义的监管者存在以下：<br>• vana-supply：值必须是&lt;&amp;en_vdd_cam_hv_2v8&gt;（模拟2.8v）。<br>• vdig-supply：值必须是&lt;&amp;en-vdd-cam_1v2&gt;（数字1.2v）。<br>• vif-supply：值必须是&lt;&amp;en-vdd-cam&gt;（接口1.8v）。<br>• vvcm-supply：值必须是&lt;&amp;en_vdd_vcm_2v8&gt;（vcm 模拟2.8v）。<br>如果传感器使用相机模块提供的电源，则不需要</xxx></td>
</tr>
<tr>
<td><xxx>-reg</xxx></td>
<td>监管者（regulator）的唯一标识符，其中 <xxx> 是传感器驱动程序的监管者名称。此字段的值是带有后缀 -reg 的监管者名称。<br>定义的监管者为：<br>• avdd-reg：vana<br>• dvdd-reg：vdig<br>• iovdd-reg: vif<br>• vcmvdd-reg：vvcm</xxx></td>
</tr>
<tr>
<td>physical_w</td>
<td>传感器的物理宽度（毫米）</td>
</tr>
<tr>
<td>physical_h</td>
<td>传感器的物理高度（毫米）</td>
</tr>
<tr>
<td>sensor_model*</td>
<td>此模块中的传感器类型，例如“imx185”</td>
</tr>
<tr>
<td>set_mode_delay_ms*</td>
<td>捕获开始后第一帧的最大等待时间（毫秒）</td>
</tr>
<tr>
<td>post_crop_frame_drop*</td>
<td>传感器裁剪设置后，驱动程序要丢弃的帧数<br>一些传感器必须丢帧以避免在应用裁剪设置后接收到损坏的帧</td>
</tr>
<tr>
<td>use_decibel_gain*</td>
<td>布尔值，默认值为 false。根据以下公式确定驱动器是否返回以分贝 (dB) 为单位的模拟增益：<br>dB = 20 * log(Analog Gain)<br>如果为 false，则返回驱动器接收到的模拟增益，不作任何更改</td>
</tr>
<tr>
<td>delayed_gain*</td>
<td>布尔值，默认值为 false。如果为真，则用户模式驱动程序将延迟一帧发送更新的增益值。如果为 false，它会立即将更新的增益值发送给驱动程序。</td>
</tr>
<tr>
<td>use_sensor_mode_id*</td>
<td>一个布尔值，默认值为false。如果为true，用户模式驱动程序将绕过默认模式选择逻辑，并使用TEGRA_CAMERA_CID_SENSOR_MODE_ID 控件选择特定的传感器模式。如果为false，则使用默认模式选择逻辑，该逻辑根据分辨率、颜色格式和帧速率选择模式。</td>
</tr>
</tbody>
</table>
<h4 id="属性值对">属性值对</h4>
<p>此表描述了适用于 V4L2 实现的传感器模式的属性值对。所有属性都是按模式设置的，并且必须精确设置。</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>值</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>mode<n></n></td>
<td>指定这组属性适用的传感器模式，其中 <n> 是从 0 开始的索引</n></td>
<td></td>
</tr>
<tr>
<td>ports</td>
<td>媒体控制器图形绑定信息。有关更多信息，请参阅端口绑定</td>
<td></td>
</tr>
<tr>
<td>mclk_khz</td>
<td>标准MIPI驱动时钟频率，单位为kHZ</td>
<td></td>
</tr>
<tr>
<td>num_lanes</td>
<td>传感器输出的通道数</td>
<td></td>
</tr>
<tr>
<td>tegra_sinterface</td>
<td>选择NVIDIA® Tegra®的那个串口，如&quot;serial_a&quot;</td>
<td></td>
</tr>
<tr>
<td>discontinuous_clk</td>
<td>布尔值；指示传感器是否在MIPI通道上使用不连续时钟</td>
<td></td>
</tr>
<tr>
<td>cil_settletime</td>
<td>MIPI 通道的 THS 稳定时间，以纳秒为单位。使用适当的公式计算可接受值的范围。<br>•对于 NVIDIA® Jetson™ Nano 设备和 Jetson TX1：<img src="/2022/03/15/JetsonNano%E6%91%84%E5%83%8F%E5%A4%B4%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/camera_sensor_prog.1.3.jpg" alt="img">其中一个 lp 时钟周期为 1/(102 MHz)。<br>•对于 NVIDIA® Jetson AGX Xavier™ 系列和 Jetson TX2 系列：<img src="/2022/03/15/JetsonNano%E6%91%84%E5%83%8F%E5%A4%B4%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/camera_sensor_prog.1.4.jpg" alt="img">其中一个 lp 时钟周期为 1/(204 MHz)。<br>UI 是单位间隔，等于时钟通道上 HS 状态的持续时间。<br>如果该值为 0，则驱动程序会尝试根据 mclk_multiplier 参数进行自动校准。<br>有关详细信息，请参阅 D-PHY 的 MIPI 联盟规范。</td>
<td></td>
</tr>
<tr>
<td>dpcm_enable</td>
<td>布尔值；指定是否为此模式启用DPCM压缩</td>
<td></td>
</tr>
<tr>
<td>active_h</td>
<td>指定像素活动区域的高度</td>
<td></td>
</tr>
<tr>
<td>active_w</td>
<td>指定像素活动区域的宽度</td>
<td></td>
</tr>
<tr>
<td>pixel_t</td>
<td>已弃用。请改用以下属性：<br>•mode_type<br>•csi_pixel_bit_depth<br>•pixel_phase</td>
<td></td>
</tr>
<tr>
<td>mode_type</td>
<td>传感器模式类型。可能的值为：<br>•yuv<br>•bayer<br>•bayer_wdr_pwl：宽动态范围模式。使用分段线性函数来压缩多重曝光融合的像素数据。传感器上也进行了多次曝光融合。<br>有关详细信息，请参阅 IMX185 传感器驱动程序文档</td>
<td></td>
</tr>
<tr>
<td>readout_orientation</td>
<td>Specifies clockwise rotation in degrees of the sensor image presented on the display. Intended for use in an Android environment; has no effect with Jetson Linux Driver Package.This property is used to ensure that the sensor image display is oriented correctly for the end user.For example, suppose the sensor is rotated 90° counterclockwise, so that the top of the image falls on the right side of the sensor’s imaging surface. The image on the display appears to be rotated 90° clockwise, with the top of the sensor’s imaging area at the top of the display, and the top of the image on the right. To correct this, set readout_orientation=270. This rotates the displayed image 270° clockwise (90° counterclockwise), rotating the top of the image from the right side of the display to the top.</td>
<td></td>
</tr>
<tr>
<td>csi_pixel_bit_depth</td>
<td>Bit depth of sensor output on the CSI bus.If mode_type is set to bayer_wdr_pwl, this property represents the bit depth of sensor output after piece-wise linear function based compression.For more information, see the IMX185 Sensor Driver documentation.</td>
<td></td>
</tr>
<tr>
<td>dynamic_pixel_bit_depth*</td>
<td>True dynamic range of the signal.If mode type is set to bayer_wdr_pwl, specifies the bit depth of the multi-exposure fused output before piece-wise linear function based compression.For other mode types, must be equal to csi_pixel_bit_depth.For more information, see the IMX185 Sensor Driver documentation.</td>
<td></td>
</tr>
<tr>
<td>pixel_phase*</td>
<td>Sensor pixel phase. Possible values are:</td>
<td></td>
</tr>
<tr>
<td>•uyvy•vyuy•yuyv</td>
<td>•yvyu•rggb•bggr</td>
<td>•grbg•gbrg</td>
</tr>
<tr>
<td>For more information, consult to the IMX185 Sensor Driver documentation.</td>
<td></td>
<td></td>
</tr>
<tr>
<td>line_length</td>
<td>Pixel line width horizontal timing size for the sensor mode. Used to calibrate the features in the camera stack.The value must be greater than or equal to active_w.</td>
<td></td>
</tr>
<tr>
<td>mclk_multiplier(deprecated)</td>
<td>MCLK multiplier for timing the capture sequence of the hardware. Calculate this value with the equation:mclk_multiplier = desired ISP clock frequency in Hertz / mclkThe value must be greater than pixel_clk_hz divided by mclk to prevent ISP underrun.This switch is no longer needed because the value it specifies is calculated internally.</td>
<td></td>
</tr>
<tr>
<td>pix_clk_hz</td>
<td>Sensor pixel clock for calculating exposure, frame rate, etc.Calculate the value based on the input clock (mclk) and PLL settings from sensor mode table. See the sensor data sheet for detailed instructions.For more information, see [Sensor Pixel Clock](<a target="_blank" rel="noopener" href="https://docs.nvidia.com/jetson/l4t/Tegra">https://docs.nvidia.com/jetson/l4t/Tegra</a> Linux Driver Package Development Guide/camera_sensor_prog.48.2.html#wwpID0EBHA).</td>
<td></td>
</tr>
<tr>
<td>serdes_pix_clk_hz</td>
<td>Output clock rate for the serializer/deserializer (GMSL or FPD link), in Hertz. Required only for camera modules that use SerDes.For more information, see [SerDes Pixel Clock](<a target="_blank" rel="noopener" href="https://docs.nvidia.com/jetson/l4t/Tegra">https://docs.nvidia.com/jetson/l4t/Tegra</a> Linux Driver Package Development Guide/camera_sensor_prog.48.2.html#wwpID0EBHA).</td>
<td></td>
</tr>
<tr>
<td>inherent_gain</td>
<td>Gain obtained inherently from the mode, that is, pixel binning.May be set to 1 if you do not know the actual value.</td>
<td></td>
</tr>
<tr>
<td>min_gain_val</td>
<td>Minimum gain limit for the mode. The value is rounded down to six decimal places. Usually set to 1.0, representing 1x gain.</td>
<td></td>
</tr>
<tr>
<td>max_gain_val</td>
<td>Maximum gain limit for the mode. The value is truncated to six decimal places.If supported by the sensor, it may be increased to include digital gain.</td>
<td></td>
</tr>
<tr>
<td>min_exp_time</td>
<td>Specifies the minimum exposure time limit for the mode, in microseconds. The value is rounded up to an integer.Calculate the value according to this equation:min_exp_time = (minimum coarse integration time) * line_ length / pix_clk_hz * 1000000The minimum coarse integration time is the minimum exposure intervals. Unit in lines.</td>
<td></td>
</tr>
<tr>
<td>max_exp_time</td>
<td>Specifies the maximum exposure time limit for the mode, in microseconds. The value is rounded up to an integer.Calculate this value with the equation:max_exp_time = (maximum coarse integration time) * line_length / pix_clk_hz * 1000000The maximum coarse integration time is the maximum exposure intervals. Unit in lines.</td>
<td></td>
</tr>
<tr>
<td>min_hdr_ratio</td>
<td>Minimum high-dynamic-range (HDR) ratio denominator for the mode for HDR sensors. Must be an integer greater than 0. For non-HDR sensors, set to 1.</td>
<td></td>
</tr>
<tr>
<td>max_hdr_ratio</td>
<td>Maximum HDR ratio denominator for the mode for HDR sensors.Must be an integer greater than 0. For non-HDR sensors, set to 1.</td>
<td></td>
</tr>
<tr>
<td>min_framerate</td>
<td>Minimum frame rate limit for the mode, in frames/second (fps). The value is rounded down to six decimal places.Calculate this value with the equation:min_framerate = pix_clk_hz / (line_length * maximum frame length)</td>
<td></td>
</tr>
<tr>
<td>max_framerate</td>
<td>Maximum frame rate limit for the mode in fps. The value is rounded down to six decimal places.Calculate this value with the equation:max_framerate = pix_clk_hz / (line_length * minimum frame length)</td>
<td></td>
</tr>
<tr>
<td>embedded_metadata_height</td>
<td>Specifies the number of extra embedded metadata rows for each frame.Set to 0 to disable embedded metadata support.</td>
<td></td>
</tr>
<tr>
<td>num_control_point*</td>
<td>Number of control points used in the piece-wise linear function for compressing multi-exposure fused pixel data. Multi-exposure fusion is also performed on the sensor.Valid if mode_type is set to bayer_wdr_pwl.The camera core library interface supports up to 9 control points.For more information, see the IMX185 Sensor Driver documentation.</td>
<td></td>
</tr>
<tr>
<td>control_point_x_[<n>]*</n></td>
<td>X coordinate of control point <n> from the piece-wise linear compression function, where <n> is an index from 0 to 15. (Do not include angle brackets in an actual property name.)Valid if mode_type is set to bayer_wdr_pwl.The value may not exceed 2dynamic_pixel_width_depth.</n></n></td>
<td></td>
</tr>
<tr>
<td>control_point_y_ [<n>]*</n></td>
<td>Y coordinate of control point <n> from the piece-wise linear compression function, where <n> is an index from 0 to 15. (Do not include angle brackets in an actual property name.)Valid if mode_type is set to bayer_wdr_pwl.The value may not exceed 2csi_pixel_width_depth.</n></n></td>
<td></td>
</tr>
<tr>
<td>For WDR DOL (Digital Overlap) sensors</td>
<td></td>
<td></td>
</tr>
<tr>
<td>num_of_exposure†</td>
<td>Number of exposure frames in a DOL multi-frame.</td>
<td></td>
</tr>
<tr>
<td>num_of_ignored_lines†</td>
<td>Number lines to crop at the top of each exposure frame. Usually includes the OB (Optical Black) rows and ignored area of effective pixel rows, both of which use the same LI (line information) header as the exposure frame on which they reside. The VI (video input) module handles cropping for these lines.</td>
<td></td>
</tr>
<tr>
<td>num_of_lines_offset_0†</td>
<td>Number of VBP rows appearing in a single exposure frame of a two-exposure DOL multi-frame. These VBP rows are filtered out as they have LI (line information) indicating that they are blank.Note that the same number of VBP rows appear at the end of a long exposure frame and at the start of a short exposure frame.For DOL mode with two exposure frames, there is only one type of VBP row. With more than two exposure frames, there may be different types of VBP rows. Hence the parameter can be extended to number_of_offset_1, number_of_offset_2,…. The number of VBP row types is usually one less than the number of exposure frames in a DOL frame.</td>
<td></td>
</tr>
<tr>
<td>num_of_ignored_pixels†</td>
<td>Size of LI (line information) header for each row, in pixels. The line information helps differentiate VBP (Vertical Blank Period) rows and different exposure rows such as long exposure and short exposure. The VI (video input) module handles cropping for these lines.</td>
<td></td>
</tr>
<tr>
<td>num_of_left_margin_pixels†</td>
<td>Size of the left margin, before the active pixel area, in pixels. These lines are required for cropping alignment. The VI (video input) module handles cropping for them.</td>
<td></td>
</tr>
<tr>
<td>num_of_right_margin_pixels†</td>
<td>Size of the right margin, after the active pixel area, in pixels. These lines are required for cropping alignment. The VI (video input) module handles cropping for them.</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="测试">测试</h3>
<blockquote>
<p>参考链接：<a target="_blank" rel="noopener" href="http://trac.gateworks.com/wiki/linux/v4l2">linux/v4l2 – Gateworks</a></p>
<p>参考手册中：</p>
<ul>
<li>Multimedia -&gt; Accelerated GStreamer -&gt; Camera Capture with GStreamer-1.0</li>
<li>Camera Development -&gt; Sensor Software Driver Programming -&gt; Device Registration</li>
</ul>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装依赖</span></span><br><span class="line">sudo apt install v4l-utils</span><br><span class="line"><span class="comment"># 检测摄像头</span></span><br><span class="line">v4l2-ctl --list-devices</span><br><span class="line">v4l2-ctl --list-formats-ext</span><br><span class="line"><span class="comment"># 检测摄像头支持的格式</span></span><br><span class="line">v4l2-ctl -d /dev/video1 --list-formats-ext</span><br><span class="line"><span class="comment"># 检查摄像头设置</span></span><br><span class="line">v4l2-ctl -d /dev/video1 --list-ctrls</span><br><span class="line">v4l2-ctl -d /dev/video1 --all</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出内核信息</span></span><br><span class="line">dmesg | grep -i imx219</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启nvargus服务 防止gst-launch-1.0导致摄像头打开失败</span></span><br><span class="line">sudo service nvargus-daemon restart</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接显示在屏幕上</span></span><br><span class="line">nvgstcapture</span><br><span class="line"><span class="comment"># 或者 设置对应的摄像头</span></span><br><span class="line">gst-launch-1.0 nvarguscamerasrc sensor-id=0 sensor-mode=3 ! <span class="string">&#x27;video/x-raw(memory:NVMM),width=3820, height=2464, framerate=21/1, format=NV12&#x27;</span> ! nvvidconv flip-method=0 ! <span class="string">&#x27;video/x-raw,width=960, height=616&#x27;</span> ! nvvidconv ! nvegltransform ! nveglglessink -e</span><br><span class="line"></span><br><span class="line"><span class="comment"># https://www.linuxtv.org/wiki/index.php/V4l-utils</span></span><br><span class="line"><span class="comment"># 测试摄像头</span></span><br><span class="line">v4l2-compliance -d /dev/video&lt;n&gt;</span><br><span class="line"><span class="comment"># 验证</span></span><br><span class="line">v4l2-ctl --set-fmt-video=width=1920,height=1080,pixelformat=RG12 --stream-mmap --set-ctrl=sensor_mode=0 --stream-count=100 -d /dev/video&lt;n&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># gst-launch-1.0方式</span></span><br><span class="line"><span class="comment"># 采集摄像头图像保存为本地视频</span></span><br><span class="line">gst-launch-1.0 nvarguscamerasrc sensor-id=0 ! <span class="string">&#x27;video/x-raw(memory:NVMM), width=(int)1920, height=(int)1080,format=(string)NV12, framerate=(fraction)30/1&#x27;</span> ! nvv4l2h264enc bitrate=8000000 ! h264parse ! qtmux ! filesink location=filename_h264.mp4 -e</span><br><span class="line"></span><br><span class="line">gst-launch-1.0 nvarguscamerasrc sensor-id=1 ! <span class="string">&#x27;video/x-raw(memory:NVMM), width=(int)1920, height=(int)1080,format=(string)NV12, framerate=(fraction)30/1&#x27;</span> ! nvv4l2h264enc bitrate=8000000 ! h264parse ! qtmux ! filesink location=filename_h264_1.mp4 -e</span><br><span class="line"></span><br><span class="line">gst-launch-1.0 nvarguscamerasrc sensor-id=2 ! <span class="string">&#x27;video/x-raw(memory:NVMM), width=(int)1920, height=(int)1080,format=(string)NV12, framerate=(fraction)30/1&#x27;</span> ! nvv4l2h264enc bitrate=8000000 ! h264parse ! qtmux ! filesink location=filename_h264_2.mp4 -e</span><br><span class="line"></span><br><span class="line"><span class="comment"># v4l2-ctl方式</span></span><br><span class="line"><span class="comment"># 保存为图片</span></span><br><span class="line">v4l2-ctl --device /dev/video0 --set-fmt-video=width=1920,height=1080,pixelformat=RG10 --set-ctrl bypass_mode=0 --stream-mmap --stream-to=frame.raw --stream-count=1</span><br><span class="line">convert -size 1920x1080 -depth 16 uyvy:frame.raw frame.png</span><br><span class="line"></span><br><span class="line">v4l2-ctl --device /dev/video1 --set-fmt-video=width=1920,height=1080,pixelformat=RG10 --set-ctrl bypass_mode=0 --stream-mmap --stream-to=frame.raw --stream-count=1</span><br><span class="line">convert -size 1920x1080 -depth 16 uyvy:frame.raw frame.png</span><br><span class="line"><span class="comment"># 默认格式</span></span><br><span class="line">v4l2-ctl --device /dev/video0 --stream-mmap --stream-to=frame.raw --stream-count=1</span><br><span class="line">convert -size 640x480 -depth 16 uyvy:frame.raw frame.png</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连续采集测试</span></span><br><span class="line">v4l2-ctl -d /dev/video0 --set-fmt-video=width=1920,height=1080,pixelformat=RG10 --set-ctrl bypass_mode=0 --stream-mmap --stream-count=100</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">spaceman</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://nu-ll.github.io/2022/03/15/JetsonNano%E6%91%84%E5%83%8F%E5%A4%B4%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/">http://nu-ll.github.io/2022/03/15/JetsonNano摄像头驱动开发指南/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://NU-LL.github.io" target="_blank">spaceman</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/JetsonNano/">JetsonNano</a></div><div class="post_share"><div class="social-share" data-image="https://gitee.com/NU-LL/image-host/raw/master/12.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/04/29/RT1050%E5%9C%A8%E7%BA%BF%E6%93%A6%E9%99%A4%E5%A4%96%E9%83%A8QSPI%20Flash/"><img class="prev-cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">基于STM32L476的IAP升级</div></div></a></div><div class="next-post pull-right"><a href="/2022/02/22/JetsonTX2%E9%81%BF%E5%9D%91%E6%8C%87%E5%8D%97/"><img class="next-cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">JetsonTX2避坑指南</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/05/12/JetsonNano%20Multimedia%20API%E5%B7%A5%E7%A8%8B%E6%90%AD%E5%BB%BA%E5%8F%8A%E7%BC%96%E8%AF%91/" title="JetsonNano Multimedia API工程搭建及编译"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2022-05-12</div><div class="title">JetsonNano Multimedia API工程搭建及编译</div></div></a></div><div><a href="/2020/08/20/JetsonNano%E6%8C%87%E5%8D%97/" title="JetsonNano指南"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2022-05-12</div><div class="title">JetsonNano指南</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/spaceman.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">spaceman</div><div class="author-info__description">CtrlC CtrlV大师</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">99</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">101</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/NU-LL"><i class="fab fa-github"></i><span>Github</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">白嫖一时爽，一直白嫖一直爽</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">JetsonNano摄像头驱动开发指南</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E6%A0%B8%E5%AE%9A%E5%88%B6%E5%8C%96"><span class="toc-text">内核定制化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E7%BC%96%E8%AF%91%E5%86%85%E6%A0%B8"><span class="toc-text">下载编译内核</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E5%86%85%E6%A0%B8%E6%A8%A1%E5%9D%97"><span class="toc-text">编译内核模块</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%91%84%E5%83%8F%E5%A4%B4%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91"><span class="toc-text">摄像头驱动开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E5%A4%87%E6%A0%91"><span class="toc-text">设备树</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%8D%E7%BD%AE"><span class="toc-text">位置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E8%AF%95"><span class="toc-text">调试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%90%AB%E4%B9%89"><span class="toc-text">基础含义</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E7%8B%AC%E6%88%90%E5%83%8F%E8%AE%BE%E5%A4%87"><span class="toc-text">单独成像设备</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E5%A4%87%E5%B1%9E%E6%80%A7"><span class="toc-text">设备属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E5%80%BC%E5%AF%B9"><span class="toc-text">属性值对</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-text">测试</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/10/06/openwrt%E5%AE%89%E8%A3%85transmission/" title="openwrt安装transmission.md">openwrt安装transmission.md</a><time datetime="2022-10-06T15:37:29.000Z" title="发表于 2022-10-06 23:37:29">2022-10-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/08/14/Linux%20perl%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/" title="Linux perl性能分析工具">Linux perl性能分析工具</a><time datetime="2022-08-14T09:17:28.000Z" title="发表于 2022-08-14 17:17:28">2022-08-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/08/05/C++%20%E8%99%9A%E5%87%BD%E6%95%B0%E3%80%81%E7%BA%AF%E8%99%9A%E5%87%BD%E6%95%B0/" title="C++ 虚函数、纯虚函数">C++ 虚函数、纯虚函数</a><time datetime="2022-08-04T16:05:23.000Z" title="发表于 2022-08-05 00:05:23">2022-08-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/06/26/VEYE%E6%91%84%E5%83%8F%E5%A4%B4%E8%B0%83%E8%AF%95/" title="VEYE摄像头调试">VEYE摄像头调试</a><time datetime="2022-06-26T08:37:45.000Z" title="发表于 2022-06-26 16:37:45">2022-06-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/06/06/%E5%9F%BA%E4%BA%8EVSCode%E6%90%AD%E5%BB%BAESP-IDF%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/" title="基于VSCode搭建ESP-IDF开发环境">基于VSCode搭建ESP-IDF开发环境</a><time datetime="2022-06-06T06:27:54.000Z" title="发表于 2022-06-06 14:27:54">2022-06-06</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2023 By spaceman</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><script type="text/javascript" src="https://api.uixsj.cn/hitokoto/w.php?code=js"></script><div id="xsjhitokoto"><script>xsjhitokoto()</script></div> <iframe scrolling="no" src="https://tianqiapi.com/api.php?style=tx&color=eee" frameborder="0" allowtransparency="false" align="middle" height="20"></iframe></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>